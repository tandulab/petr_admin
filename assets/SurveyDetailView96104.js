import{e as Ve,u as xe,r as Ae}from"./usetoast.esm96104.js";import{r as n,k as ke,c as T,n as Le,_ as Fe,a as m,i as Ue,o as c,b as p,e as s,f as r,q as C,w as E,F as De,j as V,h,g as z,y as ae,t as R}from"./_plugin-vue_export-helper96104.js";import{e as A,a as k,s as le,h as L,u as Ie,b as Te,c as Ee,d as Re,f as qe}from"./helpers96104.js";import{u as Be}from"./survey96104.js";import{u as Ne}from"./user96104.js";import{u as je}from"./group96104.js";import{a as K,f as P}from"./formatData96104.js";import{A as Me}from"./AudienceCard96104.js";import{U as Ge}from"./UploadImageCard96104.js";import{v as W}from"./runtime-dom.esm-bundler96104.js";import"./datetime96104.js";const ze={setup(){const H=n({icon:"pi pi-home",to:"/surveys"}),o=n(""),q=n([{label:""}]),e=n({}),J=n(),B=n(!1),O=n(),F=n(!0),w=n(!0),g=n(!0),N=n({}),b=n(),Q=n([]),y=n(""),u=n({}),U=n([]),D=n(),I=n(),j=ke(),a=Ve(),d=Be(),X=xe(),oe=je(),se=Ne(),M=n(!1),ne=n({sellout_code:{value:"",matchMode:"contains"},full_name:{value:"",matchMode:"contains"}}),re=n([{label:"Open",value:"open"},{label:"Closed",value:"closed"}]),v=T(()=>d.getCurrentSurvey),G=T(()=>X.getSelectedCountry),ie=T(()=>d.allSurveys),de=T(()=>se.userRoles),ce=T(()=>oe.allGroups),Y=async function(l){le(),d.fetchSurveyDetail(l).then(()=>{L(),me()}).catch(t=>{L(),A(a,t)})},Z=async function(){const l=new Map;await d.fetchAllSurveys(l).catch(t=>{A(a,t)})},ue=async function(){const l={id:e.value.id,formData:$()};d.updateSurvey(l).then(()=>{L(),Y(e.value.id+""),k(a,{message:"Survey updated correctly.",title:""})}).catch(t=>{L(),A(a,t)})},$=function(){var _;const l=new FormData,t=Object.assign({},e.value);if(t.active_from=K(e.value.active_from),t.active_to=K(e.value.active_to),t.hidden_at=K(e.value.hidden_at),t.country_id=(_=t.country)==null?void 0:_.id,delete t.country,o.value||t.id){for(const f in u.value)Ie(u.value[f],t.translations[f].title.id);t.translations={}}else{t.translations={};let f=G.value.language_codes;if(f&&f.length>0)for(const x of f){const te=u.value[x];te?t.translations[x]={title:te}:t.translations[x]={title:t.translations[f[0]].title}}}const i=I.value.tmp_image;i&&i.image&&(t.image=i.image),t.answers=[];for(const f in e.value.answers){const x=e.value.answers[f];x.id?t.answers.push({}):t.answers.push(x)}return delete t.target_all,delete t.target_clusters,delete t.target_group_ids,delete t.target_groups,delete t.created_at,delete t.updated_at,delete t.can_edit,delete t.can_delete,Te(l,t,"survey"),Ee(D,l,"survey"),l},ve=async function(){const l={formData:$()};d.createSurvey(l).then(()=>{L(),Y(v.value.id+""),k(a,{message:"Survey created correctly.",title:""}),Ae.push({name:"survey-detail",params:{id:v.value.id}})}).catch(t=>{L(),A(a,t)})},me=function(){if(v.value){e.value=Object.assign({},v.value),v.value.active_from&&(e.value.active_from=P(v.value.active_from+"")),v.value.active_to&&(e.value.active_to=P(v.value.active_to+"")),v.value.hidden_at&&(e.value.hidden_at=P(v.value.hidden_at+"")),ee();for(const l in v.value.translations)u.value[l]=v.value.translations[l].title.text;for(const l in e.value.answers)for(const t in e.value.answers[+l].translations){const i=e.value.answers[+l];delete i.translations[t].updated_at,delete i.translations[t].created_at}Re(D,e),qe(I,e)}},_e=function(){S(e.value.active_from),S(e.value.active_to),S(e.value.hidden_at),S(e.value.typology),S(u.value[y.value]),e.value.typology=="closed"&&(!e.value.answers||e.value.answers.length==0)&&S(b.value)},ye=function(){if(B.value=!0,_e(),M.value){k(a,{message:"Check that you have completed the required fields.",title:"",error:!0});return}o.value!=""||e.value.id?ue():ve(),B.value=!1,le()},S=function(l){if(B.value)return l==""||l==null?M.value=!0:M.value=!1,M.value},fe=function(l,t){switch(l){case 1:{t?(e.value.target_clusters=[],e.value.target_group_ids=[],g.value=!1,w.value=!1):(w.value=!0,g.value=!0);break}case 2:{t?(g.value=!1,e.value.target_group_ids=[]):g.value=!0;break}case 3:{t?(w.value=!1,e.value.target_clusters=[]):w.value=!0;break}}},pe=l=>{e.value.image_url="",e.value.image=l.files[0]},ge=function(){var t,i;const l={};(t=e.value.country.language_codes)==null||t.forEach((_,f)=>{_==y.value,l[_]=b.value}),e.value.answers||(e.value.answers=[]),(i=e.value.answers)==null||i.push({translations:l}),b.value=""},he=async function(l,t){l?await d.deleteAnswerFromSurvey(l).then(()=>{k(a,{message:"Answer deleted correctly.",title:""}),e.value.answers.splice(t,1)}).catch(i=>{A(a,i)}):e.value.answers.splice(t,1)},we=async function(l,t){const i={id:l,text:t};await d.updateAnswer(i).then(()=>{k(a,{message:"Answer update correctly.",title:""})}).catch(_=>{A(a,_)})},be=l=>{let{newData:t,index:i}=l;const _=t.translations[y.value].id;_&&we(_,t.translations[y.value].text)},ee=function(){var l;e.value.answers||(e.value.answers=[]),(l=e.value.country.language_codes)==null||l.forEach((t,i)=>{u.value[t]="",i==0&&(y.value=t),U.value.push({field:"lang",header:t})})},Se=function(){return e.value.online?"Status online":"Status offline"},Ce=async function(l){const t=new Map;t.set("online",e.value.online),t.set("survey_id",e.value.id),await d.changeStatusSurvey(t).then(()=>{k(a,{message:"Survey status changed correctly",title:""})})};return Le(async()=>{Z(),o.value=j.params.id+"",o.value!=""&&o.value!="undefined"?(Y(o.value),q.value[0]={label:"Edit survey"}):(q.value[0]={label:"New survey"},e.value.country_id=G.value.id,e.value.country=G.value,y.value=G.value.default_language_code+"")}),{home:H,items:q,tmp_survey:e,filteredSurveys:J,allSurveys:ie,filters:ne,allGroups:ce,newUser:O,showCheckboxAll:F,showSelectClusters:w,showSelectGroups:g,uploadedFile:N,surveyTypology:re,newAnswer:b,editingRows:Q,userRoles:de,selectedLang:y,question:u,audienceCard:D,uploadImageCard:I,saveSurvey:ye,validateField:S,fetchAllSurveys:Z,setSelected:fe,onSelectedFiles:pe,addAnswer:ge,onRowEditSave:be,populateSelectLanguages:ee,deleteAnswer:he,getTooltipValue:Se,changeStatus:Ce}},components:{AudienceCard:Me,UploadImageCard:Ge}},Oe={class:"m-4"},Qe={class:"flex justify-content-between align-items-center mb-3"},Ye={class:"flex align-items-center justify-content-between"},Ke=s("h2",{class:"mb-2"},"SURVEY DETAILS",-1),Pe={class:"formgrid grid col-10 px-0"},We={class:"field col-3"},He=s("label",{for:"name"},"Active from*",-1),Je={key:0,class:"p-error"},Xe={class:"field col-3"},Ze=s("label",{for:"name"},"Active to*",-1),$e={key:0,class:"p-error"},et={class:"field col-4"},tt=s("label",{for:"name"},"Visible until*",-1),at={key:0,class:"p-error"},lt={class:"flex align-items-center justify-content-between"},ot=s("h2",{class:"mb-3"},"QUESTION AND ANSWERS",-1),st={class:"formgrid grid col-12 px-0 align-items-center"},nt={class:"field col-4"},rt={for:"note"},it={class:"uppercase"},dt={key:0,class:"p-error"},ct={class:"field col-4 flex flex-column"},ut=s("label",{for:"typology"},"Typology*",-1),vt={key:0,class:"p-error"},mt={class:"formgrid grid col-12 px-0 align-items-center"},_t={key:0,class:"field col-5 flex flex-column mt-4"},yt={class:"field flex align-items-center"},ft={class:"field col-8 p-0"},pt={for:"answer"},gt={class:"uppercase"},ht={key:0,class:"p-error"},wt={key:0},bt={key:1},St={class:"flex p-4 align-items-center"},Ct={class:"pl-2"};function Vt(H,o,q,e,J,B){const O=m("Breadcrumb"),F=m("Button"),w=m("InputSwitch"),g=m("Calendar"),N=m("Card"),b=m("AudienceCard"),Q=m("UploadImageCard"),y=m("Dropdown"),u=m("InputText"),U=m("Column"),D=m("DataTable"),I=m("ConfirmPopup"),j=Ue("tooltip");return c(),p(De,null,[s("div",Oe,[s("div",Qe,[r(O,{home:e.home,model:e.items,class:"mt-0 p-0"},null,8,["home","model"]),r(F,{label:"Save",onClick:e.saveSurvey},null,8,["onClick"])]),r(N,null,{content:C(()=>[s("div",Ye,[Ke,E(r(w,{modelValue:e.tmp_survey.online,"onUpdate:modelValue":o[0]||(o[0]=a=>e.tmp_survey.online=a),onChange:o[1]||(o[1]=a=>e.changeStatus(a)),disabled:!e.tmp_survey.id},null,8,["modelValue","disabled"]),[[j,{value:e.getTooltipValue()},void 0,{top:!0}]])]),s("div",Pe,[s("div",We,[He,r(g,{inputId:"dateformat",modelValue:e.tmp_survey.active_from,"onUpdate:modelValue":o[2]||(o[2]=a=>e.tmp_survey.active_from=a),dateFormat:"dd/mm/yy",manualInput:!1,class:V({"p-invalid":e.validateField(e.tmp_survey.active_from)}),placeholder:"gg/mm/aaaa"},null,8,["modelValue","class"]),e.validateField(e.tmp_survey.active_from)?(c(),p("small",Je,"Campo obbligatorio.")):h("",!0)]),s("div",Xe,[Ze,r(g,{inputId:"dateformat",modelValue:e.tmp_survey.active_to,"onUpdate:modelValue":o[3]||(o[3]=a=>e.tmp_survey.active_to=a),dateFormat:"dd/mm/yy",manualInput:!1,class:V({"p-invalid":e.validateField(e.tmp_survey.active_to)})},null,8,["modelValue","class"]),e.validateField(e.tmp_survey.active_to)?(c(),p("small",$e,"Campo obbligatorio.")):h("",!0)]),s("div",et,[tt,r(g,{inputId:"dateformat",modelValue:e.tmp_survey.hidden_at,"onUpdate:modelValue":o[4]||(o[4]=a=>e.tmp_survey.hidden_at=a),dateFormat:"dd/mm/yy",manualInput:!1,class:V({"p-invalid":e.validateField(e.tmp_survey.hidden_at)})},null,8,["modelValue","class"]),e.validateField(e.tmp_survey.hidden_at)?(c(),p("small",at,"Campo obbligatorio.")):h("",!0)])])]),_:1}),E(r(b,{ref:"audienceCard"},null,512),[[W,e.tmp_survey.country]]),E(r(Q,{title:"SURVEY IMAGE",videoUrl:!1,ref:"uploadImageCard"},null,512),[[W,e.tmp_survey.country]]),E(r(N,{class:"mt-4"},{content:C(()=>[s("div",lt,[ot,e.tmp_survey.country&&e.tmp_survey.country.language_codes&&e.tmp_survey.country.language_codes.length>1?(c(),z(y,{key:0,modelValue:e.selectedLang,"onUpdate:modelValue":o[5]||(o[5]=a=>e.selectedLang=a),options:e.tmp_survey.country.language_codes,class:"capitalize"},null,8,["modelValue","options"])):h("",!0)]),s("div",st,[s("div",nt,[s("label",rt,[ae("Question* "),s("span",it,"("+R(e.selectedLang)+")",1)]),r(u,{type:"text",modelValue:e.question[e.selectedLang],"onUpdate:modelValue":o[6]||(o[6]=a=>e.question[e.selectedLang]=a),class:V(["w-full",{"p-invalid":e.validateField(e.question[e.selectedLang])}])},null,8,["modelValue","class"]),e.validateField(e.question[e.selectedLang])?(c(),p("small",dt,"Campo obbligatorio.")):h("",!0)]),s("div",ct,[ut,r(y,{modelValue:e.tmp_survey.typology,"onUpdate:modelValue":o[7]||(o[7]=a=>e.tmp_survey.typology=a),options:e.surveyTypology,optionLabel:"label",optionValue:"value",placeholder:"",class:V(["capitalize",{"p-invalid":e.validateField(e.tmp_survey.typology)}])},null,8,["modelValue","options","class"]),e.validateField(e.tmp_survey.typology)?(c(),p("small",vt,"Campo obbligatorio.")):h("",!0)])]),s("div",mt,[e.tmp_survey.typology=="closed"?(c(),p("div",_t,[s("div",yt,[s("div",ft,[s("label",pt,[ae("Answer* "),s("span",gt,"("+R(e.selectedLang)+")",1)]),r(u,{type:"text",modelValue:e.newAnswer,"onUpdate:modelValue":o[8]||(o[8]=a=>e.newAnswer=a),class:V(["w-full",{"p-invalid":e.tmp_survey.answers&&e.tmp_survey.answers.length<1&&e.validateField(e.newAnswer)}]),id:"answer"},null,8,["modelValue","class"]),e.tmp_survey.answers&&e.tmp_survey.answers.length<1&&e.validateField(e.newAnswer)?(c(),p("small",ht,"Campo obbligatorio.")):h("",!0)]),r(F,{label:"Add answer",class:"p-button-outlined ml-3 mt-2",onClick:e.addAnswer,disabled:!e.newAnswer},null,8,["onClick","disabled"])]),e.tmp_survey.answers&&e.tmp_survey.answers.length>0?(c(),z(D,{key:0,value:e.tmp_survey.answers,responsiveLayout:"scroll",editMode:"row",dataKey:"id",editingRows:e.editingRows,"onUpdate:editingRows":o[9]||(o[9]=a=>e.editingRows=a),onRowEditSave:e.onRowEditSave},{default:C(()=>[r(U,{field:"",header:e.selectedLang.toUpperCase()},{body:C(({data:a})=>[a.translations[e.selectedLang]&&(a.translations[e.selectedLang].text||a.translations[e.selectedLang].text=="")?(c(),p("span",wt,R(a.translations[e.selectedLang].text),1)):(c(),p("span",bt,R(a.translations[e.selectedLang]),1))]),editor:C(({data:a})=>[a.translations[e.selectedLang]&&(a.translations[e.selectedLang].text||a.translations[e.selectedLang].text=="")?(c(),z(u,{key:0,modelValue:a.translations[e.selectedLang].text,"onUpdate:modelValue":d=>a.translations[e.selectedLang].text=d,autofocus:""},null,8,["modelValue","onUpdate:modelValue"])):(c(),z(u,{key:1,modelValue:a.translations[e.selectedLang],"onUpdate:modelValue":d=>a.translations[e.selectedLang]=d},null,8,["modelValue","onUpdate:modelValue"]))]),_:1},8,["header"]),r(U,{rowEditor:!0,style:{width:"10%","min-width":"8rem"},bodyStyle:"text-align:center"}),r(U,{header:"",style:{width:"9rem"},rowEditor:!0},{body:C(({data:a,index:d})=>[E(r(F,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-3",icon:"pi pi-trash",onClick:X=>e.deleteAnswer(a.id,d)},null,8,["onClick"]),[[j,"Delete",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","editingRows","onRowEditSave"])):h("",!0)])):h("",!0)])]),_:1},512),[[W,e.selectedLang]])]),r(I,null,{message:C(a=>[s("div",St,[s("i",{class:V(a.message.icon),style:{"font-size":"1.5rem"}},null,2),s("p",Ct,R(a.message.message),1)])]),_:1})],64)}const qt=Fe(ze,[["render",Vt]]);export{qt as default};
