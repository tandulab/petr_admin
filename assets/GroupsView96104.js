import{a as A}from"./api.esm96104.js";import{u as K,e as q,r as z}from"./usetoast.esm96104.js";import{u as I}from"./useconfirm.esm96104.js";import"./user96104.js";import{u as O}from"./country96104.js";import{e as x,a as R}from"./helpers96104.js";import{u as D}from"./group96104.js";import{ad as $,c as y,r as _,_ as k,a as c,i as j,o as b,b as G,f as n,q as v,y as T,t as M,w as S,e as F}from"./_plugin-vue_export-helper96104.js";import{w as L}from"./runtime-dom.esm-bundler96104.js";const H={setup(){$(()=>{m.value=!0,r.value={first:0,rows:p.value.rows,sortField:null,sortOrder:null,filters:d.value},A.register("myfilter",(e,i)=>e===i),u()});const l=D(),s=O(),h=K(),t=I(),w=y(()=>l.responseGroups),C=y(()=>s.allCountries);y(()=>h.getUserCountryId);const g=y(()=>h.getSelectedCountry),a=q(),p=_(),d=_({name:{value:"",matchMode:"contains"}}),m=_(!0),r=_(),o=_(0),f=_([{label:"My Filter",value:"myfilter"}]);function u(){m.value=!0;const e=new Map;e.set("country_id",g.value.id),e.set("name",d.value.name.value),e.set("page",r.value.page+1),e.set("per_page",r.value.rows),r.value.sortField&&(r.value.sortOrder==1?e.set("sorted_by",r.value.sortField+"_asc"):e.set("sorted_by",r.value.sortField+"_desc")),setTimeout(()=>{V(e)},Math.random()*1e3+250)}const V=async function(e){await l.fetchAllGroups(e).then(()=>{m.value=!1}).catch(i=>{m.value=!1,x(a,i)})},B=e=>{r.value=e,u()},U=e=>{r.value=e,u()},P=()=>{r.value.page=0,r.value.filters=d.value,u()},E=(e,i)=>{i.users_counter>0?t.require({target:e.currentTarget,message:"The group cannot be deleted because there are associated users.",icon:"pi pi-exclamation-triangle",rejectClass:"hidden",acceptClass:"hidden"}):t.require({target:e.currentTarget,message:"Are you sure you want to remove this group?",icon:"pi pi-exclamation-triangle",accept:()=>{N(i.id)}})},N=async function(e){await l.deleteGroup(e).then(()=>{R(a,{message:"Group deleted correctly.",title:""})}).catch(i=>{x(a,i)})};return{dt:p,responseGroups:w,filters:d,loading:m,totalRecords:o,lazyParams:r,loadLazyData:u,matchModes:f,countries:C,onPage:B,onSort:U,onFilter:P,toggleEdit:function(e){z.push({name:"group-detail",params:{id:e.id}})},confirmDeleteGroup:E}}};function J(l,s,h,t,w,C){const g=c("InputText"),a=c("Column"),p=c("Button"),d=c("DataTable"),m=c("ConfirmPopup"),r=j("tooltip");return b(),G("div",null,[n(d,{value:t.responseGroups.user_groups,lazy:!0,paginator:!0,rows:30,filters:t.filters,"onUpdate:filters":s[0]||(s[0]=o=>t.filters=o),ref:"dt",dataKey:"id",loading:t.loading,totalRecords:t.responseGroups.total,onPage:s[1]||(s[1]=o=>t.onPage(o)),onSort:s[2]||(s[2]=o=>t.onSort(o)),onFilter:s[3]||(s[3]=o=>t.onFilter()),filterDisplay:"row",removableSort:""},{empty:v(()=>[T(" No groups found. ")]),default:v(()=>[n(a,{field:"name",header:"Name",filterMatchMode:"contains",ref:"name",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:v(({filterModel:o,filterCallback:f})=>[n(g,{type:"text",modelValue:o.value,"onUpdate:modelValue":u=>o.value=u,onKeydown:L(u=>f(),["enter"]),class:"p-column-filter",placeholder:"Filter by name"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),n(a,{field:"description",header:"Description"}),n(a,{header:"Users"},{body:v(({data:o})=>[T(M(o.users_counter),1)]),_:1}),n(a,{header:"",style:{width:"9rem"}},{body:v(({data:o})=>[S(n(p,{type:"button",onClick:f=>t.toggleEdit(o),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-3",icon:"pi pi-pencil"},null,8,["onClick"]),[[r,"Edit",void 0,{top:!0}]]),S(n(p,{type:"button",onClick:f=>t.confirmDeleteGroup(f,o),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-3",icon:"pi pi-trash"},null,8,["onClick"]),[[r,"Delete",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","filters","loading","totalRecords"]),n(m)])}const Q=k(H,[["render",J]]),W={setup(){const l=D();return{totalGroup:y(()=>l.getTotalGroups)}},components:{GroupsTable:Q}},X={class:"flex justify-content-between align-items-center"},Y={class:"uppercase"},Z={key:0},ee={key:1};function te(l,s,h,t,w,C){const g=c("Button"),a=c("GroupsTable"),p=c("Card");return b(),G("div",null,[n(p,null,{content:v(()=>[F("div",X,[F("h1",Y,[t.totalGroup==1?(b(),G("span",Z," 1 Group")):(b(),G("span",ee,M(t.totalGroup)+" Groups",1))]),n(g,{label:"group",onClick:s[0]||(s[0]=d=>l.$router.push("/group-detail")),icon:"pi pi-plus",class:"mb-3"})]),n(a)]),_:1})])}const de=k(W,[["render",te]]);export{de as default};
