import{ab as P,u as A,c as k,ac as M,r as y,a as G,_ as U,b as d,k as H,o as c,e as i,g as u,v,B as S,F as j,A as z,x as V,i as F,w as J,n as K,f as b,l as O}from"./usetoast.esm40966.js";import{u as E}from"./useconfirm.esm40966.js";import{u as B}from"./category40966.js";import{f as Q}from"./formatData40966.js";import{e as L,a as I,s as R,h as q}from"./helpers40966.js";import"./datetime40966.js";const W={setup(x,m){P(()=>{n()});const o=B(),e=E(),C=A(),f=k(()=>C.getSelectedCountry),p=k(()=>o.allCategories),a=M(),l=y(!0),_=y([{label:"My Filter",value:"myfilter"}]);function n(){l.value=!0,setTimeout(()=>{t()},Math.random()*1e3+250)}const t=async function(){const r=new Map;r.set("country_id",f.value.id),await o.fetchAllCategories(r).then(()=>{l.value=!1}).catch(g=>{l.value=!1,L(a,g)})},s=(r,g)=>{g.users_counter>0?e.require({target:r.currentTarget,message:"The category cannot be deleted because there are associated users.",icon:"pi pi-exclamation-triangle",rejectClass:"hidden",acceptClass:"hidden"}):e.require({target:r.currentTarget,message:"Are you sure you want to remove this category?",icon:"pi pi-exclamation-triangle",accept:()=>{D(g.id)}})},D=async function(r){await o.deleteCategory(r).then(()=>{I(a,{message:"Category deleted correctly.",title:""}),n()}).catch(g=>{L(a,g)})},h=function(r){G.push({name:"category-detail",params:{id:r.id}})};return m.expose({loadLazyData:n}),{categories:p,loading:l,loadLazyData:n,matchModes:_,toggleEdit:h,confirmDeleteCategory:s,formatDataFromSql:Q}}};const X={class:"col-5 col-xs-12 col-md-12"},Y={key:0};function Z(x,m,o,e,C,f){const p=d("Column"),a=d("Button"),l=d("DataTable"),_=d("ConfirmPopup"),n=H("tooltip");return c(),i("div",X,[u(l,{value:e.categories,lazy:!0,loading:e.loading},{empty:v(()=>[S(" No categories found. ")]),default:v(()=>[u(p,{field:"translations",header:"Name"},{body:v(({data:t})=>[(c(!0),i(j,null,z(t.country.language_codes,s=>(c(),i("span",{key:s,class:"name"},[t.translations[s]&&t.translations[s].name?(c(),i("span",Y,V(t.translations[s].name.text),1)):F("",!0)]))),128))]),_:1}),u(p,{header:"",style:{width:"9rem"}},{body:v(({data:t})=>[J(u(a,{type:"button",onClick:s=>e.confirmDeleteCategory(s,t),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-3",icon:"pi pi-trash",disabled:!t.can_delete},null,8,["onClick","disabled"]),[[n,"Delete",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","loading"]),u(_)])}const $=U(W,[["render",Z]]),ee={setup(){const x=B(),m=E(),o=y({}),e=y({}),C=A(),f=M(),p=B(),a=y(!1),l=y(!1),_=y(),n=y(),t=k(()=>x.getTotalCategories),s=k(()=>C.getSelectedCountry),D=()=>{m.require({group:"templating",header:"New Category",accept:()=>{if(a.value=!0,r(e.value[n.value]))a.value=!1,h();else{a.value=!1,g();return}},reject:()=>{a.value=!1,l.value=!1,h()},acceptLabel:"Save",rejectLabel:"Cancel"})},h=function(){e.value[n.value]=""},r=function(T){return a.value?T==""||T==null:!1},g=async function(){var N;R(),o.value.translations={};for(const w in e.value)o.value.translations[w]={name:e.value[w]};o.value.country_id=(N=o.value.country)==null?void 0:N.id;const T={news_category:o.value};p.createCategory(T).then(()=>{q(),I(f,{message:"Category created correctly.",title:""}),_.value.loadLazyData(),a.value=!1,h()}).catch(w=>{q(),L(f,w),a.value=!1})};return K(async()=>{o.value.country=s.value,n.value=s.value.default_language_code}),{totalCategory:t,confirm:m,tmp_category:o,labels:e,categoriesTable:_,showTemplate:D,validateField:r,isVisible:l}},components:{CategoriesTable:$}},te={class:"flex justify-content-between align-items-center"},ae={class:"uppercase"},oe={key:0},se={key:1},ne={key:0,class:"formgrid grid col-12"},re={class:"field col-12 flex p-0 flex-column"},le={for:"name"},ce={class:"uppercase"},ie={key:0,class:"p-error"};function ue(x,m,o,e,C,f){const p=d("Button"),a=d("CategoriesTable"),l=d("InputText"),_=d("ConfirmDialog"),n=d("Card");return c(),i("div",null,[u(n,null,{content:v(()=>[b("div",te,[b("h1",ae,[e.totalCategory==1?(c(),i("span",oe," 1 Category")):(c(),i("span",se,V(e.totalCategory)+" Categories",1))]),u(p,{label:"category",onClick:m[0]||(m[0]=t=>e.showTemplate()),icon:"pi pi-plus",class:"mb-3"})]),u(a,{ref:"categoriesTable"},null,512),u(_,{group:"templating",style:{width:"20vw"}},{message:v(()=>[e.tmp_category.country?(c(),i("div",ne,[b("div",re,[(c(!0),i(j,null,z(e.tmp_category.country.language_codes,t=>(c(),i("div",{key:t,class:"col-12 mb-4"},[b("label",le,[S("Name "),b("span",ce,"("+V(t)+")",1),S("*")]),u(l,{id:"name",type:"text",modelValue:e.labels[t],"onUpdate:modelValue":s=>e.labels[t]=s,class:O(["w-full",{"p-invalid":e.validateField(e.tmp_category.name)}]),require:""},null,8,["modelValue","onUpdate:modelValue","class"]),e.validateField(e.tmp_category.name)?(c(),i("small",ie,"Campo obbligatorio.")):F("",!0)]))),128))])])):F("",!0)]),_:1})]),_:1})])}const fe=U(ee,[["render",ue]]);export{fe as default};
