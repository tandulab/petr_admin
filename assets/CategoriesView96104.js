import{u as j,e as M,r as P}from"./usetoast.esm96104.js";import{u as U}from"./useconfirm.esm96104.js";import{u as S}from"./category96104.js";import{f as G}from"./formatData96104.js";import{e as V,a as z,s as H,h as q}from"./helpers96104.js";import{ad as J,c as k,r as y,_ as A,a as d,i as K,o as c,b as i,f as u,q as v,y as F,F as E,x as I,t as L,h as N,w as O,n as Q,e as b,j as R}from"./_plugin-vue_export-helper96104.js";import"./datetime96104.js";const W={setup(x,m){J(()=>{n()});const a=S(),e=U(),C=j(),f=k(()=>C.getSelectedCountry),p=k(()=>a.allCategories),o=M(),l=y(!0),_=y([{label:"My Filter",value:"myfilter"}]);function n(){l.value=!0,setTimeout(()=>{t()},Math.random()*1e3+250)}const t=async function(){const r=new Map;r.set("country_id",f.value.id),await a.fetchAllCategories(r).then(()=>{l.value=!1}).catch(g=>{l.value=!1,V(o,g)})},s=(r,g)=>{g.users_counter>0?e.require({target:r.currentTarget,message:"The category cannot be deleted because there are associated users.",icon:"pi pi-exclamation-triangle",rejectClass:"hidden",acceptClass:"hidden"}):e.require({target:r.currentTarget,message:"Are you sure you want to remove this category?",icon:"pi pi-exclamation-triangle",accept:()=>{D(g.id)}})},D=async function(r){await a.deleteCategory(r).then(()=>{z(o,{message:"Category deleted correctly.",title:""}),n()}).catch(g=>{V(o,g)})},h=function(r){P.push({name:"category-detail",params:{id:r.id}})};return m.expose({loadLazyData:n}),{categories:p,loading:l,loadLazyData:n,matchModes:_,toggleEdit:h,confirmDeleteCategory:s,formatDataFromSql:G}}};const X={class:"col-5 col-xs-12 col-md-12"},Y={key:0};function Z(x,m,a,e,C,f){const p=d("Column"),o=d("Button"),l=d("DataTable"),_=d("ConfirmPopup"),n=K("tooltip");return c(),i("div",X,[u(l,{value:e.categories,lazy:!0,loading:e.loading},{empty:v(()=>[F(" No categories found. ")]),default:v(()=>[u(p,{field:"translations",header:"Name"},{body:v(({data:t})=>[(c(!0),i(E,null,I(t.country.language_codes,s=>(c(),i("span",{key:s,class:"name"},[t.translations[s]&&t.translations[s].name?(c(),i("span",Y,L(t.translations[s].name.text),1)):N("",!0)]))),128))]),_:1}),u(p,{header:"",style:{width:"9rem"}},{body:v(({data:t})=>[O(u(o,{type:"button",onClick:s=>e.confirmDeleteCategory(s,t),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-3",icon:"pi pi-trash",disabled:!t.can_delete},null,8,["onClick","disabled"]),[[n,"Delete",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","loading"]),u(_)])}const $=A(W,[["render",Z]]),ee={setup(){const x=S(),m=U(),a=y({}),e=y({}),C=j(),f=M(),p=S(),o=y(!1),l=y(!1),_=y(),n=y(),t=k(()=>x.getTotalCategories),s=k(()=>C.getSelectedCountry),D=()=>{m.require({group:"templating",header:"New Category",accept:()=>{if(o.value=!0,r(e.value[n.value]))o.value=!1,h();else{o.value=!1,g();return}},reject:()=>{o.value=!1,l.value=!1,h()},acceptLabel:"Save",rejectLabel:"Cancel"})},h=function(){e.value[n.value]=""},r=function(T){return o.value?T==""||T==null:!1},g=async function(){var B;H(),a.value.translations={};for(const w in e.value)a.value.translations[w]={name:e.value[w]};a.value.country_id=(B=a.value.country)==null?void 0:B.id;const T={news_category:a.value};p.createCategory(T).then(()=>{q(),z(f,{message:"Category created correctly.",title:""}),_.value.loadLazyData(),o.value=!1,h()}).catch(w=>{q(),V(f,w),o.value=!1})};return Q(async()=>{a.value.country=s.value,n.value=s.value.default_language_code}),{totalCategory:t,confirm:m,tmp_category:a,labels:e,categoriesTable:_,showTemplate:D,validateField:r,isVisible:l}},components:{CategoriesTable:$}},te={class:"flex justify-content-between align-items-center"},oe={class:"uppercase"},ae={key:0},se={key:1},ne={key:0,class:"formgrid grid col-12"},re={class:"field col-12 flex p-0 flex-column"},le={for:"name"},ce={class:"uppercase"},ie={key:0,class:"p-error"};function ue(x,m,a,e,C,f){const p=d("Button"),o=d("CategoriesTable"),l=d("InputText"),_=d("ConfirmDialog"),n=d("Card");return c(),i("div",null,[u(n,null,{content:v(()=>[b("div",te,[b("h1",oe,[e.totalCategory==1?(c(),i("span",ae," 1 Category")):(c(),i("span",se,L(e.totalCategory)+" Categories",1))]),u(p,{label:"category",onClick:m[0]||(m[0]=t=>e.showTemplate()),icon:"pi pi-plus",class:"mb-3"})]),u(o,{ref:"categoriesTable"},null,512),u(_,{group:"templating",style:{width:"20vw"}},{message:v(()=>[e.tmp_category.country?(c(),i("div",ne,[b("div",re,[(c(!0),i(E,null,I(e.tmp_category.country.language_codes,t=>(c(),i("div",{key:t,class:"col-12 mb-4"},[b("label",le,[F("Name "),b("span",ce,"("+L(t)+")",1),F("*")]),u(l,{id:"name",type:"text",modelValue:e.labels[t],"onUpdate:modelValue":s=>e.labels[t]=s,class:R(["w-full",{"p-invalid":e.validateField(e.tmp_category.name)}]),require:""},null,8,["modelValue","onUpdate:modelValue","class"]),e.validateField(e.tmp_category.name)?(c(),i("small",ie,"Campo obbligatorio.")):N("",!0)]))),128))])])):N("",!0)]),_:1})]),_:1})])}const ve=A(ee,[["render",ue]]);export{ve as default};
