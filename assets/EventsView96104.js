import{a as z}from"./api.esm96104.js";import{u as A,e as $,r as L}from"./usetoast.esm96104.js";import{u as O}from"./useconfirm.esm96104.js";import"./country96104.js";import{u as V}from"./events96104.js";import{f as R}from"./formatData96104.js";import{e as D,a as j}from"./helpers96104.js";import{ad as K,c as g,r as f,_ as B,a as c,i as G,o as h,b,f as n,q as u,y as T,t as E,h as k,j as H,w as M,e as x}from"./_plugin-vue_export-helper96104.js";import"./datetime96104.js";const I={setup(){K(()=>{i.value=!0,a.value={first:0,rows:v.value.rows,sortField:null,sortOrder:null,filters:d.value},z.register("myfilter",(t,p)=>t===p),e()});const l=V(),s=O(),w=A(),o=g(()=>l.responseEvents),C=g(()=>w.getSelectedCountry),S=g(()=>l.eventsStatus),r=$(),v=f(),d=f({status:{value:"",matchMode:"contains"}}),i=f(!0),a=f(),F=f(0),_=f([{label:"My Filter",value:"myfilter"}]);function e(){i.value=!0;const t=new Map;t.set("country_id",C.value.id),t.set("status",d.value.status.value),t.set("page",a.value.page+1),t.set("per_page",a.value.rows),a.value.sortField&&(a.value.sortOrder==1?t.set("sorted_by",a.value.sortField+"_asc"):t.set("sorted_by",a.value.sortField+"_desc")),setTimeout(()=>{m(t)},Math.random()*1e3+250)}const m=async function(t){await l.fetchAllEvents(t).then(()=>{i.value=!1}).catch(p=>{i.value=!1,D(r,p)})},y=t=>{a.value=t,e()},P=t=>{a.value=t,e()},N=()=>{a.value.page=0,a.value.filters=d.value,e()},U=(t,p)=>{s.require({target:t.currentTarget,message:"Are you sure you want to remove this event?",icon:"pi pi-exclamation-triangle",accept:()=>{q(p.id)}})},q=async function(t){await l.deleteEvents(t).then(()=>{j(r,{message:"Event deleted correctly.",title:""}),e()}).catch(p=>{D(r,p)})};return{dt:v,responseEvents:o,filters:d,loading:i,totalRecords:F,lazyParams:a,loadLazyData:e,matchModes:_,eventsStatus:S,onPage:y,onSort:P,onFilter:N,toggleEdit:function(t){L.push({name:"event-detail",params:{id:t.id}})},confirmDeleteEvents:U,formatDataFromSql:R}}};const J={key:0},Q={key:0};function W(l,s,w,o,C,S){const r=c("Column"),v=c("Badge"),d=c("Dropdown"),i=c("Button"),a=c("DataTable"),F=c("ConfirmPopup"),_=G("tooltip");return h(),b("div",null,[n(a,{value:o.responseEvents.events,lazy:!0,paginator:!0,rows:30,filters:o.filters,"onUpdate:filters":s[0]||(s[0]=e=>o.filters=e),ref:"dt",dataKey:"id",loading:o.loading,totalRecords:o.responseEvents.total,onPage:s[1]||(s[1]=e=>o.onPage(e)),onSort:s[2]||(s[2]=e=>o.onSort(e)),onFilter:s[3]||(s[3]=e=>o.onFilter()),filterDisplay:"row",removableSort:""},{empty:u(()=>[T(" No events found. ")]),default:u(()=>[n(r,{filed:"",header:"Title"},{body:u(({data:e})=>[e.translations[e.country.default_language_code].title?(h(),b("span",J,E(e.translations[e.country.default_language_code].title.text),1)):k("",!0)]),_:1}),n(r,{header:"Event date",field:"date",sortable:!0},{body:u(({data:e})=>[T(E(o.formatDataFromSql(e.date)),1)]),_:1}),n(r,{header:"Location",field:"location"}),n(r,{header:"Participants",field:""},{body:u(({data:e})=>[e.seats!=null?(h(),b("span",Q,E(e.participants/e.seats),1)):k("",!0)]),_:1}),n(r,{header:"Status",field:"status",ref:"status",filterMatchMode:"contains",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:u(({data:e})=>[n(v,{value:e.status,class:H(["px-4 border-round-lg",e.status])},null,8,["value","class"])]),filter:u(({filterModel:e,filterCallback:m})=>[n(d,{modelValue:e.value,"onUpdate:modelValue":y=>e.value=y,options:o.eventsStatus,optionValue:"value",optionLabel:"name",onChange:y=>m(),placeholder:"Filter by status"},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1},512),n(r,{header:"",style:{width:"9rem"}},{body:u(({data:e})=>[M(n(i,{type:"button",onClick:m=>o.toggleEdit(e),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-3",icon:"pi pi-pencil"},null,8,["onClick"]),[[_,"Edit",void 0,{top:!0}]]),M(n(i,{type:"button",onClick:m=>o.confirmDeleteEvents(m,e),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-3",icon:"pi pi-trash"},null,8,["onClick"]),[[_,"Delete",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","filters","loading","totalRecords"]),n(F)])}const X=B(I,[["render",W]]),Y={setup(){const l=V();return{totalEvents:g(()=>l.getTotalEvents)}},components:{EventsTable:X}},Z={class:"flex justify-content-between align-items-center"},ee={class:"uppercase"};function te(l,s,w,o,C,S){const r=c("Button"),v=c("EventsTable"),d=c("Card");return h(),b("div",null,[n(d,null,{content:u(()=>[x("div",Z,[x("h1",ee,[x("span",null,E(o.totalEvents)+" Events",1)]),n(r,{label:"event",onClick:s[0]||(s[0]=i=>l.$router.push("/event-detail")),icon:"pi pi-plus",class:"mb-3"})]),n(v)]),_:1})])}const pe=B(Y,[["render",te]]);export{pe as default};
