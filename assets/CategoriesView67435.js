import{ab as K,u as M,c as S,ac as U,r as u,_ as I,b as y,k as O,o as d,e as m,g as p,v as h,B as P,F as G,A as H,x as N,i as j,w as E,n as Q,f as T,l as R}from"./usetoast.esm67435.js";import{u as J}from"./useconfirm.esm67435.js";import{u as q}from"./category67435.js";import{f as W}from"./formatData67435.js";import{e as F,a as A,s as z,h as D}from"./helpers67435.js";import"./datetime67435.js";const X={setup(w,c){K(()=>{n()});const s=q(),e=J(),b=M(),f=S(()=>b.getSelectedCountry),g=S(()=>s.allCategories),t=U(),i=u(!0),v=u([{label:"My Filter",value:"myfilter"}]),l=u(!1);u({}),u();const a=u(!1);function n(){i.value=!0,setTimeout(()=>{L()},Math.random()*1e3+250)}const L=async function(){const r=new Map;r.set("country_id",f.value.id),await s.fetchAllCategories(r).then(()=>{i.value=!1}).catch(o=>{i.value=!1,F(t,o)})},V=(r,o)=>{o.users_counter>0?e.require({target:r.currentTarget,message:"The category cannot be deleted because there are associated users.",icon:"pi pi-exclamation-triangle",rejectClass:"hidden",acceptClass:"hidden"}):e.require({target:r.currentTarget,message:"Are you sure you want to remove this category?",icon:"pi pi-exclamation-triangle",accept:()=>{C(o.id)}})},C=async function(r){await s.deleteCategory(r).then(()=>{A(t,{message:"Category deleted correctly.",title:""}),n()}).catch(o=>{F(t,o)})},x=function(r){return l.value?r==""||r==null:!1},B=r=>{c.emit("editCategory",r)};return c.expose({loadLazyData:n}),{categories:g,loading:i,loadLazyData:n,matchModes:v,toggleEdit:B,confirmDeleteCategory:V,formatDataFromSql:W,isVisible:a,validateField:x}}};const Y={class:"col-5 col-xs-12 col-md-12"},Z={key:0};function $(w,c,s,e,b,f){const g=y("Column"),t=y("Button"),i=y("DataTable"),v=y("ConfirmPopup"),l=O("tooltip");return d(),m("div",Y,[p(i,{value:e.categories,lazy:!0,loading:e.loading},{empty:h(()=>[P(" No categories found. ")]),default:h(()=>[p(g,{field:"translations",header:"Name"},{body:h(({data:a})=>[(d(!0),m(G,null,H(a.country.language_codes,n=>(d(),m("span",{key:n,class:"name"},[a.translations[n]&&a.translations[n].name?(d(),m("span",Z,N(a.translations[n].name.text),1)):j("",!0)]))),128))]),_:1}),p(g,{header:"",style:{width:"9rem"}},{body:h(({data:a})=>[E(p(t,{type:"button",onClick:n=>e.toggleEdit(a),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-3",icon:"pi pi-pencil"},null,8,["onClick"]),[[l,"Edit",void 0,{top:!0}]]),E(p(t,{type:"button",onClick:n=>e.confirmDeleteCategory(n,a),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-3",icon:"pi pi-trash",disabled:!a.can_delete},null,8,["onClick","disabled"]),[[l,"Delete",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","loading"]),p(v)])}const ee=I(X,[["render",$]]),te={setup(){const w=q(),c=J(),s=u({}),e=u({}),b=M(),f=U(),g=q(),t=u(!1),i=u(!1),v=u(),l=u(),a=S(()=>w.getTotalCategories),n=S(()=>b.getSelectedCountry),L=o=>{o?V(o):c.require({group:"templating",header:"New Category",accept:()=>{if(t.value=!0,x(e.value[l.value]))t.value=!1,C();else{t.value=!1,B();return}},reject:()=>{t.value=!1,i.value=!1,C()},acceptLabel:"Save",rejectLabel:"Cancel"})},V=function(o){o.translations[l.value]&&o.translations[l.value].name.text&&(e.value[l.value]=o.translations[l.value].name.text+""),c.require({group:"templating",header:"Edit Category",accept:()=>{if(t.value=!0,x(e.value[l.value]))t.value=!1,C();else{t.value=!1,r(o.id);return}},reject:()=>{t.value=!1,i.value=!1,C()},acceptLabel:"Save",rejectLabel:"Cancel"})},C=function(){e.value[l.value]=""},x=function(o){return t.value?o==""||o==null:!1},B=async function(){var k;z(),s.value.translations={};for(const _ in e.value)s.value.translations[_]={name:e.value[_]};s.value.country_id=(k=s.value.country)==null?void 0:k.id;const o={news_category:s.value};g.createCategory(o).then(()=>{D(),A(f,{message:"Category created correctly.",title:""}),v.value.loadLazyData(),t.value=!1,C()}).catch(_=>{D(),F(f,_),t.value=!1})},r=async function(o){z(),s.value.translations={};for(const _ in e.value)s.value.translations[_]={name:e.value[_]};const k={id:s.value.translations[l.value].id,text:s.value};g.editCategory(k).then(()=>{D(),A(f,{message:"Category edited correctly",title:""}),v.value.loadLazyData(),t.value=!1,C()}).catch(_=>{D(),F(f,_),t.value=!1})};return Q(async()=>{s.value.country=n.value,l.value=n.value.default_language_code}),{totalCategory:a,confirm:c,tmp_category:s,labels:e,categoriesTable:v,showTemplate:L,validateField:x,isVisible:i}},components:{CategoriesTable:ee}},ae={class:"flex justify-content-between align-items-center"},oe={class:"uppercase"},se={key:0},ne={key:1},le={key:0,class:"formgrid grid col-12"},re={class:"field col-12 flex p-0 flex-column"},ce={for:"name"},ie={class:"uppercase"},ue={key:0,class:"p-error"};function de(w,c,s,e,b,f){const g=y("Button"),t=y("CategoriesTable"),i=y("InputText"),v=y("ConfirmDialog"),l=y("Card");return d(),m("div",null,[p(l,null,{content:h(()=>[T("div",ae,[T("h1",oe,[e.totalCategory==1?(d(),m("span",se," 1 Category")):(d(),m("span",ne,N(e.totalCategory)+" Categories",1))]),p(g,{label:"category",onClick:c[0]||(c[0]=a=>e.showTemplate(null)),icon:"pi pi-plus",class:"mb-3"})]),p(t,{ref:"categoriesTable",onEditCategory:c[1]||(c[1]=a=>e.showTemplate(a))},null,512),p(v,{group:"templating",style:{width:"20vw"}},{message:h(()=>[e.tmp_category.country?(d(),m("div",le,[T("div",re,[(d(!0),m(G,null,H(e.tmp_category.country.language_codes,a=>(d(),m("div",{key:a,class:"col-12 mb-4"},[T("label",ce,[P("Name "),T("span",ie,"("+N(a)+")",1)]),p(i,{id:"name",type:"text",modelValue:e.labels[a],"onUpdate:modelValue":n=>e.labels[a]=n,class:R(["w-full",{"p-invalid":e.validateField(e.tmp_category.name)}]),require:""},null,8,["modelValue","onUpdate:modelValue","class"]),e.validateField(e.tmp_category.name)?(d(),m("small",ue,"Campo obbligatorio.")):j("",!0)]))),128))])])):j("",!0)]),_:1})]),_:1})])}const fe=I(te,[["render",de]]);export{fe as default};
