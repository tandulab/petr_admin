import{u as re}from"./user40966.js";import{D as ce}from"./datetime40966.js";import{u as G}from"./useconfirm.esm40966.js";import{r as v,_ as O,b as f,k as de,o as i,e as a,f as t,x as k,w as Y,g as _,F as L,A as N,B as D,i as C,n as K,h as Q,v as F,ac as H,u as ue,p as pe,c as z,a as _e,l as me}from"./usetoast.esm40966.js";import{j as fe,k as he,s as W,h as S,a as P,e as j,l as ge,u as q,b as ve}from"./helpers40966.js";import{u as xe}from"./insight40966.js";import{u as ye}from"./product40966.js";import{u as be,U as ke}from"./UploadImageCard40966.js";const Ce={props:{target:Object},setup(){const b=G(),o=v({});return{confirm:b,insight:o}}};const we={key:0,class:"insight border-round-lg m-2 border-300 border-solid border-1 p-3 h-full pt-2"},Se={class:"flex align-items-center justify-content-between mb-2"},Ue={class:"my-0"},Ve={key:0},ze={key:1},De={class:"actions"},Fe={key:0,class:"text-sm"},Ie={class:"truncate-products"},Te={key:0},Ae={key:0},Be={class:"uppercase"},Re={key:1},Ee=t("p",{class:"text-center"},[t("i",null,"Insight not configured")],-1),Pe=[Ee];function je(b,o,l,e,m,w){const x=f("Button"),h=de("tooltip");return l.target?(i(),a("div",we,[t("div",Se,[t("h2",Ue,[l.target.quarter==0?(i(),a("span",Ve,"YEAR")):(i(),a("span",ze,"Q"+k(l.target.quarter),1))]),t("div",De,[Y(_(x,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-2",icon:"pi pi-pencil",onClick:o[0]||(o[0]=c=>b.$emit("open",l.target))},null,512),[[h,"Edit",void 0,{top:!0}]]),Y(_(x,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-0",icon:"pi ranking-icon",onClick:o[1]||(o[1]=c=>b.$emit("ranking",l.target))},null,512),[[h,"Ranking",void 0,{top:!0}]])])]),l.target.products.length>0||l.target.all_products?(i(),a("div",Fe,[t("div",Ie,[l.target.all_products?(i(),a("span",Te," All products ")):(i(!0),a(L,{key:1},N(l.target.products,(c,d)=>(i(),a("span",{key:c.id,class:"mb-1 inline-block mr-1 text-sm"},[d!=0?(i(),a("span",Ae," / ")):C("",!0),D(" "+k(c.name),1)]))),128))]),t("p",null,[D(" Units: "),t("span",Be,k(l.target.unit),1)])])):(i(),a("div",Re,Pe))])):C("",!0)}const Le=O(Ce,[["render",je]]),Ne={props:{title:String,tmp_insight:{}},setup(b,{emit:o}){return K(async()=>{}),{catchEvent:m=>{o("open",m)},catchEventRanking:m=>{o("ranking",m)}}},components:{InsightCard:Le}},Oe={class:"flex justify-content-between align-items-center"},Me={class:"uppercase"},qe={class:"grid col-12 mb-4"};function Je(b,o,l,e,m,w){const x=f("InsightCard"),h=f("Card");return i(),Q(h,{class:"mt-4"},{content:F(()=>[t("div",Oe,[t("h2",Me,k(l.title),1)]),t("div",qe,[(i(!0),a(L,null,N(l.tmp_insight,c=>(i(),a("div",{key:c,class:"flex-1"},[_(x,{target:c,onOpen:o[0]||(o[0]=d=>e.catchEvent(d)),onRanking:o[1]||(o[1]=d=>e.catchEventRanking(d))},null,8,["target"])]))),128))])]),_:1})}const Ye=O(Ne,[["render",Je]]),Ge={props:{title:String,videoUrl:Boolean},setup(b,o){const l=v({}),e=be(),m=H(),w=v(),x=d=>{l.value.file_url={},l.value.file=d.files[0]},h=()=>{const d=l.value.file_url.id;d?(W(),e.deleteAttachment(d).then(()=>{S(),P(m,{message:"File deleted correctly.",title:""}),c()}).catch(I=>{S(),j(m,I)})):c()},c=()=>{l.value={},w.value.files=[]};return o.expose({tmp_file:l}),{tmp_file:l,fileUpload:w,onSelectedFiles:x,deleteFile:h,formatSize:fe,getFileName:he,deleteTmpFile:c}}};const Ke={class:"flex align-items-center justify-content-between"},Qe={class:"mb-4"},He={class:"flex col-10"},We={class:"col-6 flex-column p-0"},Xe={key:0,class:"card m-0 flex border-1 surface-border align-items-center justify-content-between pl-4 pr-3 py-3 w-full my-2"},Ze={class:"flex align-items-center"},$e=t("i",{class:"pi pi-file text-2xl"},null,-1),et={key:0,class:"flex flex-column ml-2 file",style:{"font-size":"12px"}},tt={class:"mb-1"},ot={key:1,class:"flex flex-column ml-2 file",style:{"font-size":"12px"}},st={class:"mb-1"},nt={key:0,class:"text-center"},lt=t("b",null,"Drag and drop file to here to upload.",-1),it=t("p",{class:"text-xs"},"(Maximum size 2 MB)",-1),at=[lt,it];function rt(b,o,l,e,m,w){const x=f("Button"),h=f("FileUpload"),c=f("Card");return i(),Q(c,{class:"mt-4"},{content:F(()=>[t("div",Ke,[t("h2",Qe,k(l.title),1)]),t("div",He,[t("div",We,[_(h,{name:"file",url:"https://www.primefaces.org/upload.php",multiple:!1,accept:"application/pdf",maxFileSize:2e6,id:"logo",modelValue:e.tmp_file.file,"onUpdate:modelValue":o[1]||(o[1]=d=>e.tmp_file.file=d),customUpload:!0,onSelect:e.onSelectedFiles,onRemove:e.deleteTmpFile,fileLimit:1,ref:"fileUpload"},{content:F(()=>[e.tmp_file.file||e.tmp_file.file_url&&e.tmp_file.file_url.url?(i(),a("div",Xe,[t("div",Ze,[$e,e.tmp_file.file&&e.tmp_file.file.name?(i(),a("div",et,[t("div",tt,k(e.tmp_file.file.name),1),t("div",null,k(e.formatSize(e.tmp_file.file.size)),1)])):C("",!0),e.tmp_file.file_url&&e.tmp_file.file_url.url?(i(),a("div",ot,[t("div",st,k(e.getFileName(e.tmp_file.file_url.url)),1)])):C("",!0)]),_(x,{icon:"pi pi-times sdfsdf",onClick:o[0]||(o[0]=d=>e.deleteFile()),class:"p-button p-component p-button-icon-only p-fileupload-file-remove p-button-text p-button-danger p-button-rounded"})])):C("",!0)]),empty:F(()=>[e.tmp_file.file_url?C("",!0):(i(),a("div",nt,at))]),_:1},8,["modelValue","onSelect","onRemove"])])])]),_:1})}const ct=O(Ge,[["render",rt]]),dt={setup(){const b=v({icon:"pi pi-home",to:"/dashboard"}),o=v(),l=v([{label:"Dashboard"}]),e=v([]),m=v(),w=v({}),x=v([{name:"KG",value:"kg"},{name:"LT",value:"lt"}]),h=re(),c=xe(),d=H(),I=ue(),T=G(),p=v({}),U=v(),V=v();pe();const M=z(()=>h.userRoles),n=z(()=>c.getCurrentInsights),g=z(()=>I.getSelectedCountry),X=ye(),B=z(()=>X.allProducts),J=z(()=>c.getNumTarget),Z=z(()=>c.ranking_params),R=async function(){W();const s=new Map;s.set("country_id",g.value.id),s.set("year",m.value),c.fetchAllInsights(s).then(()=>{S(),$()}).catch(r=>{S(),j(d,r)})},$=function(){w.value=Object.assign({},n.value)},ee=function(s){var r;(r=g.value.language_codes)==null||r.forEach(u=>{s.translations[u].description==null&&(s.translations[u].description={text:""}),s.translations[u].short_description==null&&(s.translations[u].short_description={text:""}),s.translations[u].prize==null&&(s.translations[u].prize={text:""})}),s.product_ids=[],s.all_products?s.product_ids=B.value.map(u=>u.id+""):s.products.forEach(u=>{s.product_ids.push(u.id)}),V.value&&s.prize_image_url&&(V.value.tmp_image.image_url=s.prize_image_url),U.value&&s.pdf_url&&(U.value.tmp_file.file_url=s.pdf_url)},te=function(){const s=new FormData,r={},u=V.value.tmp_image,A=U.value.tmp_file;u&&u.image&&(r.prize_image=u.image),A&&A.file&&(r.pdf=A.file),p.value.all_products?r.all_products=!0:ge(p.value.product_ids,"insight[product_ids][]",s),r.unit=p.value.unit,r.translations={};for(const E in p.value.translations){const y=p.value.translations[E];y.description.id?q(y.description.text,y.description.id):s.append("insight[translations]["+E+"][description]",y.description.text),y.short_description.id?q(y.short_description.text,y.short_description.id):s.append("insight[translations]["+E+"][short_description]",y.short_description.text),y.prize.id?q(y.prize.text,y.prize.id):s.append("insight[translations]["+E+"][prize]",y.prize.text)}return r.translations={},ve(s,r,"insight"),p.value.all_products||s.append("insight[all_products]","false"),s},oe=async function(){const s={id:p.value.id,formData:te()};c.updateInsight(s).then(()=>{S(),R(),P(d,{message:"Insight updated correctly.",title:""})}).catch(r=>{S(),j(d,r)})},se=s=>{p.value=JSON.parse(JSON.stringify(s)),setTimeout(()=>{ee(p.value)},500),T.require({group:"templating",header:"Insight",accept:()=>{oe()},reject:()=>{p.value={}},acceptLabel:"Save",rejectLabel:"Cancel"})},ne=s=>{const r=new FormData;r.append("file",s.files[0]);const u={id:p.value.id,formData:r};c.importTarget(u).then(()=>{S(),R(),J.value?P(d,{message:J.value+" targets uploaded.",title:""}):P(d,{message:"0 teargets uploaded.",title:""})}).catch(A=>{S(),j(d,A)})},le=s=>{p.value.all_products=s.checked,s.checked?p.value.product_ids=B.value.map(r=>r.id+""):p.value.product_ids=[]},ie=s=>{p.value.all_products=s.value.length===B.value.length},ae=s=>{var r=JSON.parse(JSON.stringify(s)),u=r.cluster;u=="user"&&(u="workshop"),u=="dealer"&&(u="distributor"),_e.push({name:"ranking",params:{year:r.year,cluster:u,quarter:r.quarter}})};return K(async()=>{m.value=ce.now().toFormat("yyyy"),e.value.push(m.value),e.value.push(+m.value+1),R()}),{date:o,selectedYear:m,years:e,items:l,home:b,tmp_insight:w,dialog_insight:p,uploadPdfCard:U,uploadImageCard:V,units:x,userRoles:M,products:B,selectedCountry:g,rankingParamsNavigation:Z,fetchInsights:R,showDialog:se,onUpload:ne,onSelectAllChange:le,onChange:ie,showRanking:ae}},components:{InsightByAudienceCard:Ye,UploadImageCard:ke,UploadPdfCard:ct}};const ut={class:"flex justify-content-between align-items-center mb-3"},pt=t("div",{class:"flex justify-content-between align-items-center"},[t("h1",{class:"uppercase"},"Dashboard")],-1),_t={class:"col-2"},mt={key:0,class:"flex flex-column col-12"},ft={class:"field col-6 mb-0"},ht=t("label",{for:"products"},"Products",-1),gt={class:"flex flex-wrap"},vt={key:0,class:"field col-12 flex flex-column"},xt={class:"uppercase"},yt=t("i",{style:{"font-size":"12px"}},"ES: Acquista entro il 30 Giugno 200 l di prodotti Syntium o Selenia, in omaggio 1 kit Petronas",-1),bt={key:1,class:"field col-12 flex flex-column"},kt={class:"uppercase"},Ct={key:2,class:"field col-12 flex flex-column"},wt={class:"uppercase"},St={class:"field col-12 flex my-0 py-0"},Ut={class:"field col-6 upload-file pl-0 my-0 pt-0"},Vt={class:"field col-6 upload-file my-0 pt-0"},zt={class:"col-12 flex align-items-center justify-content-between my-0"},Dt={class:"col-6 flex flex-column field my-0"},Ft=t("label",{for:"unit"},"Unit of measurement",-1),It={class:"col-6 flex align-items-center justify-content-end"},Tt=t("a",{href:"https://petronas-adv-test.s3-eu-west-1.amazonaws.com/template_sellout_targets.xlsx",class:"p-button mr-4 p-button-outlined",icon:"pi pi-download"},[t("i",{class:"pi pi-download mr-2"}),D(" TEMPLATE ")],-1);function At(b,o,l,e,m,w){const x=f("Breadcrumb"),h=f("Dropdown"),c=f("Card"),d=f("InsightByAudienceCard"),I=f("MultiSelect"),T=f("Textarea"),p=f("UploadImageCard"),U=f("UploadPdfCard"),V=f("FileUpload"),M=f("ConfirmDialog");return i(),a("div",null,[t("div",ut,[_(x,{home:e.home,model:e.items,class:"mt-0 p-0"},null,8,["home","model"])]),_(c,null,{content:F(()=>[pt,t("div",_t,[_(h,{modelValue:e.selectedYear,"onUpdate:modelValue":o[0]||(o[0]=n=>e.selectedYear=n),options:e.years,placeholder:"Select a year",class:"w-full md:w-14rem",onChange:o[1]||(o[1]=n=>e.fetchInsights())},null,8,["modelValue","options"])])]),_:1}),(i(!0),a(L,null,N(e.userRoles,n=>(i(),a("div",{key:n.value},[_(d,{title:n.name,tmp_insight:e.tmp_insight[n.value],onOpen:o[2]||(o[2]=g=>e.showDialog(g)),onRanking:o[3]||(o[3]=g=>e.showRanking(g)),class:me(n.value)},null,8,["title","tmp_insight","class"])]))),128)),_(M,{group:"templating",style:{width:"80vw"},class:"insight"},{message:F(()=>[e.dialog_insight&&e.dialog_insight.translations?(i(),a("div",mt,[t("div",ft,[ht,_(I,{modelValue:e.dialog_insight.product_ids,"onUpdate:modelValue":o[4]||(o[4]=n=>e.dialog_insight.product_ids=n),options:e.products,optionLabel:"name",optionValue:"id",class:"w-full capitalize",selectAll:e.dialog_insight.all_products,maxSelectedLabels:10,display:"chip",onSelectallChange:o[5]||(o[5]=n=>e.onSelectAllChange(n)),onChange:o[6]||(o[6]=n=>e.onChange(n))},null,8,["modelValue","options","selectAll"])]),t("div",gt,[(i(!0),a(L,null,N(e.selectedCountry.language_codes,n=>(i(),a("div",{key:n,class:"col-6 p-0"},[e.dialog_insight.translations[n].short_description?(i(),a("div",vt,[t("label",null,[D("Short Description "),t("span",xt,"("+k(n)+")",1)]),yt,_(T,{modelValue:e.dialog_insight.translations[n].short_description.text,"onUpdate:modelValue":g=>e.dialog_insight.translations[n].short_description.text=g,maxlength:"140"},null,8,["modelValue","onUpdate:modelValue"])])):C("",!0),e.dialog_insight.translations[n].description?(i(),a("div",bt,[t("label",null,[D("Description "),t("span",kt,"("+k(n)+")",1)]),_(T,{modelValue:e.dialog_insight.translations[n].description.text,"onUpdate:modelValue":g=>e.dialog_insight.translations[n].description.text=g,style:{height:"100px"}},null,8,["modelValue","onUpdate:modelValue"])])):C("",!0),e.dialog_insight.translations[n].prize?(i(),a("div",Ct,[t("label",null,[D("Prize Description "),t("span",wt,"("+k(n)+")",1)]),_(T,{modelValue:e.dialog_insight.translations[n].prize.text,"onUpdate:modelValue":g=>e.dialog_insight.translations[n].prize.text=g,style:{height:"100px"}},null,8,["modelValue","onUpdate:modelValue"])])):C("",!0)]))),128))]),t("div",St,[t("div",Ut,[_(p,{title:"Prize image",ref:"uploadImageCard",videoUrl:!1},null,512)]),t("div",Vt,[_(U,{title:"Folder",ref:"uploadPdfCard",videoUrl:!1},null,512)])]),t("div",zt,[t("div",Dt,[Ft,_(h,{modelValue:e.dialog_insight.unit,"onUpdate:modelValue":o[7]||(o[7]=n=>e.dialog_insight.unit=n),options:e.units,optionLabel:"name",optionValue:"value",placeholder:"Select a unit",class:"w-full md:w-14rem",id:"unit"},null,8,["modelValue","options"])]),t("div",It,[Tt,_(V,{mode:"basic",name:"demo[]",url:"./upload.php",accept:".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel",maxFileSize:1e6,onUploader:e.onUpload,customUpload:"",auto:!0,chooseLabel:"Import Target"},null,8,["onUploader"])])])])):C("",!0)]),_:1})])}const Mt=O(dt,[["render",At]]);export{Mt as default};
