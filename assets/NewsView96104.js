import{a as q}from"./api.esm96104.js";import{u as z,e as A,r as O}from"./usetoast.esm96104.js";import{u as R}from"./useconfirm.esm96104.js";import{e as D,a as $}from"./helpers96104.js";import{u as V}from"./news96104.js";import{f as j}from"./formatData96104.js";import{ad as L,c as y,r as _,_ as k,a as u,i as K,o as S,b as F,f as n,q as d,y as T,t as x,h as G,j as H,w as M,e as C}from"./_plugin-vue_export-helper96104.js";import"./datetime96104.js";const I={setup(){L(()=>{i.value=!0,a.value={first:0,rows:m.value.rows,sortField:null,sortOrder:null,filters:c.value},q.register("myfilter",(t,p)=>t===p),e()});const r=V(),s=z(),g=R(),o=y(()=>r.responseNews),h=y(()=>r.newsStatus),b=y(()=>s.getSelectedCountry),l=A(),m=_(),c=_({status:{value:"",matchMode:"contains"}}),i=_(!0),a=_(),N=_(0),w=_([{label:"My Filter",value:"myfilter"}]);function e(){i.value=!0;const t=new Map;t.set("country_id",b.value.id),t.set("status",c.value.status.value),t.set("page",a.value.page+1),t.set("per_page",a.value.rows),a.value.sortField&&(a.value.sortOrder==1?t.set("sorted_by",a.value.sortField+"_asc"):t.set("sorted_by",a.value.sortField+"_desc")),setTimeout(()=>{f(t)},Math.random()*1e3+250)}const f=async function(t){await r.fetchAllNews(t).then(()=>{i.value=!1}).catch(p=>{i.value=!1,D(l,p)})},v=t=>{a.value=t,e()},B=t=>{a.value=t,e()},P=()=>{a.value.page=0,a.value.filters=c.value,e()},E=(t,p)=>{g.require({target:t.currentTarget,message:"Are you sure you want to remove this news?",icon:"pi pi-exclamation-triangle",accept:()=>{U(p.id)}})},U=async function(t){await r.deleteNews(t).then(()=>{$(l,{message:"News deleted correctly.",title:""}),e()}).catch(p=>{D(l,p)})};return{dt:m,responseNews:o,filters:c,loading:i,totalRecords:N,lazyParams:a,matchModes:w,newsStatus:h,onPage:v,onSort:B,onFilter:P,toggleEdit:function(t){O.push({name:"news-detail",params:{id:t.id}})},confirmDeleteNews:E,formatDataFromSql:j,loadLazyData:e}}};const J={key:0};function Q(r,s,g,o,h,b){const l=u("Column"),m=u("Badge"),c=u("Dropdown"),i=u("Button"),a=u("DataTable"),N=u("ConfirmPopup"),w=K("tooltip");return S(),F("div",null,[n(a,{value:o.responseNews.news,lazy:!0,paginator:!0,rows:30,filters:o.filters,"onUpdate:filters":s[0]||(s[0]=e=>o.filters=e),ref:"dt",dataKey:"id",loading:o.loading,totalRecords:o.responseNews.total,onPage:s[1]||(s[1]=e=>o.onPage(e)),onSort:s[2]||(s[2]=e=>o.onSort(e)),onFilter:s[3]||(s[3]=e=>o.onFilter()),filterDisplay:"row",removableSort:""},{empty:d(()=>[T(" No news found. ")]),default:d(()=>[n(l,{filed:"",header:"Title"},{body:d(({data:e})=>[e.translations[e.country.default_language_code].title?(S(),F("span",J,x(e.translations[e.country.default_language_code].title.text),1)):G("",!0)]),_:1}),n(l,{header:"Published at",field:"published_at",sortable:!0,style:{width:"20%"}},{body:d(({data:e})=>[T(x(o.formatDataFromSql(e.published_at)),1)]),_:1}),n(l,{header:"Status",field:"status",style:{width:"20%"},ref:"status",filterMatchMode:"contains",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{body:d(({data:e})=>[n(m,{value:e.status,class:H(["px-4 border-round-lg",e.status])},null,8,["value","class"])]),filter:d(({filterModel:e,filterCallback:f})=>[n(c,{modelValue:e.value,"onUpdate:modelValue":v=>e.value=v,options:o.newsStatus,optionValue:"value",optionLabel:"name",onChange:v=>f(),placeholder:"Filter by status"},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1},512),n(l,{header:"",style:{width:"9rem"}},{body:d(({data:e})=>[M(n(i,{type:"button",onClick:f=>o.toggleEdit(e),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-3",icon:"pi pi-pencil"},null,8,["onClick"]),[[w,"Edit",void 0,{top:!0}]]),M(n(i,{type:"button",onClick:f=>o.confirmDeleteNews(f,e),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-3",icon:"pi pi-trash"},null,8,["onClick"]),[[w,"Delete",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","filters","loading","totalRecords"]),n(N)])}const W=k(I,[["render",Q]]),X={setup(){const r=V();return{totalNews:y(()=>r.getTotalNews)}},components:{NewsTable:W}},Y={class:"flex justify-content-between align-items-center"},Z={class:"uppercase"};function ee(r,s,g,o,h,b){const l=u("Button"),m=u("NewsTable"),c=u("Card");return S(),F("div",null,[n(c,null,{content:d(()=>[C("div",Y,[C("h1",Z,[C("span",null,x(o.totalNews)+" News",1)]),n(l,{label:"news",onClick:s[0]||(s[0]=i=>r.$router.push("/news-detail")),icon:"pi pi-plus",class:"mb-3"})]),n(m)]),_:1})])}const ce=k(X,[["render",ee]]);export{ce as default};
