import{r as l,p as ue,ac as de,u as me,c as D,n as _e,a as pe,_ as ve,b as c,o as m,e as g,f as i,g as r,h as K,i as p,v as Q,w as B,l as A,x as fe}from"./usetoast.esm67435.js";import{a as E,s as G,h as v,e as x,i as ge,u as he,b as we,c as ye,f as Ce,g as be,d as Ne}from"./helpers67435.js";import{u as Se}from"./user67435.js";import{u as ke}from"./news67435.js";import{u as De}from"./category67435.js";import{u as xe}from"./group67435.js";import{A as Fe}from"./AudienceCard67435.js";import{U as Ae}from"./UploadImageCard67435.js";import{E as Ee,G as Ie}from"./GalleryImageCard67435.js";import{a as Te,f as Ue}from"./formatData67435.js";import{u as Ve}from"./useconfirm.esm67435.js";import{v as P}from"./runtime-dom.esm-bundler67435.js";import"./datetime67435.js";const Le={setup(){const j=l({icon:"pi pi-home",to:"/news"}),o=l(""),F=l([{label:""}]),e=l({}),O=["draft","online","archived"],R=l(),h=l(!1),u=l(!1),w=l(),y=l(""),I=l(!0),T=l(!0),U=l(!0),b=l(),N=l(),_=l(),n=ue(),d=de(),S=ke(),W=De(),X=xe(),Z=Se(),$=me(),ee=Ve(),f=D(()=>S.getCurrentNews),k=D(()=>W.allCategories),te=D(()=>Z.userRoles),ae=D(()=>X.allGroups),q=D(()=>$.getSelectedCountry),V=async function(a){G(),S.fetchNewsDetail(a).then(()=>{v(),le()}).catch(t=>{v(),x(d,t)})},z=function(){var J;const a=new FormData,t=Object.assign({},e.value);e.value.published_at&&(t.published_at=Te(e.value.published_at));const s=N.value.tmp_image;s&&s.image&&(t.image=s.image),s&&s.video_url&&(t.video_url=s.video_url);const C=_.value.files;return C&&C.length>0&&C.length>0&&ge(C,"news[gallery_images][]",a),t.country_id=(J=t.country)==null?void 0:J.id,delete t.country,(o.value||t.id)&&he(f,t),delete t.target_all,delete t.target_clusters,delete t.target_group_ids,we(a,t,"news"),ye(b,a,"news"),a},oe=async function(){const a={id:e.value.id,formData:z()};S.updateNews(a).then(()=>{v(),V(e.value.id+""),E(d,{message:"News updated correctly.",title:""}),_.value.files=[],_.value.fileUpload.files=[]}).catch(t=>{v(),x(d,t)})},se=async function(){const a={formData:z()};S.createNews(a).then(()=>{v(),V(f.value.id+""),E(d,{message:"News created correctly.",title:""}),pe.push({name:"news-detail",params:{id:f.value.id}})}).catch(t=>{v(),x(d,t)})},le=function(){var a,t;if(e.value=Object.assign({},f.value),e.value.country_id=(a=f.value.country)==null?void 0:a.id,y.value=((t=e.value.country)==null?void 0:t.default_language_code)+"",e.value.published_at=Ue(f.value.published_at+""),Ce(b,e),be(N,e),Ne(f,e),_.value){const s=e.value.gallery_images_url;s&&s.length>0&&(_.value.tmp_gallery=s)}e.value.news_category_id=e.value.news_category.id,H(),delete e.value.news_category},ne=function(){L(e.value.published_at),L(e.value.news_category_id)},re=function(){if(h.value=!0,ne(),u.value){E(d,{message:"Check that you have completed the required fields.",title:"",error:!0});return}o.value!=""||e.value.id?oe():se(),h.value=!1,G()},L=function(a){if(h.value)return a==""||a==null?u.value=!0:u.value=!1,u.value},M=function(a){w.value=[],a.value.forEach(t=>{if(t.country&&t.country.default_language_code){const s={id:t.id,value:t.translations[t.country.default_language_code].name.text};w.value.push(s)}})},H=async function(){if(k.value&&k.value.length>0){M(k);return}const a=new Map;a.set("country_id",e.value.country.id),await W.fetchAllCategories(a).then(()=>{var t;M(k),y.value=((t=e.value.country)==null?void 0:t.default_language_code)+""}).catch(t=>{x(d,t)})},ie=a=>{ee.require({group:"push",target:a.currentTarget,message:"Are you sure you want to send the push notification?",icon:"pi pi-exclamation-triangle"})},ce=async function(){G(),await S.sendPush(o.value).then(()=>{E(d,{message:"Notification sent correctly.",title:"",error:!1}),Y(),v()}).catch(a=>{v(),x(d,a)})},Y=function(){var a=document.getElementsByClassName("p-confirm-popup-reject")[0];a.click()};return _e(async()=>{var a,t,s;o.value=n.params.id+"",o.value!=""&&o.value!="undefined"?(V(o.value),F.value[0]={label:"Edit news"}):(e.value.status="draft",F.value[0]={label:"Add news"},e.value.country_id=q.value.id,e.value.country=q.value,y.value=((a=e.value.country)==null?void 0:a.default_language_code)+"",H(),e.value.translations||(e.value.translations={},(s=(t=e.value.country)==null?void 0:t.language_codes)==null||s.forEach(C=>{e.value.translations[C]={title:null,short_description:null,description:null}})))}),{home:j,items:F,tmp_news:e,filteredUsers:R,filteredCategories:w,selectedLang:y,showCheckboxAll:I,showSelectClusters:T,showSelectGroups:U,userRoles:te,allGroups:ae,news_status:O,audienceCard:b,uploadImageCard:N,submitForm:h,categories:k,galleryImageCard:_,saveNews:re,validateField:L,confirmSendPush:ie,closePopup:Y,sendPush:ce}},components:{AudienceCard:Fe,UploadImageCard:Ae,EventContentCard:Ee,GalleryImageCard:Ie}};const Be={class:"m-4"},Ge={class:"flex justify-content-between align-items-center mb-3"},Pe={class:"flex align-items-center justify-content-between"},je=i("h2",{class:"mb-2"},"NEWS DETAIL",-1),Oe={key:0,class:"field col-2 mb-0"},Re={key:0,class:"p-error"},We={class:"formgrid grid col-10 px-0 xs:col-12"},qe={key:0,class:"field col-4 xs:col-6"},ze=i("label",{for:"shipping_country"},"Category*",-1),Me={key:0,class:"p-error"},He={key:1,class:"field col-4 xs:col-6"},Ye=i("label",{for:"name"},"Published at*",-1),Je={key:0,class:"p-error"},Ke={class:"flex p-3 align-items-center"},Qe={class:"pl-2"},Xe={class:"flex align-items-center pb-3 justify-content-end"};function Ze(j,o,F,e,O,R){const h=c("Breadcrumb"),u=c("Button"),w=c("Dropdown"),y=c("Calendar"),I=c("Card"),T=c("AudienceCard"),U=c("EventContentCard"),b=c("UploadImageCard"),N=c("GalleryImageCard"),_=c("ConfirmPopup");return m(),g("div",Be,[i("div",Ge,[r(h,{home:e.home,model:e.items,class:"mt-0 p-0"},null,8,["home","model"]),i("div",null,[e.tmp_news.id?(m(),K(u,{key:0,label:"Send push",onClick:o[0]||(o[0]=n=>e.confirmSendPush(n)),class:"mr-3 p-button-outlined",icon:"pi pi-envelope"})):p("",!0),r(u,{label:"Save",onClick:e.saveNews},null,8,["onClick"])])]),r(I,null,{content:Q(()=>[i("div",Pe,[je,e.tmp_news.country?(m(),g("div",Oe,[r(w,{modelValue:e.tmp_news.status,"onUpdate:modelValue":o[1]||(o[1]=n=>e.tmp_news.status=n),options:e.news_status,class:A(["w-full capitalize dropdown-status",{"p-invalid":e.validateField(e.tmp_news.status)}])},null,8,["modelValue","options","class"]),e.validateField(e.tmp_news.status)?(m(),g("small",Re,"Campo obbligatorio.")):p("",!0)])):p("",!0)]),i("div",We,[e.tmp_news.country?(m(),g("div",qe,[ze,r(w,{modelValue:e.tmp_news.news_category_id,"onUpdate:modelValue":o[2]||(o[2]=n=>e.tmp_news.news_category_id=n),options:e.filteredCategories,optionLabel:"value",optionValue:"id",class:A(["w-full",{"p-invalid":e.validateField(e.tmp_news.news_category_id)}])},null,8,["modelValue","options","class"]),e.validateField(e.tmp_news.news_category_id)?(m(),g("small",Me,"Campo obbligatorio.")):p("",!0)])):p("",!0),e.tmp_news.country?(m(),g("div",He,[Ye,r(y,{inputId:"dateformat",modelValue:e.tmp_news.published_at,"onUpdate:modelValue":o[3]||(o[3]=n=>e.tmp_news.published_at=n),dateFormat:"dd/mm/yy",manualInput:!1,class:A({"p-invalid":e.validateField(e.tmp_news.published_at)}),placeholder:"gg/mm/aaaa"},null,8,["modelValue","class"]),e.validateField(e.tmp_news.published_at)?(m(),g("small",Je,"Campo obbligatorio.")):p("",!0)])):p("",!0)])]),_:1}),B(r(T,{ref:"audienceCard"},null,512),[[P,e.tmp_news.country]]),e.tmp_news.country&&e.selectedLang?(m(),K(U,{key:0,selectedLang:e.selectedLang,submitForm:e.submitForm,tmp_events:e.tmp_news,title:"NEWS CONTENT"},null,8,["selectedLang","submitForm","tmp_events"])):p("",!0),B(r(b,{title:"NEWS MEDIA",videoUrl:!0,ref:"uploadImageCard"},null,512),[[P,e.tmp_news.country]]),B(r(N,{title:"NEWS GALLERY",videoUrl:!1,ref:"galleryImageCard"},null,512),[[P,e.tmp_news.country&&e.tmp_news.id]]),r(_,{group:"push",id:"push"},{message:Q(n=>[i("div",Ke,[i("i",{class:A(n.message.icon),style:{"font-size":"1.5rem"}},null,2),i("p",Qe,fe(n.message.message),1)]),i("div",Xe,[r(u,{label:"Cancel",class:"mr-3 p-button-text text-500",onClick:e.closePopup},null,8,["onClick"]),r(u,{label:"Send",class:"mr-4",onClick:e.sendPush},null,8,["onClick"])])]),_:1})])}const mt=ve(Le,[["render",Ze]]);export{mt as default};
