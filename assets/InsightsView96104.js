import{u as rt}from"./user96104.js";import{D as dt}from"./datetime96104.js";import{u as Q}from"./useconfirm.esm96104.js";import{r as g,_ as P,a as f,i as ut,o as l,b as c,e as s,t as b,w as pt,f as m,F as R,x as q,y as T,h as C,n as $,g as H,q as S,c as E,j as _t}from"./_plugin-vue_export-helper96104.js";import{j as mt,k as ft,s as W,h as I,a as J,e as L,b as G,l as ht,u as Y}from"./helpers96104.js";import{b as K,i as M,h as gt,d as vt,e as X,u as yt,r as xt}from"./usetoast.esm96104.js";import{u as bt}from"./product96104.js";import{u as wt,U as Ct}from"./UploadImageCard96104.js";const kt={props:{target:Object},setup(){const a=Q(),t=g({});return{confirm:a,insight:t}}};const It={key:0,class:"insight border-round-lg m-2 border-300 border-solid border-1 p-3 h-full pt-2"},St={class:"flex align-items-center justify-content-between mb-2"},Ut={class:"my-0"},Dt={key:0},Vt={key:1},zt={key:0,class:"text-sm"},Ft={class:"truncate-products"},Tt={key:0},At={key:0},Bt={class:"uppercase"},jt={key:1},Et=s("p",{class:"text-center"},[s("i",null,"Insight not configured")],-1),Lt=[Et];function Rt(a,t,o,e,_,w){const y=f("Button"),v=ut("tooltip");return o.target?(l(),c("div",It,[s("div",St,[s("h2",Ut,[o.target.quarter==0?(l(),c("span",Dt,"GLOBAL")):(l(),c("span",Vt,"Q"+b(o.target.quarter),1))]),pt(m(y,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-0",icon:"pi pi-pencil",onClick:t[0]||(t[0]=u=>a.$emit("open",o.target))},null,512),[[v,"Edit",void 0,{top:!0}]])]),o.target.products.length>0||o.target.all_products?(l(),c("div",zt,[s("div",Ft,[o.target.all_products?(l(),c("span",Tt," All products ")):(l(!0),c(R,{key:1},q(o.target.products,(u,d)=>(l(),c("span",{key:u.id,class:"mb-1 inline-block mr-1 text-sm"},[d!=0?(l(),c("span",At," / ")):C("",!0),T(" "+b(u.name),1)]))),128))]),s("p",null,[T(" Units: "),s("span",Bt,b(o.target.unit),1)])])):(l(),c("div",jt,Lt))])):C("",!0)}const qt=P(kt,[["render",Rt]]),Pt={props:{title:String,tmp_insight:{}},setup(a,{emit:t}){return $(async()=>{}),{catchEvent:_=>{t("open",_)},catchEventRanking:_=>{t("ranking",_)}}},components:{InsightCard:qt}},Nt={class:"flex justify-content-between align-items-center"},Ot={class:"uppercase"},Mt={class:"grid col-12 mb-4"};function Jt(a,t,o,e,_,w){const y=f("InsightCard"),v=f("Card");return l(),H(v,{class:"mt-4"},{content:S(()=>[s("div",Nt,[s("h2",Ot,b(o.title),1)]),s("div",Mt,[(l(!0),c(R,null,q(o.tmp_insight,u=>(l(),c("div",{key:u,class:"flex-1"},[m(y,{target:u,onOpen:t[0]||(t[0]=d=>e.catchEvent(d)),onRanking:t[1]||(t[1]=d=>e.catchEventRanking(d))},null,8,["target"])]))),128))])]),_:1})}const Gt=P(Pt,[["render",Jt]]);class F{static async fetchAll(t){return(await K("/insights",t)).data.insights}static async getInsightDetail(t){return(await K(`/insights/${t}`)).data.news_insight}static async updateInsight(t){return(await M(`/insights/${t.id}/update`,t.formData)).data.news_insight}static async deleteInsight(t){return(await gt(`/insights/${t}`)).data.news_insight}static async importTarget(t){return(await M(`/insights/${t.id}/upload_target`,t.formData)).data.news_insight}static async insightRanking(t){return(await M(`/insights/${t.id}/ranking`,t.formData)).data.news_insight}}const Yt=vt({id:"insight",state:()=>({insights:{}}),getters:{getCurrentInsights:a=>a.insights},actions:{async fetchAllInsights(a){await F.fetchAll(a).then(t=>this.insights=t)},async fetchInsightDetail(a){await F.getInsightDetail(a).then(t=>this.insights=t)},async updateInsight(a){await F.updateInsight(a).then(t=>this.insights=t)},async deleteInsight(a){await F.deleteInsight(a).then(t=>this.insights=t)},async importTarget(a){await F.importTarget(a)}}}),Kt={props:{title:String,videoUrl:Boolean},setup(a,t){const o=g({}),e=wt(),_=X(),w=g(),y=d=>{o.value.file_url={},o.value.file=d.files[0]},v=()=>{const d=o.value.file_url.id;d?(W(),e.deleteAttachment(d).then(()=>{I(),J(_,{message:"File deleted correctly.",title:""}),u()}).catch(V=>{I(),L(_,V)})):u()},u=()=>{o.value={},w.value.files=[]};return t.expose({tmp_file:o}),{tmp_file:o,fileUpload:w,onSelectedFiles:y,deleteFile:v,formatSize:mt,getFileName:ft,deleteTmpFile:u}}};const Qt={class:"flex align-items-center justify-content-between"},$t={class:"mb-4"},Ht={class:"flex col-10"},Wt={class:"col-6 flex-column p-0"},Xt={key:0,class:"card m-0 flex border-1 surface-border align-items-center justify-content-between pl-4 pr-3 py-3 w-full my-2"},Zt={class:"flex align-items-center"},te=s("i",{class:"pi pi-file text-2xl"},null,-1),ee={key:0,class:"flex flex-column ml-2 file",style:{"font-size":"12px"}},se={class:"mb-1"},ne={key:1,class:"flex flex-column ml-2 file",style:{"font-size":"12px"}},oe={class:"mb-1"},ie={key:0,class:"text-center"},le=s("b",null,"Drag and drop file to here to upload.",-1),ae=s("p",{class:"text-xs"},"(Maximum size 2 MB)",-1),ce=[le,ae];function re(a,t,o,e,_,w){const y=f("Button"),v=f("FileUpload"),u=f("Card");return l(),H(u,{class:"mt-4"},{content:S(()=>[s("div",Qt,[s("h2",$t,b(o.title),1)]),s("div",Ht,[s("div",Wt,[m(v,{name:"file",url:"https://www.primefaces.org/upload.php",multiple:!1,accept:"application/pdf",maxFileSize:2e6,id:"logo",modelValue:e.tmp_file.file,"onUpdate:modelValue":t[1]||(t[1]=d=>e.tmp_file.file=d),customUpload:!0,onSelect:e.onSelectedFiles,onRemove:e.deleteTmpFile,fileLimit:1,ref:"fileUpload"},{content:S(()=>[e.tmp_file.file||e.tmp_file.file_url&&e.tmp_file.file_url.url?(l(),c("div",Xt,[s("div",Zt,[te,e.tmp_file.file&&e.tmp_file.file.name?(l(),c("div",ee,[s("div",se,b(e.tmp_file.file.name),1),s("div",null,b(e.formatSize(e.tmp_file.file.size)),1)])):C("",!0),e.tmp_file.file_url&&e.tmp_file.file_url.url?(l(),c("div",ne,[s("div",oe,b(e.getFileName(e.tmp_file.file_url.url)),1)])):C("",!0)]),m(y,{icon:"pi pi-times sdfsdf",onClick:t[0]||(t[0]=d=>e.deleteFile()),class:"p-button p-component p-button-icon-only p-fileupload-file-remove p-button-text p-button-danger p-button-rounded"})])):C("",!0)]),empty:S(()=>[e.tmp_file.file_url?C("",!0):(l(),c("div",ie,ce))]),_:1},8,["modelValue","onSelect","onRemove"])])])]),_:1})}const de=P(Kt,[["render",re]]),ue={setup(){const a=g({icon:"pi pi-home",to:"/insights"}),t=g(),o=g([{label:"Insights"}]),e=g([]),_=g(),w=g({}),y=g([{name:"KG",value:"kg"},{name:"LT",value:"lt"}]),v=rt(),u=Yt(),d=X(),V=yt(),A=Q(),p=g({}),U=g(),D=g(),N=E(()=>v.userRoles),i=E(()=>u.getCurrentInsights),x=E(()=>V.getSelectedCountry),Z=bt(),B=E(()=>Z.allProducts),j=async function(){W();const n=new Map;n.set("country_id",x.value.id),n.set("year",_.value),u.fetchAllInsights(n).then(()=>{I(),tt()}).catch(r=>{I(),L(d,r)})},tt=function(){w.value=Object.assign({},i.value)},et=function(n){var r;(r=x.value.language_codes)==null||r.forEach(h=>{n.translations[h].description==null&&(n.translations[h].description={text:""}),n.translations[h].prize==null&&(n.translations[h].prize={text:""})}),n.product_ids=[],n.all_products?n.product_ids=B.value.map(h=>h.id+""):n.products.forEach(h=>{n.product_ids.push(h.id)}),D.value&&n.prize_image_url&&(D.value.tmp_image.image_url=n.prize_image_url),U.value&&n.pdf_url&&(U.value.tmp_file.file_url=n.pdf_url)},st=function(){const n=new FormData,r={},h=D.value.tmp_image,z=U.value.tmp_file;h&&h.image&&(r.prize_image=h.image),z&&z.file&&(r.pdf=z.file),p.value.all_products?r.all_products=!0:ht(p.value.product_ids,"insight[product_ids][]",n),r.unit=p.value.unit,r.translations={};for(const O in p.value.translations){const k=p.value.translations[O];k.description.id?Y(k.description.text,k.description.id):n.append("insight[translations]["+O+"][description]",k.description.text),k.prize.id?Y(k.prize.text,k.prize.id):n.append("insight[translations]["+O+"][prize]",k.prize.text)}return r.translations={},G(n,r,"insight"),p.value.all_products||n.append("insight[all_products]",!1),n},nt=async function(){const n={id:p.value.id,formData:st()};u.updateInsight(n).then(()=>{I(),j(),J(d,{message:"Insight updated correctly.",title:""})}).catch(r=>{I(),L(d,r)})},ot=n=>{p.value=JSON.parse(JSON.stringify(n)),setTimeout(()=>{et(p.value)},500),A.require({group:"templating",header:"Insight",accept:()=>{nt()},reject:()=>{p.value={}},acceptLabel:"Save",rejectLabel:"Cancel"})},it=n=>{const r=new FormData,h={id:p.value.id,formData:G(r,n.files[0],"file")};u.importTarget(h).then(()=>{I(),j(),J(d,{message:"Insight updated correctly.",title:""})}).catch(z=>{I(),L(d,z)})},lt=n=>{p.value.all_products=n.checked,n.checked?p.value.product_ids=B.value.map(r=>r.id+""):p.value.product_ids=[]},at=n=>{p.value.all_products=n.value.length===B.value.length},ct=n=>{var r=JSON.parse(JSON.stringify(n));xt.push({name:"ranking",params:{year:r.year,cluster:r.cluster,quarter:r.quarter}})};return $(async()=>{_.value=dt.now().toFormat("yyyy"),e.value.push(_.value),e.value.push(+_.value+1),j()}),{date:t,selectedYear:_,years:e,items:o,home:a,tmp_insight:w,dialog_insight:p,uploadPdfCard:U,uploadImageCard:D,units:y,userRoles:N,products:B,selectedCountry:x,fetchInsights:j,showDialog:ot,onUpload:it,onSelectAllChange:lt,onChange:at,showRanking:ct}},components:{InsightByAudienceCard:Gt,UploadImageCard:Ct,UploadPdfCard:de}};const pe={class:"flex justify-content-between align-items-center mb-3"},_e=s("div",{class:"flex justify-content-between align-items-center"},[s("h1",{class:"uppercase"},"Insight")],-1),me={class:"col-2"},fe={key:0,class:"flex flex-column col-12"},he={class:"field col-6 mb-0"},ge=s("label",{for:"products"},"Products",-1),ve={class:"flex flex-wrap"},ye={key:0,class:"field col-12 flex flex-column"},xe={class:"uppercase"},be=s("span",{class:"ql-formats"},[s("button",{class:"ql-bold"}),s("button",{class:"ql-italic"}),s("button",{class:"ql-underline"})],-1),we={key:1,class:"field col-12 flex flex-column"},Ce={class:"uppercase"},ke=s("span",{class:"ql-formats"},[s("button",{class:"ql-bold"}),s("button",{class:"ql-italic"}),s("button",{class:"ql-underline"})],-1),Ie={class:"field col-12 flex my-0 py-0"},Se={class:"field col-6 upload-file pl-0 my-0 pt-0"},Ue={class:"field col-6 upload-file my-0 pt-0"},De={class:"col-12 flex align-items-center justify-content-between my-0"},Ve={class:"col-6 flex flex-column field my-0"},ze=s("label",{for:"unit"},"Unit of measurement",-1),Fe={class:"col-6 flex align-items-center justify-content-end"},Te=s("a",{href:"https://petronas-adv-test.s3-eu-west-1.amazonaws.com/template_sellout_targets.xlsx",class:"p-button mr-4 p-button-outlined",icon:"pi pi-download"},[s("i",{class:"pi pi-download mr-2"}),T(" TEMPLATE ")],-1);function Ae(a,t,o,e,_,w){const y=f("Breadcrumb"),v=f("Dropdown"),u=f("Card"),d=f("InsightByAudienceCard"),V=f("MultiSelect"),A=f("Editor"),p=f("UploadImageCard"),U=f("UploadPdfCard"),D=f("FileUpload"),N=f("ConfirmDialog");return l(),c("div",null,[s("div",pe,[m(y,{home:e.home,model:e.items,class:"mt-0 p-0"},null,8,["home","model"])]),m(u,null,{content:S(()=>[_e,s("div",me,[m(v,{modelValue:e.selectedYear,"onUpdate:modelValue":t[0]||(t[0]=i=>e.selectedYear=i),options:e.years,placeholder:"Select a year",class:"w-full md:w-14rem",onChange:t[1]||(t[1]=i=>e.fetchInsights())},null,8,["modelValue","options"])])]),_:1}),(l(!0),c(R,null,q(e.userRoles,i=>(l(),c("div",{key:i.value},[m(d,{title:i.name,tmp_insight:e.tmp_insight[i.value],onOpen:t[2]||(t[2]=x=>e.showDialog(x)),onRanking:t[3]||(t[3]=x=>e.showRanking(x)),class:_t(i.value)},null,8,["title","tmp_insight","class"])]))),128)),m(N,{group:"templating",style:{width:"80vw"},class:"insight"},{message:S(()=>[e.dialog_insight&&e.dialog_insight.translations?(l(),c("div",fe,[s("div",he,[ge,m(V,{modelValue:e.dialog_insight.product_ids,"onUpdate:modelValue":t[4]||(t[4]=i=>e.dialog_insight.product_ids=i),options:e.products,optionLabel:"name",optionValue:"id",class:"w-full capitalize",selectAll:e.dialog_insight.all_products,maxSelectedLabels:10,display:"chip",onSelectallChange:t[5]||(t[5]=i=>e.onSelectAllChange(i)),onChange:t[6]||(t[6]=i=>e.onChange(i))},null,8,["modelValue","options","selectAll"])]),s("div",ve,[(l(!0),c(R,null,q(e.selectedCountry.language_codes,i=>(l(),c("div",{key:i,class:"col-6 p-0"},[e.dialog_insight.translations[i].description?(l(),c("div",ye,[s("label",null,[T("Description "),s("span",xe,"("+b(i)+")",1)]),m(A,{modelValue:e.dialog_insight.translations[i].description.text,"onUpdate:modelValue":x=>e.dialog_insight.translations[i].description.text=x,editorStyle:"height: 100px"},{toolbar:S(()=>[be]),_:2},1032,["modelValue","onUpdate:modelValue"])])):C("",!0),e.dialog_insight.translations[i].prize?(l(),c("div",we,[s("label",null,[T("Prize Description "),s("span",Ce,"("+b(i)+")",1)]),m(A,{modelValue:e.dialog_insight.translations[i].prize.text,"onUpdate:modelValue":x=>e.dialog_insight.translations[i].prize.text=x,editorStyle:"height: 100px"},{toolbar:S(()=>[ke]),_:2},1032,["modelValue","onUpdate:modelValue"])])):C("",!0)]))),128))]),s("div",Ie,[s("div",Se,[m(p,{title:"Prize image",ref:"uploadImageCard",videoUrl:!1},null,512)]),s("div",Ue,[m(U,{title:"Regulation",ref:"uploadPdfCard",videoUrl:!1},null,512)])]),s("div",De,[s("div",Ve,[ze,m(v,{modelValue:e.dialog_insight.unit,"onUpdate:modelValue":t[7]||(t[7]=i=>e.dialog_insight.unit=i),options:e.units,optionLabel:"name",optionValue:"value",placeholder:"Select a unit",class:"w-full md:w-14rem",id:"unit"},null,8,["modelValue","options"])]),s("div",Fe,[Te,m(D,{mode:"basic",name:"demo[]",url:"./upload.php",accept:".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel",maxFileSize:1e6,onUploader:e.onUpload,customUpload:"",auto:!0,chooseLabel:"Import Target"},null,8,["onUploader"])])])])):C("",!0)]),_:1})])}const Oe=P(ue,[["render",Ae]]);export{Oe as default};
