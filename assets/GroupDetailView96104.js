import{e as $,u as ee}from"./usetoast.esm96104.js";import{r as m,k as te,c as V,n as oe,_ as se,a as u,i as le,o as U,b as F,e as l,f as n,q as p,g as ae,h as K,F as ne,j as L,t as S,y as O,w as re}from"./_plugin-vue_export-helper96104.js";import{e as _,a as g,s as q,h as y}from"./helpers96104.js";import{u as ie}from"./group96104.js";import{u as ce}from"./user96104.js";import{u as ue}from"./useconfirm.esm96104.js";import{w as I}from"./runtime-dom.esm-bundler96104.js";const de={setup(){const A=m({icon:"pi pi-home",to:"/groups"}),r=m(""),x=m([{label:""}]),e=m({}),N=m(),C=m(!1),G=m(),w=te(),a=$(),c=ie(),b=ce(),D=ee(),T=ue(),d=m(!1),k=m({sellout_code:{value:"",matchMode:"contains"},full_name:{value:"",matchMode:"contains"}}),h=V(()=>c.getCurrentGroup),M=V(()=>c.allGroups),t=V(()=>b.allUsers),f=V(()=>D.getSelectedCountry),i=async function(o){q(),c.fetchGroupDetail(o).then(()=>{y(),P()}).catch(s=>{y(),_(a,s)})},B=async function(){const o=new Map;await c.fetchAllGroups(o).catch(s=>{_(a,s)})},R=async function(){const o={user_group:e.value};c.updateGroup(o).then(()=>{y(),i(h.value.id+""),g(a,{message:"Group updated correctly.",title:""})}).catch(s=>{y(),_(a,s)})},z=async function(){e.value.user_group=[];const o={user_group:e.value};c.createGroup(o).then(()=>{y(),i(h.value.id+""),g(a,{message:"Group created correctly.",title:""})}).catch(s=>{y(),_(a,s)})},P=function(){var o;e.value=Object.assign({},h.value),e.value.country_id=(o=h.value.country)==null?void 0:o.id},H=function(){E(e.value.name)},J=function(){if(C.value=!0,delete e.value.country,e.value.users&&delete e.value.users,delete e.value.created_at,delete e.value.updated_at,H(),d.value){g(a,{message:"Check that you have completed the required fields.",title:"",error:!0});return}r.value!=""&&e.value.id?R():z(),C.value=!1,q()},E=function(o){if(C.value)return o==""||o==null?d.value=!0:d.value=!1,d.value},j=async function(o){const s=new Map;o&&s.set("sellout_code",o.query),s.set("country_id",e.value.country_id),await b.fetchAllUsers(s).catch(v=>{_(a,v)})},Q=async function(o){const s={group_id:e.value.id,user_group:{user_id:G.value.id}};await c.addUserToGroup(s).then(()=>{g(a,{message:"User added correctly.",title:""}),i(e.value.id+"")}).catch(v=>{_(a,v)})},W=async function(o){const s={group_id:e.value.id,user_group:{user_id:o}};await c.deleteUserFromGroup(s).then(()=>{g(a,{message:"User deleted correctly.",title:""}),i(e.value.id+"")}).catch(v=>{_(a,v)})},X=(o,s)=>{T.require({target:o.currentTarget,message:"Are you sure you want to remove this user from the group?",icon:"pi pi-exclamation-triangle",accept:()=>{W(s)}})},Y=async function(o){const s=new FormData;s.append("file",o.files[0]);const v={group_id:e.value.id,formData:s};await c.importUsersToGroup(v).then(()=>{g(a,{message:"User uploaded correctly.",title:""}),i(e.value.id+"")}).catch(Z=>{_(a,Z)})};return oe(async()=>{B(),j(null),r.value=w.params.id+"",r.value!=""&&r.value!="undefined"?(i(r.value),x.value[0]={label:"Edit group"}):(x.value[0]={label:"New group"},e.value.country_id=f.value.id)}),{home:A,items:x,tmp_group:e,filteredGroups:N,allGroups:M,filters:k,allUsers:t,newUser:G,saveGroup:J,validateField:E,fetchAllGroups:B,fetchAllUsers:j,addUserToGroup:Q,confirmDeleteUser:X,importFileUsers:Y}},components:{}};const me={class:"m-4"},pe={class:"flex justify-content-between align-items-center mb-3"},_e=l("div",{class:"flex align-items-center justify-content-between"},[l("h2",{class:"mb-2"},"GROUP DETAILS")],-1),fe={class:"formgrid grid col-10 px-0"},ve={class:"field col-6"},he=l("label",{for:"name"},"Name*",-1),ge={key:0,class:"p-error"},ye={class:"field col-12"},we=l("label",{for:"note"},"Description",-1),be={class:"flex align-items-center justify-content-between"},Ue={key:0,class:"mb-4"},xe={key:1,class:"mb-4"},Ce={class:"flex align-items-center justify-content-between"},Ge={class:"formgrid grid col-7 px-0"},Ve={class:"field col-5 flex flex-column mb-2"},Fe={class:"flex col-5 justify-content-end"},Se=l("a",{href:"https://petronas-adv-test.s3-eu-west-1.amazonaws.com/template_groups_import.xlsx",class:"p-button mr-4 p-button-outlined"},[l("i",{class:"pi pi-download mr-2"}),O(" TEMPLATE ")],-1),De={class:"flex p-4 align-items-center"},Te={class:"pl-2"};function ke(A,r,x,e,N,C){const G=u("Breadcrumb"),w=u("Button"),a=u("InputText"),c=u("Textarea"),b=u("Card"),D=u("AutoComplete"),T=u("FileUpload"),d=u("Column"),k=u("DataTable"),h=u("ConfirmPopup"),M=le("tooltip");return U(),F(ne,null,[l("div",me,[l("div",pe,[n(G,{home:e.home,model:e.items,class:"mt-0 p-0"},null,8,["home","model"]),n(w,{label:"Save",onClick:e.saveGroup},null,8,["onClick"])]),n(b,null,{content:p(()=>[_e,l("div",fe,[l("div",ve,[he,n(a,{id:"name",type:"text",modelValue:e.tmp_group.name,"onUpdate:modelValue":r[0]||(r[0]=t=>e.tmp_group.name=t),class:L(["w-full",{"p-invalid":e.validateField(e.tmp_group.name)}])},null,8,["modelValue","class"]),e.validateField(e.tmp_group.name)?(U(),F("small",ge,"Campo obbligatorio.")):K("",!0)]),l("div",ye,[we,n(c,{id:"note",modelValue:e.tmp_group.description,"onUpdate:modelValue":r[1]||(r[1]=t=>e.tmp_group.description=t),rows:"5",cols:"30",class:"w-full"},null,8,["modelValue"])])])]),_:1}),e.tmp_group.id?(U(),ae(b,{key:0,class:"my-4"},{content:p(()=>[l("div",be,[e.tmp_group.users?(U(),F("h2",Ue,S(e.tmp_group.users.length)+" USERS ",1)):(U(),F("h2",xe,"USERS"))]),l("div",Ce,[l("div",Ge,[l("div",Ve,[n(D,{modelValue:e.newUser,"onUpdate:modelValue":r[2]||(r[2]=t=>e.newUser=t),suggestions:e.allUsers,onComplete:r[3]||(r[3]=t=>e.fetchAllUsers(t)),optionLabel:"sellout_code",emptySearchMessage:"Nessun risultato",emptySelectionMessage:"Nessun risultato",placeholder:"Search user by sellout code"},{item:p(t=>[l("div",null,S(t.item.full_name)+" ("+S(t.item.email)+") ",1)]),_:1},8,["modelValue","suggestions"])]),n(w,{label:"Add user",class:"p-button-outlined",onClick:e.addUserToGroup,disabled:!e.newUser},null,8,["onClick","disabled"])]),l("div",Fe,[Se,n(T,{mode:"basic",name:"demo",customUpload:!0,onUploader:e.importFileUsers,auto:!0,chooseLabel:"Import user",class:"p-button-outlined"},null,8,["onUploader"])])]),n(k,{value:e.tmp_group.users,paginator:!1,class:"p-datatable-customers",rows:10,dataKey:"id",rowHover:!0,filters:e.filters,"onUpdate:filters":r[4]||(r[4]=t=>e.filters=t),filterDisplay:"row"},{empty:p(()=>[O(" No users found. ")]),default:p(()=>[n(d,{field:"sellout_code",header:"Sellout code",filterMatchMode:"contains",ref:"sellout_code",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:p(({filterModel:t,filterCallback:f})=>[n(a,{type:"text",modelValue:t.value,"onUpdate:modelValue":i=>t.value=i,onKeydown:I(i=>f(),["enter"]),class:"p-column-filter",placeholder:"Filter by sellout code"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),n(d,{field:"full_name",header:"Name",filterMatchMode:"contains",ref:"full_name",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:p(({filterModel:t,filterCallback:f})=>[n(a,{type:"text",modelValue:t.value,"onUpdate:modelValue":i=>t.value=i,onKeydown:I(i=>f(),["enter"]),class:"p-column-filter",placeholder:"Search by name"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),n(d,{field:"email",header:"Email"}),n(d,{headerStyle:"width: 4rem; text-align: center",bodyStyle:"text-align: center; overflow: visible"},{body:p(({data:t})=>[re(n(w,{type:"button",onClick:f=>e.confirmDeleteUser(f,t.id),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-3",icon:"pi pi-trash"},null,8,["onClick"]),[[M,"Delete",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","filters"])]),_:1})):K("",!0)]),n(h,null,{message:p(t=>[l("div",De,[l("i",{class:L(t.message.icon),style:{"font-size":"1.5rem"}},null,2),l("p",Te,S(t.message.message),1)])]),_:1})],64)}const Le=se(de,[["render",ke]]);export{Le as default};
