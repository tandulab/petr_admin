import{A as ve}from"./AudienceCard67435.js";import{u as pe,U as fe}from"./UploadImageCard67435.js";import{E as he,G as ge}from"./GalleryImageCard67435.js";import{j as be,k as ye,s as H,h as k,a as L,e as N,f as Ce,g as ke,d as xe,i as te,u as Ee,b as Ve,c as Fe}from"./helpers67435.js";import{r as m,ac as le,_ as ae,b as v,k as Ie,o as s,h as W,v as z,f as t,x as B,g as d,e as c,F as q,A as oe,i as f,B as Ue,w as j,u as we,p as Se,c as J,n as Ae,a as Te,l as D}from"./usetoast.esm67435.js";import{u as De}from"./events67435.js";import{u as Le}from"./country67435.js";import{f as K,a as Q}from"./formatData67435.js";import{u as Ne}from"./useconfirm.esm67435.js";import{v as R}from"./runtime-dom.esm-bundler67435.js";import"./group67435.js";import"./user67435.js";import"./datetime67435.js";const Be={props:{title:String,videoUrl:Boolean},setup(P,l){const u=m(),e=pe(),S=le(),h=m(),E=m(),g=m(),U=_=>{h.value=_.files,u.value||(u.value=[])},b=(_,V)=>{_&&(H(),e.deleteAttachment(_).then(()=>{k(),L(S,{message:"File deleted correctly.",title:""}),o(V)}).catch(A=>{k(),N(S,A)}))},o=_=>{u.value.splice(_,1),u.value.length==0&&(u.value=null)},x=_=>{h.value.splice(_,1)},p=()=>u.value&&u.value.length>0?10-u.value.length:10,y=_=>_.type==="image/jpeg";return l.expose({tmp_attachment:u,files:h,fileUpload:E,folder_url:g}),{tmp_attachment:u,files:h,fileUpload:E,folder_url:g,onSelectedFiles:U,deleteImage:b,formatSize:be,deleteGalleryImage:o,deleteFile:x,checkFileLimit:p,checkIsImage:y,getFileName:ye}}};const je={class:"flex align-items-center justify-content-between"},ze={class:"mb-4"},Pe={class:"flex col-10"},Ge={class:"col-6 flex-column p-0"},Me={key:0},Oe=t("h4",{class:"mb-1 mt-0"},"Pending",-1),qe={class:"flex flex-wrap"},Re={class:"flex align-items-center"},He=["alt","src"],Ye={key:1,class:"pi pi-file text-2xl"},Je={class:"flex flex-column ml-2",style:{"font-size":"12px"}},Ke={class:"mb-1"},Qe={key:0,class:"mb-1 mt-3"},We={class:"flex flex-column"},Xe={key:0,class:"flex align-items-top image mx-2 my-2"},Ze=["src"],$e={key:1,class:"file mr-2"},et=["href"],tt=t("i",{class:"pi pi-file text-2xl mr-2"},null,-1),ot=["onClick"],lt={key:0,class:"text-center"},at=t("b",null,"Drag and drop files to here to upload.",-1),nt=t("p",{class:"text-xs"},"(Maximum size 2 MB)",-1),st=[at,nt];function it(P,l,u,e,S,h){const E=v("Button"),g=v("FileUpload"),U=v("Card"),b=Ie("tooltip");return s(),W(U,{class:"mt-4"},{content:z(()=>[t("div",je,[t("h2",ze,B(u.title),1)]),t("div",Pe,[t("div",Ge,[d(g,{name:"file",url:"https://www.primefaces.org/upload.php",multiple:!0,maxFileSize:2e6,id:"logo",modelValue:e.tmp_attachment,"onUpdate:modelValue":l[0]||(l[0]=o=>e.tmp_attachment=o),customUpload:!0,onSelect:e.onSelectedFiles,fileLimit:e.checkFileLimit(),ref:"fileUpload",disabled:e.tmp_attachment&&e.tmp_attachment.length>=10},{content:z(()=>[e.files&&e.files.length>0?(s(),c("div",Me,[Oe,t("div",qe,[(s(!0),c(q,null,oe(e.files,(o,x)=>(s(),c("div",{key:o.name+o.type+o.size,class:"card m-0 flex border-1 surface-border align-items-center justify-content-between pl-4 pr-3 py-3 w-full my-2"},[t("div",Re,[e.checkIsImage(o)?(s(),c("img",{key:0,role:"presentation",alt:o.name,src:o.objectURL,width:"50",class:"shadow-2"},null,8,He)):(s(),c("i",Ye)),t("div",Je,[t("div",Ke,B(o.name),1),t("div",null,B(e.formatSize(o.size)),1)])]),d(E,{icon:"pi pi-times",onClick:p=>e.deleteFile(x),class:"p-button p-component p-button-icon-only p-fileupload-file-remove p-button-text p-button-danger p-button-rounded"},null,8,["onClick"])]))),128))])])):f("",!0),e.tmp_attachment&&e.tmp_attachment[0]&&e.tmp_attachment[0].id?(s(),c(q,{key:1},[e.files&&e.files.length>0?(s(),c("h4",Qe," Completed ")):f("",!0),t("div",We,[(s(!0),c(q,null,oe(e.tmp_attachment,(o,x)=>(s(),c(q,{key:o.id},[o&&o.url?(s(),c("div",Xe,[e.checkIsImage(o)?(s(),c("img",{key:0,role:"presentation",class:"p-fileupload-file-thumbnail h-4rem w-7rem",src:o.url,style:{border:"1px solid rgb(0 0 0 / 6%)"}},null,8,Ze)):(s(),c("div",$e,[t("a",{href:o.url,target:"_blank",class:"flex align-items-center"},[tt,Ue(B(e.getFileName(o.url)),1)],8,et)])),j(t("i",{class:"pi pi-times p-button-icon text-red-600 cursor-pointer font-semibold icon-delete small",onClick:p=>e.deleteImage(o.id,x)},null,8,ot),[[b,"Delete",void 0,{top:!0}]])])):f("",!0)],64))),128))])],64)):f("",!0)]),empty:z(()=>[e.tmp_attachment?f("",!0):(s(),c("div",lt,st))]),_:1},8,["modelValue","onSelect","fileLimit","disabled"])])])]),_:1})}const ct=ae(Be,[["render",it]]),rt={setup(){const P=m({icon:"pi pi-home",to:"/events"}),l=m(""),u=m([{label:""}]),e=m({}),S=["draft","online","archived"],h=m(""),E=m(!0),g=m(!0),U=m(!0),b=m(),o=m(),x=m(),p=m(),y=m(),_=m(!1),V=m(!1),A=we(),G=Se(),C=le(),i=Ne(),T=De(),ne=Le(),F=J(()=>T.getCurrentEvent),se=J(()=>ne.allCountries),X=J(()=>A.getSelectedCountry),Y=async function(n){H(),T.fetchEventsDetail(n).then(()=>{k(),ie()}).catch(a=>{k(),N(C,a)})},ie=function(){var n,a;if(e.value=Object.assign({},F.value),e.value.country_id=(n=e.value.country)==null?void 0:n.id,h.value=((a=e.value.country)==null?void 0:a.default_language_code)+"",e.value.date=K(F.value.date+""),e.value.bookable_from=K(F.value.bookable_from+""),e.value.bookable_to=K(F.value.bookable_to+""),Ce(b,e),ke(o,e),p.value){const r=e.value.gallery_images_url;r&&r.length>0&&(p.value.tmp_gallery=r),p.value.folder_url=e.value.folder_url}if(y.value){const r=e.value.attachment_urls;r&&r.length>0&&(y.value.tmp_attachment=r)}xe(F,e)},Z=function(){var M;const n=new FormData,a=Object.assign({},e.value);e.value.date&&(a.date=Q(e.value.date)),e.value.bookable_from&&(a.bookable_from=Q(e.value.bookable_from)),e.value.bookable_to&&(a.bookable_to=Q(e.value.bookable_to));const r=o.value.tmp_image,w=p.value.files;if(r&&r.image&&(a.image=r.image),r&&r.video_url&&(a.video_url=o.value.tmp_image.video_url),w&&w.length>0&&w.length>0&&te(w,"event[gallery_images][]",n),p.value&&(a.folder_url=p.value.folder_url),y.value){const O=y.value.files;O&&O.length>0&&O.length>0&&te(O,"event[attachments][]",n)}return a.country_id=(M=a.country)==null?void 0:M.id,delete a.country,(l.value||a.id)&&Ee(F,a),delete a.target_all,delete a.target_clusters,delete a.target_group_ids,Ve(n,a,"event"),Fe(b,n,"event"),n},ce=async function(){const n={id:e.value.id,formData:Z()};T.updateEvents(n).then(()=>{k(),Y(e.value.id+""),L(C,{message:"Event updated correctly.",title:""}),p.value.files=[],p.value.fileUpload.files=[],y.value.files=[],y.value.fileUpload.files=[]}).catch(a=>{k(),N(C,a)})},re=async function(){const n={formData:Z()};T.createEvents(n).then(()=>{k(),Y(F.value.id+""),L(C,{message:"Event created correctly.",title:""}),Te.push({name:"event-detail",params:{id:F.value.id}})}).catch(a=>{k(),N(C,a)})},de=function(){_.value=!0,me(),V.value?L(C,{message:"Check that you have completed the required fields.",title:"",error:!0}):(G.params.id!=""||e.value.id?ce():re(),_.value=!1,H())},me=function(){var n,a;e.value.translations&&((a=(n=e.value.country)==null?void 0:n.language_codes)==null||a.forEach(r=>{I(e.value.translations[r].title),I(e.value.translations[r].description),I(e.value.translations[r].short_description)})),I(e.value.status),I(e.value.date),I(e.value.bookable_from),I(e.value.bookable_to)},I=function(n){if(_.value)return n==""||n==null?V.value=!0:V.value=!1,V.value},$=function(){var n,a,r,w;h.value!=((n=e.value.country)==null?void 0:n.default_language_code)&&(h.value=((a=e.value.country)==null?void 0:a.default_language_code)+"",e.value.translations={},(w=(r=e.value.country)==null?void 0:r.language_codes)==null||w.forEach(M=>{e.value.translations[M]={title:null,description:null}}))},ue=n=>{i.require({group:"push",target:n.currentTarget,message:"Are you sure you want to send the push notification?",icon:"pi pi-exclamation-triangle",acceptLabel:"Send",rejectLabel:"Cancel"})},ee=function(){var n=document.getElementsByClassName("p-confirm-popup-reject")[0];n.click()},_e=async function(){H(),await T.sendPush(l.value).then(()=>{L(C,{message:"Notification sent correctly.",title:"",error:!1}),ee(),k()}).catch(n=>{k(),N(C,n)})};return Ae(async()=>{l.value=G.params.id+"",l.value!=""&&l.value!="undefined"?(Y(l.value),u.value[0]={label:"Edit events"}):(e.value.status="draft",u.value[0]={label:"Add events"},e.value.country=X.value,e.value.country_id=X.value.id,$())}),{home:P,items:u,tmp_events:e,events_status:S,audienceCard:b,selectedLang:h,showCheckboxAll:E,showSelectClusters:g,showSelectGroups:U,submitForm:_,uploadImageCard:o,eventContentCard:x,galleryImageCard:p,uploadAttachmentCard:y,countries:se,validateField:I,saveEvent:de,setSelectedLang:$,confirmSendPush:ue,closePopup:ee,sendPush:_e}},components:{AudienceCard:ve,UploadImageCard:fe,EventContentCard:he,GalleryImageCard:ge,UploadAttachmentCard:ct}};const dt={class:"m-4"},mt={class:"flex justify-content-between align-items-center mb-3"},ut={class:"flex align-items-start justify-content-between"},_t=t("h2",{class:"mb-2"},"EVENT DETAIL",-1),vt={key:0,class:"field col-2 mb-0"},pt={key:0,class:"p-error"},ft={class:"formgrid grid col-10 px-0 xs:col-12"},ht={key:0,class:"field col-6 xs:col-6 flex flex-column"},gt=t("label",{for:"name"},"Location",-1),bt={key:0,class:"formgrid grid col-10 px-0 xs:col-12"},yt={class:"field col-3 xs:col-4"},Ct=t("label",{for:"name"},"Event date*",-1),kt={key:0,class:"p-error"},xt={class:"field col-3 xs:col-4"},Et=t("label",{for:"name"},"Bookable from*",-1),Vt={key:0,class:"p-error"},Ft={class:"field col-3 xs:col-4"},It=t("label",{for:"name"},"Bookable to*",-1),Ut={key:0,class:"p-error"},wt={key:1,class:"formgrid grid col-10 px-0 xs:col-12"},St={class:"field col-3 flex flex-column"},At=t("label",{for:"title"},"Available seats",-1),Tt={class:"field col-3 flex flex-column"},Dt=t("label",{for:"title"},"Number guests per person",-1),Lt={class:"field col-3 mt-4 mb-0"},Nt={class:"field-checkbox"},Bt=t("label",{for:"gift"},"There is a free gift",-1),jt={class:"flex p-3 align-items-center"},zt={class:"pl-2"},Pt={class:"flex align-items-center pb-3 justify-content-end"};function Gt(P,l,u,e,S,h){const E=v("Breadcrumb"),g=v("Button"),U=v("Dropdown"),b=v("InputText"),o=v("Calendar"),x=v("Checkbox"),p=v("Card"),y=v("AudienceCard"),_=v("EventContentCard"),V=v("UploadImageCard"),A=v("GalleryImageCard"),G=v("UploadAttachmentCard"),C=v("ConfirmPopup");return s(),c("div",dt,[t("div",mt,[d(E,{home:e.home,model:e.items,class:"mt-0 p-0"},null,8,["home","model"]),t("div",null,[e.tmp_events.id?(s(),W(g,{key:0,label:"Send push",onClick:l[0]||(l[0]=i=>e.confirmSendPush(i)),class:"mr-3 p-button-outlined",icon:"pi pi-envelope"})):f("",!0),d(g,{label:"Save",onClick:e.saveEvent},null,8,["onClick"])])]),d(p,null,{content:z(()=>[t("div",ut,[_t,e.tmp_events.country?(s(),c("div",vt,[d(U,{modelValue:e.tmp_events.status,"onUpdate:modelValue":l[1]||(l[1]=i=>e.tmp_events.status=i),options:e.events_status,class:D(["w-full capitalize dropdown-status",{"p-invalid":e.validateField(e.tmp_events.status)}])},null,8,["modelValue","options","class"]),e.validateField(e.tmp_events.status)?(s(),c("small",pt,"Campo obbligatorio.")):f("",!0)])):f("",!0)]),t("div",ft,[e.tmp_events.country?(s(),c("div",ht,[gt,d(b,{id:"title",type:"text",modelValue:e.tmp_events.location,"onUpdate:modelValue":l[2]||(l[2]=i=>e.tmp_events.location=i)},null,8,["modelValue"])])):f("",!0)]),e.tmp_events.country?(s(),c("div",bt,[t("div",yt,[Ct,d(o,{inputId:"dateformat",modelValue:e.tmp_events.date,"onUpdate:modelValue":l[3]||(l[3]=i=>e.tmp_events.date=i),dateFormat:"dd/mm/yy",manualInput:!1,class:D({"p-invalid":e.validateField(e.tmp_events.date)}),placeholder:"gg/mm/aaaa"},null,8,["modelValue","class"]),e.validateField(e.tmp_events.date)?(s(),c("small",kt,"Campo obbligatorio.")):f("",!0)]),t("div",xt,[Et,d(o,{inputId:"dateformat",modelValue:e.tmp_events.bookable_from,"onUpdate:modelValue":l[4]||(l[4]=i=>e.tmp_events.bookable_from=i),dateFormat:"dd/mm/yy",manualInput:!1,class:D({"p-invalid":e.validateField(e.tmp_events.bookable_from)}),placeholder:"gg/mm/aaaa"},null,8,["modelValue","class"]),e.validateField(e.tmp_events.bookable_from)?(s(),c("small",Vt,"Campo obbligatorio.")):f("",!0)]),t("div",Ft,[It,d(o,{inputId:"dateformat",modelValue:e.tmp_events.bookable_to,"onUpdate:modelValue":l[5]||(l[5]=i=>e.tmp_events.bookable_to=i),dateFormat:"dd/mm/yy",manualInput:!1,class:D({"p-invalid":e.validateField(e.tmp_events.bookable_to)}),placeholder:"gg/mm/aaaa"},null,8,["modelValue","class"]),e.validateField(e.tmp_events.bookable_to)?(s(),c("small",Ut,"Campo obbligatorio.")):f("",!0)])])):f("",!0),e.tmp_events.country?(s(),c("div",wt,[t("div",St,[At,d(b,{id:"title",type:"text",modelValue:e.tmp_events.seats,"onUpdate:modelValue":l[6]||(l[6]=i=>e.tmp_events.seats=i)},null,8,["modelValue"])]),t("div",Tt,[Dt,d(b,{id:"title",type:"text",modelValue:e.tmp_events.guests,"onUpdate:modelValue":l[7]||(l[7]=i=>e.tmp_events.guests=i)},null,8,["modelValue"])]),t("div",Lt,[t("div",Nt,[d(x,{inputId:"gift",modelValue:e.tmp_events.gift,"onUpdate:modelValue":l[8]||(l[8]=i=>e.tmp_events.gift=i),binary:!0},null,8,["modelValue"]),Bt])])])):f("",!0)]),_:1}),j(d(y,{ref:"audienceCard"},null,512),[[R,e.tmp_events.country]]),e.tmp_events.country&&e.selectedLang?(s(),W(_,{key:0,selectedLang:e.selectedLang,submitForm:e.submitForm,tmp_events:e.tmp_events,ref:"eventContentCard",title:"EVENT CONTENT"},null,8,["selectedLang","submitForm","tmp_events"])):f("",!0),j(d(V,{title:"EVENT MEDIA",videoUrl:!0,ref:"uploadImageCard"},null,512),[[R,e.tmp_events.country]]),j(d(A,{title:"EVENT GALLERY",videoUrl:!0,ref:"galleryImageCard"},null,512),[[R,e.tmp_events.country&&e.tmp_events.id]]),j(d(G,{title:"EVENT ATTACHMENTS",videoUrl:!1,ref:"uploadAttachmentCard"},null,512),[[R,e.tmp_events.country&&e.tmp_events.id]]),d(C,{group:"push",id:"push"},{message:z(i=>[t("div",jt,[t("i",{class:D(i.message.icon),style:{"font-size":"1.5rem"}},null,2),t("p",zt,B(i.message.message),1)]),t("div",Pt,[d(g,{label:"Cancel",class:"mr-3 p-button-text text-500",onClick:e.closePopup},null,8,["onClick"]),d(g,{label:"Send",class:"mr-4",onClick:e.sendPush},null,8,["onClick"])])]),_:1})])}const eo=ae(rt,[["render",Gt]]);export{eo as default};
