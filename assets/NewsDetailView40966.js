import{r as s,p as le,ac as re,u as ie,c as S,n as ce,a as ue,_ as de,b as i,o as c,e as v,f,g as u,h as z,i as d,v as me,w as M,l as I}from"./usetoast.esm40966.js";import{a as A,s as L,h as m,e as D,g as _e,b as pe,c as ve,d as fe,f as we,i as ge}from"./helpers40966.js";import{u as he}from"./user40966.js";import{u as ye}from"./news40966.js";import{u as Ce}from"./category40966.js";import{u as be}from"./group40966.js";import{A as Ne}from"./AudienceCard40966.js";import{U as Se}from"./UploadImageCard40966.js";import{E as De}from"./EventContentCard40966.js";import{a as Fe,f as ke}from"./formatData40966.js";import{u as Ae}from"./useconfirm.esm40966.js";import{v as H}from"./runtime-dom.esm-bundler40966.js";import"./datetime40966.js";const xe={setup(){const B=s({icon:"pi pi-home",to:"/news"}),o=s(""),F=s([{label:""}]),e=s({}),j=["draft","online","archived"],P=s(),w=s(!1),_=s(!1),g=s(),h=s(""),x=s(!0),V=s(!0),E=s(!0),y=s(),C=s(),l=le(),r=re(),b=ye(),G=Ce(),J=be(),K=he(),Q=ie(),X=Ae(),p=S(()=>b.getCurrentNews),N=S(()=>G.allCategories),Y=S(()=>K.userRoles),Z=S(()=>J.allGroups),O=S(()=>Q.getSelectedCountry),T=async function(a){L(),b.fetchNewsDetail(a).then(()=>{m(),te()}).catch(t=>{m(),D(r,t)})},q=function(){var k;const a=new FormData,t=Object.assign({},e.value);e.value.published_at&&(t.published_at=Fe(e.value.published_at));const n=C.value.tmp_image;return n&&n.image&&(t.image=n.image),n&&n.video_url&&(t.video_url=n.video_url),t.country_id=(k=t.country)==null?void 0:k.id,delete t.country,(o.value||t.id)&&_e(p,t),delete t.target_all,delete t.target_clusters,delete t.target_group_ids,pe(a,t,"news"),ve(y,a,"news"),a},$=async function(){const a={id:e.value.id,formData:q()};b.updateNews(a).then(()=>{m(),T(e.value.id+""),A(r,{message:"News updated correctly.",title:""})}).catch(t=>{m(),D(r,t)})},ee=async function(){const a={formData:q()};b.createNews(a).then(()=>{m(),T(p.value.id+""),A(r,{message:"News created correctly.",title:""}),ue.push({name:"news-detail",params:{id:p.value.id}})}).catch(t=>{m(),D(r,t)})},te=function(){var a,t;e.value=Object.assign({},p.value),e.value.country_id=(a=p.value.country)==null?void 0:a.id,h.value=((t=e.value.country)==null?void 0:t.default_language_code)+"",e.value.published_at=ke(p.value.published_at+""),fe(y,e),we(C,e),ge(p,e),e.value.news_category_id=e.value.news_category.id,W(),delete e.value.news_category},ae=function(){U(e.value.published_at),U(e.value.news_category_id)},oe=function(){if(w.value=!0,ae(),_.value){A(r,{message:"Check that you have completed the required fields.",title:"",error:!0});return}o.value!=""||e.value.id?$():ee(),w.value=!1,L()},U=function(a){if(w.value)return a==""||a==null?_.value=!0:_.value=!1,_.value},R=function(a){g.value=[],a.value.forEach(t=>{if(t.country&&t.country.default_language_code){const n={id:t.id,value:t.translations[t.country.default_language_code].name.text};g.value.push(n)}})},W=async function(){if(N.value&&N.value.length>0){R(N);return}const a=new Map;a.set("country_id",e.value.country.id),await G.fetchAllCategories(a).then(()=>{var t;R(N),h.value=((t=e.value.country)==null?void 0:t.default_language_code)+""}).catch(t=>{D(r,t)})},se=a=>{X.require({target:a.currentTarget,message:"Are you sure you want to send the push notification?",icon:"pi pi-exclamation-triangle",acceptLabel:"Send",rejectLabel:"Cancel",accept:()=>{ne()}})},ne=async function(){L(),await b.sendPush(o.value).then(()=>{A(r,{message:"Notification sent correctly.",title:"",error:!0}),m()}).catch(a=>{m(),D(r,a)})};return ce(async()=>{var a,t,n;o.value=l.params.id+"",o.value!=""&&o.value!="undefined"?(T(o.value),F.value[0]={label:"Edit news"}):(e.value.status="draft",F.value[0]={label:"Add news"},e.value.country_id=O.value.id,e.value.country=O.value,h.value=((a=e.value.country)==null?void 0:a.default_language_code)+"",W(),e.value.translations||(e.value.translations={},(n=(t=e.value.country)==null?void 0:t.language_codes)==null||n.forEach(k=>{e.value.translations[k]={title:null,short_description:null,description:null}})))}),{home:B,items:F,tmp_news:e,filteredUsers:P,filteredCategories:g,selectedLang:h,showCheckboxAll:x,showSelectClusters:V,showSelectGroups:E,userRoles:Y,allGroups:Z,news_status:j,audienceCard:y,uploadImageCard:C,submitForm:w,categories:N,saveNews:oe,validateField:U,confirmSendPush:se}},components:{AudienceCard:Ne,UploadImageCard:Se,EventContentCard:De}};const Ve={class:"m-4"},Ee={class:"flex justify-content-between align-items-center mb-3"},Te={class:"flex align-items-center justify-content-between"},Ue=f("h2",{class:"mb-2"},"NEWS DETAIL",-1),Ie={key:0,class:"field col-2 mb-0"},Le={key:0,class:"p-error"},Be={class:"formgrid grid col-10 px-0 xs:col-12"},je={key:0,class:"field col-4 xs:col-6"},Pe=f("label",{for:"shipping_country"},"Category*",-1),Ge={key:0,class:"p-error"},Oe={key:1,class:"field col-4 xs:col-6"},qe=f("label",{for:"name"},"Published at*",-1),Re={key:0,class:"p-error"};function We(B,o,F,e,j,P){const w=i("Breadcrumb"),_=i("Button"),g=i("Dropdown"),h=i("Calendar"),x=i("Card"),V=i("AudienceCard"),E=i("EventContentCard"),y=i("UploadImageCard"),C=i("ConfirmPopup");return c(),v("div",Ve,[f("div",Ee,[u(w,{home:e.home,model:e.items,class:"mt-0 p-0"},null,8,["home","model"]),f("div",null,[u(_,{label:"Save",onClick:e.saveNews},null,8,["onClick"]),e.tmp_news.id?(c(),z(_,{key:0,label:"Send push",onClick:o[0]||(o[0]=l=>e.confirmSendPush(l)),class:"ml-3 p-button-outlined",icon:"pi pi-envelope"})):d("",!0)])]),u(x,null,{content:me(()=>[f("div",Te,[Ue,e.tmp_news.country?(c(),v("div",Ie,[u(g,{modelValue:e.tmp_news.status,"onUpdate:modelValue":o[1]||(o[1]=l=>e.tmp_news.status=l),options:e.news_status,class:I(["w-full capitalize dropdown-status",{"p-invalid":e.validateField(e.tmp_news.status)}])},null,8,["modelValue","options","class"]),e.validateField(e.tmp_news.status)?(c(),v("small",Le,"Campo obbligatorio.")):d("",!0)])):d("",!0)]),f("div",Be,[e.tmp_news.country?(c(),v("div",je,[Pe,u(g,{modelValue:e.tmp_news.news_category_id,"onUpdate:modelValue":o[2]||(o[2]=l=>e.tmp_news.news_category_id=l),options:e.filteredCategories,optionLabel:"value",optionValue:"id",class:I(["w-full",{"p-invalid":e.validateField(e.tmp_news.news_category_id)}])},null,8,["modelValue","options","class"]),e.validateField(e.tmp_news.news_category_id)?(c(),v("small",Ge,"Campo obbligatorio.")):d("",!0)])):d("",!0),e.tmp_news.country?(c(),v("div",Oe,[qe,u(h,{inputId:"dateformat",modelValue:e.tmp_news.published_at,"onUpdate:modelValue":o[3]||(o[3]=l=>e.tmp_news.published_at=l),dateFormat:"dd/mm/yy",manualInput:!1,class:I({"p-invalid":e.validateField(e.tmp_news.published_at)}),placeholder:"gg/mm/aaaa"},null,8,["modelValue","class"]),e.validateField(e.tmp_news.published_at)?(c(),v("small",Re,"Campo obbligatorio.")):d("",!0)])):d("",!0)])]),_:1}),M(u(V,{ref:"audienceCard"},null,512),[[H,e.tmp_news.country]]),e.tmp_news.country&&e.selectedLang?(c(),z(E,{key:0,selectedLang:e.selectedLang,submitForm:e.submitForm,tmp_events:e.tmp_news,title:"NEWS CONTENT"},null,8,["selectedLang","submitForm","tmp_events"])):d("",!0),M(u(y,{title:"NEWS MEDIA",videoUrl:!0,ref:"uploadImageCard"},null,512),[[H,e.tmp_news.country]]),u(C)])}const ot=de(xe,[["render",We]]);export{ot as default};
