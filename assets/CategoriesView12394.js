import{o as R,u as I,c as F,af as P,r as u,_ as O,b as _,l as W,e as d,f as m,h as p,B as x,E as G,F as H,D as J,C as N,j as q,w as M,n as X,g as k,m as Y}from"./usetoast.esm12394.js";import{u as K}from"./useconfirm.esm12394.js";import{u as A}from"./category12394.js";import{f as Z}from"./formatData12394.js";import{e as L,a as z,s as U,h as S}from"./helpers12394.js";import"./datetime12394.js";const $={setup(D,c){R(()=>{o()});const r=A(),e=K(),T=I(),y=F(()=>T.getSelectedCountry),g=F(()=>r.allCategories),t=P(),i=u(!0),f=u([{label:"My Filter",value:"myfilter"}]),n=u(!1);u({}),u();const a=u(!1);function o(){i.value=!0,setTimeout(()=>{V()},Math.random()*1e3+250)}const V=async function(){const l=new Map;l.set("country_id",y.value.id),await r.fetchAllCategories(l).then(()=>{i.value=!1}).catch(C=>{i.value=!1,L(t,C)})},j=(l,C)=>{C.users_counter>0?e.require({target:l.currentTarget,message:"The category cannot be deleted because there are associated users.",icon:"pi pi-exclamation-triangle",rejectClass:"hidden",acceptClass:"hidden"}):e.require({target:l.currentTarget,message:"Are you sure you want to remove this category?",icon:"pi pi-exclamation-triangle",accept:()=>{v(C.id)}})},v=async function(l){await r.deleteCategory(l).then(()=>{z(t,{message:"Category deleted correctly.",title:""}),o()}).catch(C=>{L(t,C)})},w=function(l){return n.value?l==""||l==null:!1},B=l=>{c.emit("editCategory",l)};return c.expose({loadLazyData:o}),{categories:g,loading:i,loadLazyData:o,matchModes:f,toggleEdit:B,confirmDeleteCategory:j,formatDataFromSql:Z,isVisible:a,validateField:w}}};const ee={class:"col-5 col-xs-12 col-md-12"},te={key:0};function ae(D,c,r,e,T,y){const g=_("Column"),t=_("Button"),i=_("DataTable"),f=_("ConfirmPopup"),n=W("tooltip");return d(),m("div",ee,[p(i,{value:e.categories,lazy:!0,loading:e.loading},{empty:x(()=>[G(" No categories found. ")]),default:x(()=>[p(g,{field:"translations",header:"Name"},{body:x(({data:a})=>[(d(!0),m(H,null,J(a.country.language_codes,o=>(d(),m("span",{key:o,class:"name"},[a.translations[o]&&a.translations[o].name?(d(),m("span",te,N(a.translations[o].name.text),1)):q("",!0)]))),128))]),_:1}),p(g,{header:"",style:{width:"9rem"}},{body:x(({data:a})=>[M(p(t,{type:"button",onClick:o=>e.toggleEdit(a),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-3",icon:"pi pi-pencil"},null,8,["onClick"]),[[n,"Edit",void 0,{top:!0}]]),M(p(t,{type:"button",onClick:o=>e.confirmDeleteCategory(o,a),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-3",icon:"pi pi-trash",disabled:!a.can_delete},null,8,["onClick","disabled"]),[[n,"Delete",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","loading"]),p(f)])}const oe=O($,[["render",ae]]),se={setup(){const D=A(),c=K(),r=u({}),e=u({}),T=I(),y=P(),g=A(),t=u(!1),i=u(!1),f=u(),n=u(),a=F(()=>D.getTotalCategories),o=F(()=>T.getSelectedCountry),V=s=>{s?j(s):c.require({group:"templating",header:"New Category",accept:()=>{if(t.value=!0,w(e.value[n.value]))t.value=!1,v();else{t.value=!1,B();return}},reject:()=>{t.value=!1,i.value=!1,v()},acceptLabel:"Save",rejectLabel:"Cancel"})},j=function(s){s.translations[n.value]&&s.translations[n.value].name.text&&(e.value[n.value]=s.translations[n.value].name.text+""),c.require({group:"templating",header:"Edit Category",accept:()=>{if(t.value=!0,w(e.value[n.value]))t.value=!1,v();else{t.value=!1,l(s.translations);return}},reject:()=>{t.value=!1,i.value=!1,v()},acceptLabel:"Save",rejectLabel:"Cancel"})},v=function(){e.value[n.value]=""},w=function(s){return t.value?s==""||s==null:!1},B=async function(){var b;U(),r.value.translations={};for(const h in e.value)r.value.translations[h]={name:e.value[h]};r.value.country_id=(b=r.value.country)==null?void 0:b.id;const s={news_category:r.value};g.createCategory(s).then(()=>{S(),z(y,{message:"Category created correctly.",title:""}),f.value.loadLazyData(),t.value=!1,v()}).catch(h=>{S(),L(y,h),t.value=!1})},l=async function(s){U();for(const[b,h]of Object.entries(s)){const E=h.name.id,Q=e.value[b];C(E,Q)}},C=function(s,b){const h={id:s,text:b};g.editCategory(h).then(()=>{S(),z(y,{message:"Category edited correctly",title:""}),f.value.loadLazyData(),t.value=!1,v()}).catch(E=>{S(),L(y,E),t.value=!1})};return X(async()=>{r.value.country=o.value,n.value=o.value.default_language_code}),{totalCategory:a,confirm:c,tmp_category:r,labels:e,categoriesTable:f,showTemplate:V,validateField:w,isVisible:i}},components:{CategoriesTable:oe}},ne={class:"flex justify-content-between align-items-center"},le={class:"uppercase"},re={key:0},ce={key:1},ie={key:0,class:"formgrid grid col-12"},ue={class:"field col-12 flex p-0 flex-column"},de={for:"name"},me={class:"uppercase"},pe={key:0,class:"p-error"};function ge(D,c,r,e,T,y){const g=_("Button"),t=_("CategoriesTable"),i=_("InputText"),f=_("ConfirmDialog"),n=_("Card");return d(),m("div",null,[p(n,null,{content:x(()=>[k("div",ne,[k("h1",le,[e.totalCategory==1?(d(),m("span",re," 1 Category")):(d(),m("span",ce,N(e.totalCategory)+" Categories",1))]),p(g,{label:"category",onClick:c[0]||(c[0]=a=>e.showTemplate(null)),icon:"pi pi-plus",class:"mb-3"})]),p(t,{ref:"categoriesTable",onEditCategory:c[1]||(c[1]=a=>e.showTemplate(a))},null,512),p(f,{group:"templating",style:{width:"20vw"}},{message:x(()=>[e.tmp_category.country?(d(),m("div",ie,[k("div",ue,[(d(!0),m(H,null,J(e.tmp_category.country.language_codes,a=>(d(),m("div",{key:a,class:"col-12 mb-4"},[k("label",de,[G("Name "),k("span",me,"("+N(a)+")",1)]),p(i,{id:"name",type:"text",modelValue:e.labels[a],"onUpdate:modelValue":o=>e.labels[a]=o,class:Y(["w-full",{"p-invalid":e.validateField(e.tmp_category.name)}]),require:""},null,8,["modelValue","onUpdate:modelValue","class"]),e.validateField(e.tmp_category.name)?(d(),m("small",pe,"Campo obbligatorio.")):q("",!0)]))),128))])])):q("",!0)]),_:1})]),_:1})])}const be=O(se,[["render",ge]]);export{be as default};
