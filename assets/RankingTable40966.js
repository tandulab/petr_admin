import{a as C}from"./api.esm40966.js";import{ab as K,p as R,u as S,c as U,ac as T,r as f,a as D,_ as O,b as v,k as B,o as m,e as h,g as l,v as i,B as F,x as g,h as P,w as q,i as E}from"./usetoast.esm40966.js";import{u as I}from"./insight40966.js";import{e as N}from"./helpers40966.js";import{w as _}from"./runtime-dom.esm-bundler40966.js";const A={setup(){K(()=>{p.value=!0,d.value={first:0,rows:u.value.rows,sortField:null,sortOrder:null,filters:c.value},C.register("myfilter",(t,a)=>t===a),e()});const o=R(),y=I(),k=S(),n=U(()=>y.getCurrentRanking),V=U(()=>k.getSelectedCountry),x=T(),u=f(),c=f({sellout_code:{value:"",matchMode:"contains"},name:{value:"",matchMode:"contains"},vat_cf:{value:"",matchMode:"contains"},current:{value:"",matchMode:"contains"},target:{value:"",matchMode:"contains"},parent_name:{value:"",matchMode:"contains"}}),p=f(!0),d=f(),w=f(0),b=f([{label:"My Filter",value:"myfilter"}]);function e(){p.value=!0;const t=new Map;s(t),t.set("page",d.value.page+1),t.set("per_page",d.value.rows),d.value.sortField&&(d.value.sortOrder==1?t.set("sorted_by",d.value.sortField+"_asc"):t.set("sorted_by",d.value.sortField+"_desc")),setTimeout(()=>{r(t)},Math.random()*1e3+250)}const s=function(t){var a=o.params.cluster;a=="workshop"&&(a="user"),a=="distributor"&&(a="dealer"),o.params.second_user_id?(t.set("parent_id",o.params.second_user_id),a=="dealer"?a="agent":a="user"):o.params.user_id&&(t.set("parent_id",o.params.user_id),a=="dealer"?a="agent":a="user"),t.set("year",o.params.year),t.set("cluster",a),t.set("quarter",o.params.quarter),t.set("country_id",V.value.id)},r=async function(t){await y.getInsightsRanking(t).then(()=>{p.value=!1}).catch(a=>{p.value=!1,N(x,a)})};return{dt:u,responseRanking:n,filters:c,loading:p,totalRecords:w,lazyParams:d,matchModes:b,route:o,toggleEdit:function(t){let a={year:o.params.year,cluster:o.params.cluster,quarter:o.params.quarter};t.name&&(a.company=t.name),(t.user_role=="dealer"||o.params.cluster=="agent"&&t.user_role=="agent")&&(a.user_id=t.user_id),t.user_role=="agent"&&o.params.cluster=="distributor"&&(a.user_id=o.params.user_id,a.second_user_id=t.user_id),o.params.cluster=="distributor"&&t.user_role=="agent"&&(a.user_name=t.name,a.company=o.params.company);let M=o.name;o.name=="ranking"?M="sub-ranking":M="ranking",D.push({name:M,params:a})},loadLazyData:e,setParams:s}}},z={key:0},L={key:1},j={key:0},G={key:1},H={key:2};function J(o,y,k,n,V,x){const u=v("Column"),c=v("InputText"),p=v("Button"),d=v("DataTable"),w=v("ConfirmPopup"),b=B("tooltip");return m(),h("div",null,[l(d,{value:n.responseRanking,paginator:!0,rows:30,filters:n.filters,"onUpdate:filters":y[0]||(y[0]=e=>n.filters=e),ref:"dt",dataKey:"id",loading:n.loading,filterDisplay:"row",removableSort:""},{empty:i(()=>[F(" No ranking found. ")]),default:i(()=>[l(u,{header:"#",field:"id",headerStyle:"width:5rem",sortable:""}),l(u,{field:"sellout_code",header:"Sellout code",ref:"sellout_code",filterMatchMode:"contains",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1,sortable:""},{filter:i(({filterModel:e,filterCallback:s})=>[l(c,{type:"text",modelValue:e.value,"onUpdate:modelValue":r=>e.value=r,onKeydown:_(r=>s(),["enter"]),class:"p-column-filter",placeholder:"Filter by sellout code"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),l(u,{header:"",field:"name",ref:"name",filterMatchMode:"contains",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1,sortable:""},{header:i(()=>[n.route.params.cluster=="agent"?(m(),h("span",z,"Agent")):(m(),h("span",L,"Company"))]),filter:i(({filterModel:e,filterCallback:s})=>[l(c,{type:"text",modelValue:e.value,"onUpdate:modelValue":r=>e.value=r,onKeydown:_(r=>s(),["enter"]),class:"p-column-filter",placeholder:"Filter by company"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),l(u,{header:"Vat code",field:"vat_cf",ref:"vat",filterMatchMode:"contains",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1,sortable:""},{filter:i(({filterModel:e,filterCallback:s})=>[l(c,{type:"text",modelValue:e.value,"onUpdate:modelValue":r=>e.value=r,onKeydown:_(r=>s(),["enter"]),class:"p-column-filter",placeholder:"Filter by vat code"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),l(u,{header:"",field:"parent_name",ref:"parent_name",filterMatchMode:"contains",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1,sortable:""},{header:i(()=>[n.route.params.cluster=="workshop"?(m(),h("span",j,"Agent")):n.route.params.cluster=="agent"?(m(),h("span",G,"Distributor")):(m(),h("span",H,"Parent company"))]),filter:i(({filterModel:e,filterCallback:s})=>[l(c,{type:"text",modelValue:e.value,"onUpdate:modelValue":r=>e.value=r,onKeydown:_(r=>s(),["enter"]),class:"p-column-filter",placeholder:"Filter by company"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),l(u,{header:"Sell out",field:"current",filterMatchMode:"contains",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1,sortable:""},{body:i(({data:e})=>[F(g(parseFloat(e.current).toFixed(2))+" "+g(e.unit),1)]),filter:i(({filterModel:e,filterCallback:s})=>[l(c,{type:"text",modelValue:e.value,"onUpdate:modelValue":r=>e.value=r,onKeydown:_(r=>s(),["enter"]),class:"p-column-filter",placeholder:"Filter by sell out"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1}),l(u,{header:"Target",field:"target",filterMatchMode:"contains",showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1,sortable:""},{body:i(({data:e})=>[F(g(parseFloat(e.target).toFixed(2))+" "+g(e.unit),1)]),filter:i(({filterModel:e,filterCallback:s})=>[l(c,{type:"text",modelValue:e.value,"onUpdate:modelValue":r=>e.value=r,onKeydown:_(r=>s(),["enter"]),class:"p-column-filter",placeholder:"Filter by target"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1}),n.responseRanking&&n.responseRanking[0]&&n.responseRanking[0].user_role!="user"?(m(),P(u,{key:0,header:"",style:{width:"4rem"}},{body:i(({data:e})=>[q(l(p,{type:"button",onClick:s=>n.toggleEdit(e),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-3",icon:"pi ranking-icon"},null,8,["onClick"]),[[b,"View detail",void 0,{top:!0}]])]),_:1})):E("",!0)]),_:1},8,["value","filters","loading"]),l(w)])}const ee=O(A,[["render",J]]);export{ee as R};
