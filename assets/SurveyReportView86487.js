import{r as n,q as j,af as L,as as O,c as Q,n as q,ag as N,_ as U,b as y,e as v,f,g as r,h as m,B as A,C as h,j as k}from"./usetoast.esm86487.js";import{s as R,h as a,e as b}from"./helpers86487.js";import{u as S}from"./survey86487.js";const P={setup(){const g=n({icon:"pi pi-home",to:"/surveys"}),c=n(""),u=n(""),e=n([{label:"Report Survey"}]);n({});const w=n(),x=n(),d=n(),p=j(),l=L(),i=S(),{survey:_}=O(S()),B=Q(()=>i.getReportSurvey),D=async function(o){R(),i.fetchSurveyReport(o).then(()=>{a(),d.value=C()}).catch(t=>{a(),b(l,t)})},C=()=>{const o=[],t=[];return B.value.answers.forEach(s=>{t.push(s.percentage),o.push(s.text.text)}),{chartData:{datasets:[{data:t,backgroundColor:["#cd1867","#DB4CB3","#EABB3D","#B958D8","#a1c653","#009265"]}],labels:o},chartOptions:{maintainAspectRatio:.5,plugins:{legend:{display:!1},tooltip:{callbacks:{label:s=>`${s.formattedValue}%`}}}}}},E=async function(o){R(),i.fetchSurveyDetail(o).then(()=>{a()}).catch(t=>{a(),b(l,t)})},V=function(){var t;const o=(t=_.value.country)==null?void 0:t.default_language_code;if(o)return _.value.translations[o].title.text},T=async function(){R();try{const t=await N({method:"get",url:`/surveys/${c.value}/download_answers`,responseType:"blob"});var o=new Blob([t.data],{type:t.headers["content-type"]});const s=document.createElement("a");s.href=window.URL.createObjectURL(o),s.download="report_survey.xlsx",s.click(),a()}catch(t){a(),b(l,t)}};return q(async()=>{c.value=p.params.id+"",u.value=p.params.typology+"",E(c.value),u.value=="closed"&&D(c.value)}),{home:g,items:e,lang:w,question:x,survey:_,survey_chart:d,survey_typology:u,surveyReport:B,getQuestion:V,chartReport:C,downloadReport:T}},components:{}},Y={class:"m-4"},z={class:"flex justify-content-between align-items-center mb-3"},F={class:"flex align-items-center justify-content-between"},G=r("h2",{class:"mb-2"},"REPORT SURVEY",-1),H={key:0,class:"col-5 px-0 mt-3"},I={class:"text-center font-semibold mb-2 mt-0"},J={key:1,class:"flex flex-column mt-3"},K={class:"mb-1"};function M(g,c,u,e,w,x){const d=y("Breadcrumb"),p=y("Button"),l=y("Chart"),i=y("Card");return v(),f("div",Y,[r("div",z,[m(d,{home:e.home,model:e.items,class:"mt-0 p-0"},null,8,["home","model"])]),m(i,null,{content:A(()=>[r("div",F,[G,m(p,{class:"p-button-outlined p-button-secondary",label:"Report",icon:"pi pi-download",onClick:e.downloadReport},null,8,["onClick"])]),e.survey_typology=="closed"&&e.survey.id&&e.surveyReport&&e.surveyReport.answers&&e.survey_chart?(v(),f("div",H,[r("p",I,h(e.getQuestion())+" - Respondents: "+h(e.surveyReport.total),1),m(l,{type:"bar",data:e.survey_chart.chartData,options:e.survey_chart.chartOptions},null,8,["data","options"])])):k("",!0),e.survey_typology=="open"&&e.surveyReport?(v(),f("div",J,[r("span",K,"Question: "+h(e.getQuestion()),1),r("span",null,"Respondents: "+h(e.surveyReport.total||"-"),1)])):k("",!0)]),_:1})])}const $=U(P,[["render",M]]);export{$ as default};
