import{e as j,s as L,j as O}from"./usetoast.esm96104.js";import{r as n,k as Q,c as q,n as N,_ as U,a as y,o as v,b as f,e as r,f as m,q as A,t as h,h as C}from"./_plugin-vue_export-helper96104.js";import{s as R,h as a,e as b}from"./helpers96104.js";import{u as S}from"./survey96104.js";const P={setup(){const g=n({icon:"pi pi-home",to:"/surveys"}),c=n(""),u=n(""),t=n([{label:"Report Survey"}]);n({});const w=n(),x=n(),d=n(),p=Q(),l=j(),i=S(),{survey:_}=L(S()),k=q(()=>i.getReportSurvey),D=async function(o){R(),i.fetchSurveyReport(o).then(()=>{a(),d.value=B()}).catch(e=>{a(),b(l,e)})},B=()=>{const o=[],e=[];return k.value.answers.forEach(s=>{e.push(s.percentage),o.push(s.text.text)}),{chartData:{datasets:[{data:e,backgroundColor:["#cd1867","#DB4CB3","#EABB3D","#B958D8","#a1c653","#009265"]}],labels:o},chartOptions:{maintainAspectRatio:.5,plugins:{legend:{display:!1},tooltip:{callbacks:{label:s=>`${s.formattedValue}%`}}}}}},E=async function(o){R(),i.fetchSurveyDetail(o).then(()=>{a()}).catch(e=>{a(),b(l,e)})},V=function(){var e;const o=(e=_.value.country)==null?void 0:e.default_language_code;if(o)return _.value.translations[o].title.text},T=async function(){R();try{const e=await O({method:"get",url:`/surveys/${c.value}/download_answers`,responseType:"blob"});var o=new Blob([e.data],{type:e.headers["content-type"]});const s=document.createElement("a");s.href=window.URL.createObjectURL(o),s.download="report_survey.xlsx",s.click(),a()}catch(e){a(),b(l,e)}};return N(async()=>{c.value=p.params.id+"",u.value=p.params.typology+"",E(c.value),u.value=="closed"&&D(c.value)}),{home:g,items:t,lang:w,question:x,survey:_,survey_chart:d,survey_typology:u,surveyReport:k,getQuestion:V,chartReport:B,downloadReport:T}},components:{}},Y={class:"m-4"},z={class:"flex justify-content-between align-items-center mb-3"},F={class:"flex align-items-center justify-content-between"},G=r("h2",{class:"mb-2"},"REPORT SURVEY",-1),H={key:0,class:"col-5 px-0 mt-3"},I={class:"text-center font-semibold mb-2 mt-0"},J={key:1,class:"flex flex-column mt-3"},K={class:"mb-1"};function M(g,c,u,t,w,x){const d=y("Breadcrumb"),p=y("Button"),l=y("Chart"),i=y("Card");return v(),f("div",Y,[r("div",z,[m(d,{home:t.home,model:t.items,class:"mt-0 p-0"},null,8,["home","model"])]),m(i,null,{content:A(()=>[r("div",F,[G,m(p,{class:"p-button-outlined p-button-secondary",label:"Report",icon:"pi pi-download",onClick:t.downloadReport},null,8,["onClick"])]),t.survey_typology=="closed"&&t.survey.id&&t.surveyReport&&t.surveyReport.answers&&t.survey_chart?(v(),f("div",H,[r("p",I,h(t.getQuestion())+" - Respondents: "+h(t.surveyReport.total),1),m(l,{type:"bar",data:t.survey_chart.chartData,options:t.survey_chart.chartOptions},null,8,["data","options"])])):C("",!0),t.survey_typology=="open"&&t.surveyReport?(v(),f("div",J,[r("span",K,"Question: "+h(t.getQuestion()),1),r("span",null,"Respondents: "+h(t.surveyReport.total||"-"),1)])):C("",!0)]),_:1})])}const tt=U(P,[["render",M]]);export{tt as default};
