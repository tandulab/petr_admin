import{u as pe}from"./user12394.js";import{D as _e}from"./datetime12394.js";import{u as H}from"./useconfirm.esm12394.js";import{r as g,_ as M,b as m,l as me,e as l,f as r,g as o,C as w,w as Q,h as _,F as L,D as O,E as D,j as y,n as W,i as Y,B as V,af as X,u as fe,q as he,c as F,a as ge,m as ve}from"./usetoast.esm12394.js";import{k as ye,l as xe,s as Z,h as S,a as E,e as P,i as be,m as J,b as ke}from"./helpers12394.js";import{u as Ce}from"./insight12394.js";import{u as we}from"./product12394.js";import{u as Se,U as Ue}from"./UploadImageCard12394.js";const De={props:{target:Object},setup(){const k=H(),t=g({});return{confirm:k,insight:t}}};const Ve={key:0,class:"insight border-round-lg m-2 border-300 border-solid border-1 p-3 h-full pt-2"},Ie={class:"flex align-items-center justify-content-between mb-2"},ze={class:"my-0"},Fe={key:0},Te={key:1},Re={class:"actions"},Be={key:0,class:"text-sm"},Ae={class:"truncate-products"},Ee={key:0},Pe={key:0},je={class:"uppercase"},Ne={key:1},Le=o("p",{class:"text-center"},[o("i",null,"Insight not configured")],-1),Oe=[Le];function Me(k,t,i,e,v,f){const x=m("Button"),h=me("tooltip");return i.target?(l(),r("div",Ve,[o("div",Ie,[o("h2",ze,[i.target.quarter==0?(l(),r("span",Fe,"YEAR")):(l(),r("span",Te,"Q"+w(i.target.quarter),1))]),o("div",Re,[Q(_(x,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-2",icon:"pi pi-pencil",onClick:t[0]||(t[0]=c=>k.$emit("open",i.target))},null,512),[[h,"Edit",void 0,{top:!0}]]),Q(_(x,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-0",icon:"pi ranking-icon",onClick:t[1]||(t[1]=c=>k.$emit("ranking",i.target))},null,512),[[h,"Ranking",void 0,{top:!0}]])])]),i.target.products.length>0||i.target.all_products?(l(),r("div",Be,[o("div",Ae,[i.target.all_products?(l(),r("span",Ee," All products ")):(l(!0),r(L,{key:1},O(i.target.products,(c,a)=>(l(),r("span",{key:c.id,class:"mb-1 inline-block mr-1 text-sm"},[a!=0?(l(),r("span",Pe," / ")):y("",!0),D(" "+w(c.name),1)]))),128))]),o("p",null,[D(" Units: "),o("span",je,w(i.target.unit),1)])])):(l(),r("div",Ne,Oe))])):y("",!0)}const qe=M(De,[["render",Me]]),Je={props:{title:String,tmp_insight:{}},setup(k,{emit:t}){return W(async()=>{}),{catchEvent:f=>{t("open",f)},catchEventRanking:f=>{t("ranking",f)},catchDetailRanking:f=>{t("detail",f)}}},components:{InsightCard:qe}},Ye={class:"flex justify-content-between align-items-center"},Ge={class:"uppercase"},Ke={class:"grid col-12 mb-4"};function Qe(k,t,i,e,v,f){const x=m("InsightCard"),h=m("Card");return l(),Y(h,{class:"mt-4"},{content:V(()=>[o("div",Ye,[o("h2",Ge,w(i.title),1)]),o("div",Ke,[(l(!0),r(L,null,O(i.tmp_insight,c=>(l(),r("div",{key:c,class:"flex-1"},[_(x,{target:c,onOpen:t[0]||(t[0]=a=>e.catchEvent(a)),onRanking:t[1]||(t[1]=a=>e.catchEventRanking(a)),onDetail:t[2]||(t[2]=a=>e.catchDetailRanking(a))},null,8,["target"])]))),128))])]),_:1})}const He=M(Je,[["render",Qe]]),We={props:{title:String,videoUrl:Boolean},setup(k,t){const i=g({}),e=Se(),v=X(),f=g(),x=a=>{i.value.file_url={},i.value.file=a.files[0]},h=async()=>{const a=i.value.file_url.id;a?(Z(),await e.deleteAttachment(a).then(()=>{S(),E(v,{message:"File deleted correctly.",title:""}),c()}).catch(T=>{S(),P(v,T)})):c()},c=()=>{i.value={},f.value.files=[]};return t.expose({tmp_file:i,deleteFile:h}),{tmp_file:i,fileUpload:f,onSelectedFiles:x,deleteFile:h,formatSize:ye,getFileName:xe,deleteTmpFile:c}}};const Xe={class:"flex align-items-center justify-content-between"},Ze={class:"mb-4"},$e={class:"flex col-10"},et={class:"col-6 flex-column p-0"},tt={key:0,class:"card m-0 flex border-1 surface-border align-items-center justify-content-between pl-4 pr-3 py-3 w-full my-2"},ot={class:"flex align-items-center"},st=o("i",{class:"pi pi-file text-2xl"},null,-1),nt={key:0,class:"flex flex-column ml-2 file",style:{"font-size":"12px"}},lt={class:"mb-1"},it={key:1,class:"flex flex-column ml-2 file",style:{"font-size":"12px"}},at={class:"mb-1"},rt={key:0,class:"text-center"},dt=o("b",null,"Drag and drop file to here to upload.",-1),ct=o("p",{class:"text-xs"},"(Maximum size 2 MB)",-1),ut=[dt,ct];function pt(k,t,i,e,v,f){const x=m("Button"),h=m("FileUpload"),c=m("Card");return l(),Y(c,{class:"mt-4"},{content:V(()=>[o("div",Xe,[o("h2",Ze,w(i.title),1)]),o("div",$e,[o("div",et,[_(h,{name:"file",url:"https://www.primefaces.org/upload.php",multiple:!1,accept:"application/pdf",maxFileSize:2e6,id:"logo",modelValue:e.tmp_file.file,"onUpdate:modelValue":t[1]||(t[1]=a=>e.tmp_file.file=a),customUpload:!0,onSelect:e.onSelectedFiles,onRemove:e.deleteTmpFile,fileLimit:1,ref:"fileUpload"},{content:V(()=>[e.tmp_file.file||e.tmp_file.file_url&&e.tmp_file.file_url.url?(l(),r("div",tt,[o("div",ot,[st,e.tmp_file.file&&e.tmp_file.file.name?(l(),r("div",nt,[o("div",lt,w(e.tmp_file.file.name),1),o("div",null,w(e.formatSize(e.tmp_file.file.size)),1)])):y("",!0),e.tmp_file.file_url&&e.tmp_file.file_url.url?(l(),r("div",it,[o("div",at,w(e.getFileName(e.tmp_file.file_url.url)),1)])):y("",!0)]),_(x,{icon:"pi pi-times sdfsdf",onClick:t[0]||(t[0]=a=>e.deleteFile()),class:"p-button p-component p-button-icon-only p-fileupload-file-remove p-button-text p-button-danger p-button-rounded"})])):y("",!0)]),empty:V(()=>[e.tmp_file.file_url?y("",!0):(l(),r("div",rt,ut))]),_:1},8,["modelValue","onSelect","onRemove"])])])]),_:1})}const _t=M(We,[["render",pt]]),mt={setup(){const k=g({icon:"pi pi-home",to:"/dashboard"}),t=g(),i=g([{label:"Dashboard"}]),e=g([]),v=g(),f=g({}),x=g([{name:"KG",value:"kg"},{name:"LT",value:"lt"}]),h=pe(),c=Ce(),a=X(),T=fe();H();const u=g({}),I=g(),z=g(),U=g(!1);he();const R=F(()=>h.userRoles),q=F(()=>c.getCurrentInsights),n=F(()=>T.getSelectedCountry),C=we(),j=F(()=>C.allProducts),G=F(()=>c.getNumTarget),$=F(()=>c.ranking_params),B=async function(){Z();const s=new Map;s.set("country_id",n.value.id),s.set("year",v.value),c.fetchAllInsights(s).then(()=>{S(),ee()}).catch(d=>{S(),P(a,d)})},ee=function(){f.value=Object.assign({},q.value)},te=function(s){var d;(d=n.value.language_codes)==null||d.forEach(p=>{s.translations[p].description==null&&(s.translations[p].description={text:""}),s.translations[p].short_description==null&&(s.translations[p].short_description={text:""}),s.translations[p].prize==null&&(s.translations[p].prize={text:""})}),s.product_ids=[],s.all_products?s.product_ids=j.value.map(p=>p.id+""):s.products.forEach(p=>{s.product_ids.push(p.id)}),z.value&&s.prize_image_url&&(z.value.tmp_image.image_url=s.prize_image_url),I.value&&s.pdf_url&&(I.value.tmp_file.file_url=s.pdf_url)},oe=function(){var K;const s=new FormData,d={},p=z.value.tmp_image,A=I.value.tmp_file;p&&p.image&&(d.prize_image=p.image),A&&A.file&&(d.pdf=A.file),u.value.all_products?d.all_products=!0:be(u.value.product_ids,"insight[product_ids][]",s),d.unit=u.value.unit,d.translations={};for(const N in u.value.translations){const b=u.value.translations[N];b.description.id?J(b.description.text,b.description.id):s.append("insight[translations]["+N+"][description]",b.description.text),b.short_description.id?J(b.short_description.text,b.short_description.id):s.append("insight[translations]["+N+"][short_description]",b.short_description.text),b.prize.id?J(b.prize.text,b.prize.id):s.append("insight[translations]["+N+"][prize]",b.prize.text)}return d.translations={},ke(s,d,"insight"),u.value.all_products||s.append("insight[all_products]","false"),((K=u.value.product_ids)==null?void 0:K.length)==0&&s.append("insight[product_ids]","[]"),s},se=async function(){const s={id:u.value.id,formData:oe()};c.updateInsight(s).then(()=>{S(),B(),E(a,{message:"Insight updated correctly.",title:""}),U.value=!1}).catch(d=>{S(),P(a,d)})},ne=s=>{u.value=JSON.parse(JSON.stringify(s)),setTimeout(()=>{te(u.value)},500),U.value=!0},le=s=>{const d=new FormData;d.append("file",s.files[0]);const p={id:u.value.id,formData:d};c.importTarget(p).then(()=>{S(),B(),G.value?E(a,{message:G.value+" targets uploaded.",title:""}):E(a,{message:"0 teargets uploaded.",title:""})}).catch(A=>{S(),P(a,A)})},ie=s=>{u.value.all_products=s.checked,s.checked?u.value.product_ids=j.value.map(d=>d.id+""):u.value.product_ids=[]},ae=s=>{u.value.all_products=s.value.length===j.value.length},re=s=>{var d=JSON.parse(JSON.stringify(s)),p=d.cluster;p=="user"&&(p="workshop"),p=="dealer"&&(p="distributor"),ge.push({name:"ranking",params:{year:d.year,cluster:p,quarter:d.quarter}})},de=()=>{ce()},ce=async function(){const s={id:u.value.id};c.resetInsight(s).then(()=>{S(),E(a,{message:"Insight successfully reset.",title:""}),U.value=!1,B()}).catch(d=>{S(),P(a,d)})},ue=function(){u.value={},U.value=!1};return W(async()=>{v.value=_e.now().toFormat("yyyy"),e.value.push(v.value),e.value.push(+v.value+1),B()}),{date:t,selectedYear:v,years:e,items:i,home:k,tmp_insight:f,dialog_insight:u,uploadPdfCard:I,uploadImageCard:z,units:x,visible:U,userRoles:R,products:j,selectedCountry:n,rankingParamsNavigation:$,fetchInsights:B,showDialog:ne,onUpload:le,onSelectAllChange:ie,onChange:ae,showRanking:re,updateInsight:se,closeDialog:ue,resetForm:de}},components:{InsightByAudienceCard:He,UploadImageCard:Ue,UploadPdfCard:_t}};const ft={class:"flex justify-content-between align-items-center mb-3"},ht=o("div",{class:"flex justify-content-between align-items-center"},[o("h1",{class:"uppercase"},"Dashboard")],-1),gt={class:"col-2"},vt={key:0,class:"flex flex-column col-12"},yt={class:"field col-6 mb-0"},xt=o("label",{for:"products"},"Products",-1),bt={class:"flex flex-wrap"},kt={key:0,class:"field col-12 flex flex-column"},Ct={class:"uppercase"},wt=o("i",{style:{"font-size":"12px"}},"ES: Acquista entro il 30 Giugno 200 l di prodotti Syntium o Selenia, in omaggio 1 kit Petronas",-1),St={key:1,class:"field col-12 flex flex-column"},Ut={class:"uppercase"},Dt={key:2,class:"field col-12 flex flex-column"},Vt={class:"uppercase"},It={class:"field col-12 flex my-0 py-0"},zt={class:"field col-6 upload-file pl-0 my-0 pt-0"},Ft={class:"field col-6 upload-file my-0 pt-0"},Tt={class:"col-12 flex align-items-center justify-content-between my-0"},Rt={class:"col-6 flex flex-column field my-0"},Bt=o("label",{for:"unit"},"Unit of measurement",-1),At={class:"col-6 flex align-items-center justify-content-end"},Et={key:0,href:"https://petronas-adv-test.s3-eu-west-1.amazonaws.com/template_sellout_targets.xlsx",class:"p-button mr-4 p-button-outlined",icon:"pi pi-download"},Pt=o("i",{class:"pi pi-download mr-2"},null,-1),jt={key:1,href:"https://petronas-adv.s3-eu-west-1.amazonaws.com/template_sellout_target.xlsx",class:"p-button mr-4 p-button-outlined",icon:"pi pi-download"},Nt=o("i",{class:"pi pi-download mr-2"},null,-1),Lt={class:"flex justify-content-end"};function Ot(k,t,i,e,v,f){const x=m("Breadcrumb"),h=m("Dropdown"),c=m("Card"),a=m("InsightByAudienceCard"),T=m("MultiSelect"),u=m("Textarea"),I=m("UploadImageCard"),z=m("UploadPdfCard"),U=m("FileUpload"),R=m("Button"),q=m("Dialog");return l(),r("div",null,[o("div",ft,[_(x,{home:e.home,model:e.items,class:"mt-0 p-0"},null,8,["home","model"])]),_(c,null,{content:V(()=>[ht,o("div",gt,[_(h,{modelValue:e.selectedYear,"onUpdate:modelValue":t[0]||(t[0]=n=>e.selectedYear=n),options:e.years,placeholder:"Select a year",class:"w-full md:w-14rem",onChange:t[1]||(t[1]=n=>e.fetchInsights())},null,8,["modelValue","options"])])]),_:1}),(l(!0),r(L,null,O(e.userRoles,n=>(l(),r("div",{key:n.value},[_(a,{title:n.name,tmp_insight:e.tmp_insight[n.value],onOpen:t[2]||(t[2]=C=>e.showDialog(C)),onRanking:t[3]||(t[3]=C=>e.showRanking(C)),class:ve(n.value)},null,8,["title","tmp_insight","class"])]))),128)),_(q,{header:"Insight",style:{width:"80vw"},class:"insight",visible:e.visible,"onUpdate:visible":t[11]||(t[11]=n=>e.visible=n),modal:""},{footer:V(()=>[o("div",Lt,[e.dialog_insight.id?(l(),Y(R,{key:0,label:"Reset",class:"mr-3 p-button-text",onClick:t[8]||(t[8]=n=>e.resetForm())})):y("",!0),_(R,{label:"Cancel",class:"mr-3 p-button-outlined",onClick:t[9]||(t[9]=n=>e.closeDialog())}),_(R,{label:"Save",onClick:t[10]||(t[10]=n=>e.updateInsight())})])]),default:V(()=>[e.dialog_insight&&e.dialog_insight.translations?(l(),r("div",vt,[o("div",yt,[xt,_(T,{modelValue:e.dialog_insight.product_ids,"onUpdate:modelValue":t[4]||(t[4]=n=>e.dialog_insight.product_ids=n),options:e.products,optionLabel:"name",optionValue:"id",class:"w-full capitalize",selectAll:e.dialog_insight.all_products,maxSelectedLabels:10,display:"chip",onSelectallChange:t[5]||(t[5]=n=>e.onSelectAllChange(n)),onChange:t[6]||(t[6]=n=>e.onChange(n))},null,8,["modelValue","options","selectAll"])]),o("div",bt,[(l(!0),r(L,null,O(e.selectedCountry.language_codes,n=>(l(),r("div",{key:n,class:"col-6 p-0"},[e.dialog_insight.translations[n].short_description?(l(),r("div",kt,[o("label",null,[D("Short Description "),o("span",Ct,"("+w(n)+")",1)]),wt,_(u,{modelValue:e.dialog_insight.translations[n].short_description.text,"onUpdate:modelValue":C=>e.dialog_insight.translations[n].short_description.text=C,maxlength:"210"},null,8,["modelValue","onUpdate:modelValue"])])):y("",!0),e.dialog_insight.translations[n].description?(l(),r("div",St,[o("label",null,[D("Description "),o("span",Ut,"("+w(n)+")",1)]),_(u,{modelValue:e.dialog_insight.translations[n].description.text,"onUpdate:modelValue":C=>e.dialog_insight.translations[n].description.text=C,style:{height:"100px"}},null,8,["modelValue","onUpdate:modelValue"])])):y("",!0),e.dialog_insight.translations[n].prize?(l(),r("div",Dt,[o("label",null,[D("Prize Description "),o("span",Vt,"("+w(n)+")",1)]),_(u,{modelValue:e.dialog_insight.translations[n].prize.text,"onUpdate:modelValue":C=>e.dialog_insight.translations[n].prize.text=C,style:{height:"100px"}},null,8,["modelValue","onUpdate:modelValue"])])):y("",!0)]))),128))]),o("div",It,[o("div",zt,[_(I,{title:"Prize image",ref:"uploadImageCard",videoUrl:!1},null,512)]),o("div",Ft,[_(z,{title:"Folder",ref:"uploadPdfCard",videoUrl:!1},null,512)])]),o("div",Tt,[o("div",Rt,[Bt,_(h,{modelValue:e.dialog_insight.unit,"onUpdate:modelValue":t[7]||(t[7]=n=>e.dialog_insight.unit=n),options:e.units,optionLabel:"name",optionValue:"value",placeholder:"Select a unit",class:"w-full md:w-14rem",id:"unit"},null,8,["modelValue","options"])]),o("div",At,[e.selectedCountry.country_code=="IT"||e.dialog_insight.cluster!="user"?(l(),r("a",Et,[Pt,D(" TEMPLATE ")])):y("",!0),e.selectedCountry.country_code!="IT"&&e.dialog_insight.cluster=="user"?(l(),r("a",jt,[Nt,D(" TEMPLATE ")])):y("",!0),_(U,{mode:"basic",name:"demo[]",url:"./upload.php",accept:".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel",maxFileSize:1e6,onUploader:e.onUpload,customUpload:"",auto:!0,chooseLabel:"Import Target"},null,8,["onUploader"])])])])):y("",!0)]),_:1},8,["visible"])])}const Wt=M(mt,[["render",Ot]]);export{Wt as default};
