import{r as n,p as Ue,ac as De,u as Te,c as E,n as Ie,a as Ee,_ as Re,b as f,k as Be,o as d,e as y,f as s,g as r,h as R,i as p,v as A,w as G,F as Ne,l as k,B as ne,x as B}from"./usetoast.esm40966.js";import{e as L,a as F,s as K,h as C,u as qe,b as Oe,c as je,d as Me,f as ze}from"./helpers40966.js";import{u as Ge}from"./survey40966.js";import{u as Pe}from"./user40966.js";import{u as Qe}from"./group40966.js";import{a as W,f as H}from"./formatData40966.js";import{A as Ye}from"./AudienceCard40966.js";import{U as Ke}from"./UploadImageCard40966.js";import{u as We}from"./useconfirm.esm40966.js";import{v as J}from"./runtime-dom.esm-bundler40966.js";import"./datetime40966.js";const He={setup(){const X=n({icon:"pi pi-home",to:"/surveys"}),o=n(""),N=n([{label:""}]),e=n({}),Z=n(),q=n(!1),P=n(),U=n(!0),w=n(!0),b=n(!0),O=n({}),V=n(),Q=n([]),v=n(""),m=n({}),Y=n([]),T=n(),I=n(),l=n([{label:"Online",value:!0},{label:"Offline",value:!1}]),S=n(!1),$=Ue(),c=De(),re=We(),g=Ge(),ie=Te(),de=Qe(),ce=Pe(),j=n(!1),ue=n({sellout_code:{value:"",matchMode:"contains"},full_name:{value:"",matchMode:"contains"}}),ve=n([{label:"Open",value:"open"},{label:"Closed",value:"closed"}]),u=E(()=>g.getCurrentSurvey),M=E(()=>ie.getSelectedCountry),me=E(()=>g.allSurveys),_e=E(()=>ce.userRoles),fe=E(()=>de.allGroups),z=async function(t){K(),g.fetchSurveyDetail(t).then(()=>{C(),ge()}).catch(a=>{C(),L(c,a)})},ee=async function(){const t=new Map;await g.fetchAllSurveys(t).catch(a=>{L(c,a)})},ye=async function(){const t={id:e.value.id,formData:ae()};g.updateSurvey(t).then(()=>{C(),S.value?oe():(z(e.value.id+""),F(c,{message:"Survey updated correctly.",title:""}))}).catch(a=>{C(),L(c,a)})},ae=function(){var _;const t=new FormData,a=Object.assign({},e.value);if(a.active_from=W(e.value.active_from),a.active_to=W(e.value.active_to),a.hidden_at=W(e.value.hidden_at),a.country_id=(_=a.country)==null?void 0:_.id,delete a.country,o.value||a.id){for(const h in m.value)qe(m.value[h],a.translations[h].title.id);a.translations={}}else{a.translations={};let h=M.value.language_codes;if(h&&h.length>0)for(const D of h){const se=m.value[D];se?a.translations[D]={title:se}:a.translations[D]={title:a.translations[h[0]].title}}}const i=I.value.tmp_image;i&&i.image&&(a.image=i.image),a.answers=[];for(const h in e.value.answers){const D=e.value.answers[h];D.id?a.answers.push({}):a.answers.push(D)}return delete a.target_all,delete a.target_clusters,delete a.target_group_ids,delete a.target_groups,delete a.created_at,delete a.updated_at,delete a.can_edit,delete a.can_delete,Oe(t,a,"survey"),je(T,t,"survey"),t},pe=async function(){const t={formData:ae()};g.createSurvey(t).then(()=>{C(),z(u.value.id+""),F(c,{message:"Survey created correctly.",title:""}),Ee.push({name:"survey-detail",params:{id:u.value.id}})}).catch(a=>{C(),L(c,a)})},ge=function(){if(u.value){e.value=Object.assign({},u.value),u.value.active_from&&(e.value.active_from=H(u.value.active_from+"")),u.value.active_to&&(e.value.active_to=H(u.value.active_to+"")),u.value.hidden_at&&(e.value.hidden_at=H(u.value.hidden_at+"")),le();for(const t in u.value.translations)m.value[t]=u.value.translations[t].title.text;for(const t in e.value.answers)for(const a in e.value.answers[+t].translations){const i=e.value.answers[+t];delete i.translations[a].updated_at,delete i.translations[a].created_at}Me(T,e),ze(I,e)}},he=function(){x(e.value.active_from),x(e.value.active_to),x(e.value.hidden_at),x(e.value.typology),x(m.value[v.value]),e.value.typology=="closed"&&(!e.value.answers||e.value.answers.length==0)&&x(V.value)},te=function(){if(q.value=!0,he(),j.value){F(c,{message:"Check that you have completed the required fields.",title:"",error:!0});return}o.value!=""||e.value.id?ye():pe(),q.value=!1,K()},x=function(t){if(q.value)return t==""||t==null?j.value=!0:j.value=!1,j.value},we=function(t,a){switch(t){case 1:{a?(e.value.target_clusters=[],e.value.target_group_ids=[],b.value=!1,w.value=!1):(w.value=!0,b.value=!0);break}case 2:{a?(b.value=!1,e.value.target_group_ids=[]):b.value=!0;break}case 3:{a?(w.value=!1,e.value.target_clusters=[]):w.value=!0;break}}},be=t=>{e.value.image_url="",e.value.image=t.files[0]},Se=function(){var a,i;const t={};(a=e.value.country.language_codes)==null||a.forEach((_,h)=>{_==v.value,t[_]=V.value}),e.value.answers||(e.value.answers=[]),(i=e.value.answers)==null||i.push({translations:t}),V.value=""},Ce=async function(t,a){t?await g.deleteAnswerFromSurvey(t).then(()=>{F(c,{message:"Answer deleted correctly.",title:""}),e.value.answers.splice(a,1)}).catch(i=>{L(c,i)}):e.value.answers.splice(a,1)},Ve=async function(t,a){const i={id:t,text:a};await g.updateAnswer(i).then(()=>{F(c,{message:"Answer update correctly.",title:""})}).catch(_=>{L(c,_)})},xe=t=>{let{newData:a,index:i}=t;const _=a.translations[v.value].id;_&&Ve(_,a.translations[v.value].text)},le=function(){var t;e.value.answers||(e.value.answers=[]),(t=e.value.country.language_codes)==null||t.forEach((a,i)=>{m.value[a]="",i==0&&(v.value=a),Y.value.push({field:"lang",header:a})})},Ae=function(){return e.value.online?"Status online":"Status offline"},ke=async function(t){if(!(u.value.online&&e.value.online)){if(!u.value.online&&e.value.online){S.value=!0,te();return}oe()}},oe=async function(){const t=new Map;t.set("online",e.value.online),t.set("survey_id",e.value.id),await g.changeStatusSurvey(t).then(()=>{z(e.value.id+""),F(c,{message:"Survey status changed correctly",title:""}),S.value=!1})},Le=t=>{re.require({target:t.currentTarget,message:"Are you sure you want to send the push notification?",icon:"pi pi-exclamation-triangle",acceptLabel:"Send",rejectLabel:"Cancel",accept:()=>{Fe()}})},Fe=async function(){K(),await g.sendPush(o.value).then(()=>{F(c,{message:"Notification sent correctly.",title:"",error:!0}),C()}).catch(t=>{C(),L(c,t)})};return Ie(async()=>{ee(),o.value=$.params.id+"",o.value!=""&&o.value!="undefined"?(z(o.value),N.value[0]={label:"Edit survey"}):(N.value[0]={label:"New survey"},e.value.country_id=M.value.id,e.value.country=M.value,e.value.online=!1,v.value=M.value.default_language_code+"")}),{home:X,items:N,tmp_survey:e,filteredSurveys:Z,allSurveys:me,filters:ue,allGroups:fe,newUser:P,showCheckboxAll:U,showSelectClusters:w,showSelectGroups:b,uploadedFile:O,surveyTypology:ve,newAnswer:V,editingRows:Q,userRoles:_e,selectedLang:v,question:m,audienceCard:T,uploadImageCard:I,survey_status:l,saveSurvey:te,validateField:x,fetchAllSurveys:ee,setSelected:we,onSelectedFiles:be,addAnswer:Se,onRowEditSave:xe,populateSelectLanguages:le,deleteAnswer:Ce,getTooltipValue:Ae,changeStatus:ke,confirmSendPush:Le}},components:{AudienceCard:Ye,UploadImageCard:Ke}},Je={class:"m-4"},Xe={class:"flex justify-content-between align-items-center mb-3"},Ze={class:"flex align-items-center justify-content-between"},$e=s("h2",{class:"mb-2"},"SURVEY DETAILS",-1),ea={key:0,class:"field col-2 mb-0"},aa={class:"formgrid grid col-10 px-0"},ta={class:"field col-3"},la=s("label",{for:"name"},"Active from*",-1),oa={key:0,class:"p-error"},sa={class:"field col-3"},na=s("label",{for:"name"},"Active to*",-1),ra={key:0,class:"p-error"},ia={class:"field col-4"},da=s("label",{for:"name"},"Visible until*",-1),ca={key:0,class:"p-error"},ua={class:"flex align-items-center justify-content-between"},va=s("h2",{class:"mb-3"},"QUESTION AND ANSWERS",-1),ma={class:"formgrid grid col-12 px-0 align-items-center"},_a={class:"field col-4"},fa={for:"note"},ya={class:"uppercase"},pa={key:0,class:"p-error"},ga={class:"field col-4 flex flex-column"},ha=s("label",{for:"typology"},"Typology*",-1),wa={key:0,class:"p-error"},ba={class:"formgrid grid col-12 px-0 align-items-center"},Sa={key:0,class:"field col-5 flex flex-column mt-4"},Ca={class:"field flex align-items-center"},Va={class:"field col-8 p-0"},xa={for:"answer"},Aa={class:"uppercase"},ka={key:0,class:"p-error"},La={key:0},Fa={key:1},Ua={class:"flex p-4 align-items-center"},Da={class:"pl-2"};function Ta(X,o,N,e,Z,q){const P=f("Breadcrumb"),U=f("Button"),w=f("Dropdown"),b=f("Calendar"),O=f("Card"),V=f("AudienceCard"),Q=f("UploadImageCard"),v=f("InputText"),m=f("Column"),Y=f("DataTable"),T=f("ConfirmPopup"),I=Be("tooltip");return d(),y(Ne,null,[s("div",Je,[s("div",Xe,[r(P,{home:e.home,model:e.items,class:"mt-0 p-0"},null,8,["home","model"]),s("div",null,[r(U,{label:"Save",onClick:e.saveSurvey,disabled:e.tmp_survey.online},null,8,["onClick","disabled"]),e.tmp_survey.id?(d(),R(U,{key:0,label:"Send push",onClick:o[0]||(o[0]=l=>e.confirmSendPush(l)),class:"ml-3 p-button-outlined",icon:"pi pi-envelope"})):p("",!0)])]),r(O,null,{content:A(()=>[s("div",Ze,[$e,e.tmp_survey.country?(d(),y("div",ea,[r(w,{modelValue:e.tmp_survey.online,"onUpdate:modelValue":o[1]||(o[1]=l=>e.tmp_survey.online=l),options:e.survey_status,optionLabel:"label",optionValue:"value",class:"w-full capitalize dropdown-status",onChange:o[2]||(o[2]=l=>e.changeStatus(l))},null,8,["modelValue","options"])])):p("",!0)]),s("div",aa,[s("div",ta,[la,r(b,{inputId:"dateformat",modelValue:e.tmp_survey.active_from,"onUpdate:modelValue":o[3]||(o[3]=l=>e.tmp_survey.active_from=l),dateFormat:"dd/mm/yy",manualInput:!1,class:k({"p-invalid":e.validateField(e.tmp_survey.active_from)}),placeholder:"gg/mm/aaaa"},null,8,["modelValue","class"]),e.validateField(e.tmp_survey.active_from)?(d(),y("small",oa,"Campo obbligatorio.")):p("",!0)]),s("div",sa,[na,r(b,{inputId:"dateformat",modelValue:e.tmp_survey.active_to,"onUpdate:modelValue":o[4]||(o[4]=l=>e.tmp_survey.active_to=l),dateFormat:"dd/mm/yy",manualInput:!1,class:k({"p-invalid":e.validateField(e.tmp_survey.active_to)})},null,8,["modelValue","class"]),e.validateField(e.tmp_survey.active_to)?(d(),y("small",ra,"Campo obbligatorio.")):p("",!0)]),s("div",ia,[da,r(b,{inputId:"dateformat",modelValue:e.tmp_survey.hidden_at,"onUpdate:modelValue":o[5]||(o[5]=l=>e.tmp_survey.hidden_at=l),dateFormat:"dd/mm/yy",manualInput:!1,class:k({"p-invalid":e.validateField(e.tmp_survey.hidden_at)})},null,8,["modelValue","class"]),e.validateField(e.tmp_survey.hidden_at)?(d(),y("small",ca,"Campo obbligatorio.")):p("",!0)])])]),_:1}),G(r(V,{ref:"audienceCard"},null,512),[[J,e.tmp_survey.country]]),G(r(Q,{title:"SURVEY IMAGE",videoUrl:!1,ref:"uploadImageCard"},null,512),[[J,e.tmp_survey.country]]),G(r(O,{class:"mt-4"},{content:A(()=>[s("div",ua,[va,e.tmp_survey.country&&e.tmp_survey.country.language_codes&&e.tmp_survey.country.language_codes.length>1?(d(),R(w,{key:0,modelValue:e.selectedLang,"onUpdate:modelValue":o[6]||(o[6]=l=>e.selectedLang=l),options:e.tmp_survey.country.language_codes,class:"capitalize"},null,8,["modelValue","options"])):p("",!0)]),s("div",ma,[s("div",_a,[s("label",fa,[ne("Question* "),s("span",ya,"("+B(e.selectedLang)+")",1)]),r(v,{type:"text",modelValue:e.question[e.selectedLang],"onUpdate:modelValue":o[7]||(o[7]=l=>e.question[e.selectedLang]=l),class:k(["w-full",{"p-invalid":e.validateField(e.question[e.selectedLang])}])},null,8,["modelValue","class"]),e.validateField(e.question[e.selectedLang])?(d(),y("small",pa,"Campo obbligatorio.")):p("",!0)]),s("div",ga,[ha,r(w,{modelValue:e.tmp_survey.typology,"onUpdate:modelValue":o[8]||(o[8]=l=>e.tmp_survey.typology=l),options:e.surveyTypology,optionLabel:"label",optionValue:"value",placeholder:"",class:k(["capitalize",{"p-invalid":e.validateField(e.tmp_survey.typology)}])},null,8,["modelValue","options","class"]),e.validateField(e.tmp_survey.typology)?(d(),y("small",wa,"Campo obbligatorio.")):p("",!0)])]),s("div",ba,[e.tmp_survey.typology=="closed"?(d(),y("div",Sa,[s("div",Ca,[s("div",Va,[s("label",xa,[ne("Answer* "),s("span",Aa,"("+B(e.selectedLang)+")",1)]),r(v,{type:"text",modelValue:e.newAnswer,"onUpdate:modelValue":o[9]||(o[9]=l=>e.newAnswer=l),class:k(["w-full",{"p-invalid":e.tmp_survey.answers&&e.tmp_survey.answers.length<1&&e.validateField(e.newAnswer)}]),id:"answer"},null,8,["modelValue","class"]),e.tmp_survey.answers&&e.tmp_survey.answers.length<1&&e.validateField(e.newAnswer)?(d(),y("small",ka,"Campo obbligatorio.")):p("",!0)]),r(U,{label:"Add answer",class:"p-button-outlined ml-3 mt-2",onClick:e.addAnswer,disabled:!e.newAnswer},null,8,["onClick","disabled"])]),e.tmp_survey.answers&&e.tmp_survey.answers.length>0?(d(),R(Y,{key:0,value:e.tmp_survey.answers,responsiveLayout:"scroll",editMode:"row",dataKey:"id",editingRows:e.editingRows,"onUpdate:editingRows":o[10]||(o[10]=l=>e.editingRows=l),onRowEditSave:e.onRowEditSave},{default:A(()=>[r(m,{field:"",header:e.selectedLang.toUpperCase()},{body:A(({data:l})=>[l.translations[e.selectedLang]&&(l.translations[e.selectedLang].text||l.translations[e.selectedLang].text=="")?(d(),y("span",La,B(l.translations[e.selectedLang].text),1)):(d(),y("span",Fa,B(l.translations[e.selectedLang]),1))]),editor:A(({data:l})=>[l.translations[e.selectedLang]&&(l.translations[e.selectedLang].text||l.translations[e.selectedLang].text=="")?(d(),R(v,{key:0,modelValue:l.translations[e.selectedLang].text,"onUpdate:modelValue":S=>l.translations[e.selectedLang].text=S,autofocus:""},null,8,["modelValue","onUpdate:modelValue"])):(d(),R(v,{key:1,modelValue:l.translations[e.selectedLang],"onUpdate:modelValue":S=>l.translations[e.selectedLang]=S},null,8,["modelValue","onUpdate:modelValue"]))]),_:1},8,["header"]),r(m,{rowEditor:!0,style:{width:"10%","min-width":"8rem"},bodyStyle:"text-align:center"}),r(m,{header:"",style:{width:"9rem"},rowEditor:!0},{body:A(({data:l,index:S})=>[G(r(U,{type:"button","aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-3",icon:"pi pi-trash",onClick:$=>e.deleteAnswer(l.id,S)},null,8,["onClick"]),[[I,"Delete",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","editingRows","onRowEditSave"])):p("",!0)])):p("",!0)])]),_:1},512),[[J,e.selectedLang]])]),r(T,null,{message:A(l=>[s("div",Ua,[s("i",{class:k(l.message.icon),style:{"font-size":"1.5rem"}},null,2),s("p",Da,B(l.message.message),1)])]),_:1})],64)}const Pa=Re(He,[["render",Ta]]);export{Pa as default};
