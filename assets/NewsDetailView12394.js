import{r as s,af as oe,_ as ae,b as d,l as we,e as p,i as M,B as H,g as l,C as le,h as i,f as h,w as D,j as y,q as ye,u as Ce,c as P,n as be,a as Ue,m as O}from"./usetoast.esm12394.js";import{s as q,h as g,a as B,e as A,i as te,u as xe,b as Ve,c as Se,f as ke,g as Ie,j as Fe,d as Ae}from"./helpers12394.js";import{u as De}from"./user12394.js";import{u as Ne}from"./news12394.js";import{u as Te}from"./category12394.js";import{u as Ee}from"./group12394.js";import{A as Le}from"./AudienceCard12394.js";import{u as je,U as Pe}from"./UploadImageCard12394.js";import{E as Be,G as Ge,U as Re}from"./UploadAttachmentCard12394.js";import{a as Oe,f as We}from"./formatData12394.js";import{u as qe}from"./useconfirm.esm12394.js";import{v as W}from"./runtime-dom.esm-bundler12394.js";import"./datetime12394.js";const ze={props:{title:String,videoUrl:Boolean},setup(N,a){const u=s({}),e=je(),S=oe(),T=m=>{u.value.video_image_url={},u.value.video_image=m.files[0]},v=async m=>{m&&(q(),await e.deleteAttachment(m).then(()=>{g(),B(S,{message:"File deleted correctly.",title:""}),r()}).catch(f=>{g(),A(S,f)}))},r=()=>{u.value.video_image_url=null,u.value.video_image=null};return a.expose({tmp_video:u,deleteImage:v}),{tmp_video:u,deleteTmpImage:r,deleteImage:v,onUploadFile:T}}};const Ye={class:"flex align-items-center justify-content-between"},Me={class:"mb-4"},He={class:"flex"},Je={class:"ml-0 col-8 pt-0"},Ke={class:"field"},Qe=l("label",{for:"video_url"},"Video Url (YouTube, Vimeo)",-1),Xe={class:"col-12 pl-0"},Ze={key:0,class:"flex align-items-top mt-3"},$e=["src"],et={key:1,class:"mt-2"},tt={key:0,class:"flex align-items-center"},ot={class:"flex align-items-top mt-3"},at=["src"];function lt(N,a,u,e,S,T){const v=d("InputText"),r=d("FileUpload"),m=d("Card"),f=we("tooltip");return p(),M(m,{class:"h-full"},{content:H(()=>{var k,I,F,C;return[l("div",Ye,[l("h2",Me,le(u.title),1)]),l("div",He,[l("div",Je,[l("div",Ke,[Qe,i(v,{type:"text",modelValue:e.tmp_video.video_url,"onUpdate:modelValue":a[0]||(a[0]=_=>e.tmp_video.video_url=_),class:"w-full"},null,8,["modelValue"])]),l("div",Xe,[i(r,{mode:"basic",name:"demo",accept:"image/*",customUpload:!0,onUploader:a[1]||(a[1]=_=>N.$emit("onUploadImgVideoPreview",_)),maxFileSize:1e6,auto:!0,chooseLabel:"Upload video image",class:"p-button-outlined",modelValue:e.tmp_video.video_image,"onUpdate:modelValue":a[2]||(a[2]=_=>e.tmp_video.video_image=_),onSelect:e.onUploadFile},null,8,["modelValue","onSelect"]),e.tmp_video.video_image_url&&e.tmp_video.video_image_url.url?(p(),h("div",Ze,[l("img",{role:"presentation",class:"p-fileupload-file-thumbnail h-4rem w-7rem",src:e.tmp_video.video_image_url.url,style:{border:"1px solid rgb(0 0 0 / 6%)"}},null,8,$e),D(l("i",{class:"pi pi-times p-button-icon text-red-600 cursor-pointer font-semibold icon-delete",onClick:a[3]||(a[3]=_=>e.deleteImage(e.tmp_video.video_image_url.id))},null,512),[[f,"Delete",void 0,{top:!0}]])])):(p(),h("div",et,[(I=(k=e.tmp_video)==null?void 0:k.video_image)!=null&&I.objectURL?(p(),h("div",tt,[l("div",ot,[l("img",{src:(C=(F=e.tmp_video)==null?void 0:F.video_image)==null?void 0:C.objectURL,class:"p-fileupload-file-thumbnail h-4rem w-7rem tmp_img"},null,8,at),D(l("i",{class:"pi pi-times p-button-icon text-red-600 cursor-pointer font-semibold icon-delete tmp-icon-delete",onClick:a[4]||(a[4]=_=>e.deleteTmpImage())},null,512),[[f,"Delete",void 0,{top:!0}]])])])):y("",!0)]))])])])]}),_:1})}const st=ae(ze,[["render",lt]]),nt={setup(){const N=s({icon:"pi pi-home",to:"/news"}),a=s(""),u=s([{label:""}]),e=s({}),S=["draft","online","archived"],T=s(),v=s(!1),r=s(!1),m=s(),f=s(""),k=s(!0),I=s(!0),F=s(!0),C=s(),_=s(),b=s(),U=s(),E=s(),c=ye(),w=oe(),L=Ne(),J=Te(),se=Ee(),ne=De(),ie=Ce(),de=qe(),x=P(()=>L.getCurrentNews),j=P(()=>J.allCategories),re=P(()=>ne.userRoles),ce=P(()=>se.allGroups),K=P(()=>ie.getSelectedCountry),z=async function(o){q(),L.fetchNewsDetail(o).then(()=>{g(),_e()}).catch(t=>{g(),A(w,t)})},Q=function(){var ee;const o=new FormData,t=Object.assign({},e.value);e.value.published_at&&(t.published_at=Oe(e.value.published_at));const n=_.value.tmp_image;n&&n.image&&(t.image=n.image);const V=E.value.tmp_video;V&&V.video_image&&(t.video_image=V.video_image),V&&(t.video_url=V.video_url);const G=b.value.files;G&&G.length>0&&G.length>0&&te(G,"news[gallery_images][]",o);const R=U.value.files;return R&&R.length>0&&R.length>0&&te(R,"news[gallery_pdfs][]",o),t.country_id=(ee=t.country)==null?void 0:ee.id,delete t.country,(a.value||t.id)&&xe(x,t),delete t.target_all,delete t.target_clusters,delete t.target_group_ids,Ve(o,t,"news"),Se(C,o,"news"),o},ue=async function(){const o={id:e.value.id,formData:Q()};L.updateNews(o).then(()=>{g(),z(e.value.id+""),B(w,{message:"News updated correctly.",title:""}),b.value.files=[],b.value.fileUpload.files=[],U.value.files=[],U.value.fileUpload.files=[]}).catch(t=>{g(),A(w,t)})},me=async function(){const o={formData:Q()};L.createNews(o).then(()=>{g(),z(x.value.id+""),B(w,{message:"News created correctly.",title:""}),Ue.push({name:"news-detail",params:{id:x.value.id}})}).catch(t=>{g(),A(w,t)})},_e=function(){var o,t;if(e.value=Object.assign({},x.value),e.value.country_id=(o=x.value.country)==null?void 0:o.id,f.value=((t=e.value.country)==null?void 0:t.default_language_code)+"",e.value.published_at=We(x.value.published_at+""),ke(C,e),Ie(_,e),Fe(E,e),Ae(x,e),b.value){const n=e.value.gallery_images_url;n&&n.length>0&&(b.value.tmp_gallery=n)}if(U.value){const n=e.value.gallery_pdfs_url;n&&n.length>0&&(U.value.tmp_attachment=n)}e.value.news_category_id=e.value.news_category.id,Z(),delete e.value.news_category},pe=function(){Y(e.value.published_at),Y(e.value.news_category_id)},ve=function(){if(v.value=!0,pe(),r.value){B(w,{message:"Check that you have completed the required fields.",title:"",error:!0});return}a.value!=""||e.value.id?ue():me(),v.value=!1,q()},Y=function(o){if(v.value)return o==""||o==null?r.value=!0:r.value=!1,r.value},X=function(o){m.value=[],o.value.forEach(t=>{if(t.country&&t.country.default_language_code){const n={id:t.id,value:t.translations[t.country.default_language_code].name.text};m.value.push(n)}})},Z=async function(){if(j.value&&j.value.length>0){X(j);return}const o=new Map;o.set("country_id",e.value.country.id),await J.fetchAllCategories(o).then(()=>{var t;X(j),f.value=((t=e.value.country)==null?void 0:t.default_language_code)+""}).catch(t=>{A(w,t)})},fe=o=>{de.require({group:"push",target:o.currentTarget,message:"Are you sure you want to send the push notification?",icon:"pi pi-exclamation-triangle"})},ge=async function(){q(),await L.sendPush(a.value).then(()=>{B(w,{message:"Notification sent correctly.",title:"",error:!1}),$(),g()}).catch(o=>{g(),A(w,o)})},$=function(){var o=document.getElementsByClassName("p-confirm-popup-reject")[0];o.click()},he=function(o){e.value.video_image=o.files[0]};return be(async()=>{var o,t,n;a.value=c.params.id+"",a.value!=""&&a.value!="undefined"?(z(a.value),u.value[0]={label:"Edit news"}):(e.value.status="draft",u.value[0]={label:"Add news"},e.value.country_id=K.value.id,e.value.country=K.value,f.value=((o=e.value.country)==null?void 0:o.default_language_code)+"",Z(),e.value.translations||(e.value.translations={},(n=(t=e.value.country)==null?void 0:t.language_codes)==null||n.forEach(V=>{e.value.translations[V]={title:null,short_description:null,description:null}})))}),{home:N,items:u,tmp_news:e,filteredUsers:T,filteredCategories:m,selectedLang:f,showCheckboxAll:k,showSelectClusters:I,showSelectGroups:F,userRoles:re,allGroups:ce,news_status:S,audienceCard:C,uploadImageCard:_,submitForm:v,categories:j,galleryImageCard:b,uploadAttachmentCard:U,uploadVideoCard:E,saveNews:ve,validateField:Y,confirmSendPush:fe,closePopup:$,sendPush:ge,onUploadImgVideoPreview:he}},components:{AudienceCard:Le,UploadImageCard:Pe,EventContentCard:Be,GalleryImageCard:Ge,UploadAttachmentCard:Re,UploadVideoCard:st}};const it={class:"m-4"},dt={class:"flex justify-content-between align-items-center mb-3"},rt={class:"flex align-items-center justify-content-between"},ct=l("h2",{class:"mb-2"},"NEWS DETAIL",-1),ut={key:0,class:"field col-2 mb-0"},mt={key:0,class:"p-error"},_t={class:"formgrid grid col-10 px-0 xs:col-12"},pt={key:0,class:"field col-4 xs:col-6"},vt=l("label",{for:"shipping_country"},"Category*",-1),ft={key:0,class:"p-error"},gt={key:1,class:"field col-4 xs:col-6"},ht=l("label",{for:"name"},"Published at*",-1),wt={key:0,class:"p-error"},yt={class:"flex jusfity-content-end mt-3"},Ct={class:"col-6 flex-1 pl-0"},bt={class:"col-6 flex-1 pr-0"},Ut={class:"flex p-3 align-items-center"},xt={class:"pl-2"},Vt={class:"flex align-items-center pb-3 justify-content-end"};function St(N,a,u,e,S,T){const v=d("Breadcrumb"),r=d("Button"),m=d("Dropdown"),f=d("Calendar"),k=d("Card"),I=d("AudienceCard"),F=d("EventContentCard"),C=d("UploadImageCard"),_=d("UploadVideoCard"),b=d("GalleryImageCard"),U=d("UploadAttachmentCard"),E=d("ConfirmPopup");return p(),h("div",it,[l("div",dt,[i(v,{home:e.home,model:e.items,class:"mt-0 p-0"},null,8,["home","model"]),l("div",null,[e.tmp_news.id?(p(),M(r,{key:0,label:"Send push",onClick:a[0]||(a[0]=c=>e.confirmSendPush(c)),class:"mr-3 p-button-outlined",icon:"pi pi-envelope"})):y("",!0),i(r,{label:"Save",onClick:e.saveNews},null,8,["onClick"])])]),i(k,null,{content:H(()=>[l("div",rt,[ct,e.tmp_news.country?(p(),h("div",ut,[i(m,{modelValue:e.tmp_news.status,"onUpdate:modelValue":a[1]||(a[1]=c=>e.tmp_news.status=c),options:e.news_status,class:O(["w-full capitalize dropdown-status",{"p-invalid":e.validateField(e.tmp_news.status)}])},null,8,["modelValue","options","class"]),e.validateField(e.tmp_news.status)?(p(),h("small",mt,"Campo obbligatorio.")):y("",!0)])):y("",!0)]),l("div",_t,[e.tmp_news.country?(p(),h("div",pt,[vt,i(m,{modelValue:e.tmp_news.news_category_id,"onUpdate:modelValue":a[2]||(a[2]=c=>e.tmp_news.news_category_id=c),options:e.filteredCategories,optionLabel:"value",optionValue:"id",class:O(["w-full",{"p-invalid":e.validateField(e.tmp_news.news_category_id)}])},null,8,["modelValue","options","class"]),e.validateField(e.tmp_news.news_category_id)?(p(),h("small",ft,"Campo obbligatorio.")):y("",!0)])):y("",!0),e.tmp_news.country?(p(),h("div",gt,[ht,i(f,{inputId:"dateformat",modelValue:e.tmp_news.published_at,"onUpdate:modelValue":a[3]||(a[3]=c=>e.tmp_news.published_at=c),dateFormat:"dd/mm/yy",manualInput:!1,class:O({"p-invalid":e.validateField(e.tmp_news.published_at)}),placeholder:"gg/mm/aaaa"},null,8,["modelValue","class"]),e.validateField(e.tmp_news.published_at)?(p(),h("small",wt,"Campo obbligatorio.")):y("",!0)])):y("",!0)])]),_:1}),D(i(I,{ref:"audienceCard"},null,512),[[W,e.tmp_news.country]]),e.tmp_news.country&&e.selectedLang?(p(),M(F,{key:0,selectedLang:e.selectedLang,submitForm:e.submitForm,tmp_events:e.tmp_news,title:"NEWS CONTENT"},null,8,["selectedLang","submitForm","tmp_events"])):y("",!0),l("div",yt,[l("div",Ct,[D(i(C,{title:"NEWS MEDIA",videoUrl:!1,ref:"uploadImageCard",dynamicClass:"col-12"},null,512),[[W,e.tmp_news.country]])]),l("div",bt,[D(i(_,{title:"NEWS VIDEO",videoUrl:!1,ref:"uploadVideoCard",onOnUploadImgVideoPreview:a[4]||(a[4]=c=>e.onUploadImgVideoPreview(c))},null,512),[[W,e.tmp_news.country]])])]),D(i(b,{title:"NEWS GALLERY",videoUrl:!1,ref:"galleryImageCard"},null,512),[[W,e.tmp_news.country&&e.tmp_news.id]]),i(U,{title:"PDF GALLERY",videoUrl:!0,ref:"uploadAttachmentCard",accept:"application/pdf"},null,512),i(E,{group:"push",id:"push"},{message:H(c=>[l("div",Ut,[l("i",{class:O(c.message.icon),style:{"font-size":"1.5rem"}},null,2),l("p",xt,le(c.message.message),1)]),l("div",Vt,[i(r,{label:"Cancel",class:"mr-3 p-button-text text-500",onClick:e.closePopup},null,8,["onClick"]),i(r,{label:"Send",class:"mr-4",onClick:e.sendPush},null,8,["onClick"])])]),_:1})])}const Rt=ae(nt,[["render",St]]);export{Rt as default};
