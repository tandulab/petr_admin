import{e as ae,u as oe,r as se}from"./usetoast.esm96104.js";import{r as o,k as ne,c as b,n as le,_ as re,a as r,o as i,b as m,e as h,f as c,q as ie,w as W,g as ce,h as _,j as T}from"./_plugin-vue_export-helper96104.js";import{a as U,s as z,h as g,e as S,g as de,b as ue,c as me,d as _e,f as pe,i as ve}from"./helpers96104.js";import{u as fe}from"./user96104.js";import{u as we}from"./news96104.js";import{u as ge}from"./category96104.js";import{u as he}from"./group96104.js";import{A as ye}from"./AudienceCard96104.js";import{U as Ce}from"./UploadImageCard96104.js";import{E as be}from"./EventContentCard96104.js";import{a as Ne,f as De}from"./formatData96104.js";import{v as M}from"./runtime-dom.esm-bundler96104.js";import"./datetime96104.js";const Fe={setup(){const I=o({icon:"pi pi-home",to:"/news"}),s=o(""),N=o([{label:""}]),e=o({}),L=["draft","online","archived"],B=o(),p=o(!1),v=o(!1),f=o(),w=o(""),k=o(!0),A=o(!0),V=o(!0),y=o(),l=o(),H=ne(),d=ae(),D=we(),j=ge(),P=he(),J=fe(),K=oe(),u=b(()=>D.getCurrentNews),C=b(()=>j.allCategories),Q=b(()=>J.userRoles),X=b(()=>P.allGroups),G=b(()=>K.getSelectedCountry),x=async function(a){z(),D.fetchNewsDetail(a).then(()=>{g(),$()}).catch(t=>{g(),S(d,t)})},O=function(){var F;const a=new FormData,t=Object.assign({},e.value);e.value.published_at&&(t.published_at=Ne(e.value.published_at));const n=l.value.tmp_image;return n&&n.image&&(t.image=n.image),n&&n.video_url&&(t.video_url=n.video_url),t.country_id=(F=t.country)==null?void 0:F.id,delete t.country,(s.value||t.id)&&de(u,t),delete t.target_all,delete t.target_clusters,delete t.target_group_ids,ue(a,t,"news"),me(y,a,"news"),a},Y=async function(){const a={id:e.value.id,formData:O()};D.updateNews(a).then(()=>{g(),x(e.value.id+""),U(d,{message:"News updated correctly.",title:""})}).catch(t=>{g(),S(d,t)})},Z=async function(){const a={formData:O()};D.createNews(a).then(()=>{g(),x(u.value.id+""),U(d,{message:"News created correctly.",title:""}),se.push({name:"news-detail",params:{id:u.value.id}})}).catch(t=>{g(),S(d,t)})},$=function(){var a,t;e.value=Object.assign({},u.value),e.value.country_id=(a=u.value.country)==null?void 0:a.id,w.value=((t=e.value.country)==null?void 0:t.default_language_code)+"",e.value.published_at=De(u.value.published_at+""),_e(y,e),pe(l,e),ve(u,e),e.value.news_category_id=e.value.news_category.id,R(),delete e.value.news_category},ee=function(){E(e.value.published_at),E(e.value.news_category_id)},te=function(){if(p.value=!0,ee(),v.value){U(d,{message:"Check that you have completed the required fields.",title:"",error:!0});return}s.value!=""||e.value.id?Y():Z(),p.value=!1,z()},E=function(a){if(p.value)return a==""||a==null?v.value=!0:v.value=!1,v.value},q=function(a){f.value=[],a.value.forEach(t=>{if(t.country&&t.country.default_language_code){const n={id:t.id,value:t.translations[t.country.default_language_code].name.text};f.value.push(n)}})},R=async function(){if(C.value&&C.value.length>0){q(C);return}const a=new Map;a.set("country_id",e.value.country.id),await j.fetchAllCategories(a).then(()=>{var t;q(C),w.value=((t=e.value.country)==null?void 0:t.default_language_code)+""}).catch(t=>{S(d,t)})};return le(async()=>{var a,t,n;s.value=H.params.id+"",s.value!=""&&s.value!="undefined"?(x(s.value),N.value[0]={label:"Edit news"}):(e.value.status="draft",N.value[0]={label:"Add news"},e.value.country_id=G.value.id,e.value.country=G.value,w.value=((a=e.value.country)==null?void 0:a.default_language_code)+"",R(),e.value.translations||(e.value.translations={},(n=(t=e.value.country)==null?void 0:t.language_codes)==null||n.forEach(F=>{e.value.translations[F]={title:null,short_description:null,description:null}})))}),{home:I,items:N,tmp_news:e,filteredUsers:B,filteredCategories:f,selectedLang:w,showCheckboxAll:k,showSelectClusters:A,showSelectGroups:V,userRoles:Q,allGroups:X,news_status:L,audienceCard:y,uploadImageCard:l,submitForm:p,categories:C,saveNews:te,validateField:E}},components:{AudienceCard:ye,UploadImageCard:Ce,EventContentCard:be}};const Se={class:"m-4"},ke={class:"flex justify-content-between align-items-center mb-3"},Ae={class:"flex align-items-center justify-content-between"},Ve=h("h2",{class:"mb-2"},"NEWS DETAIL",-1),xe={key:0,class:"field col-2 mb-0"},Ee={key:0,class:"p-error"},Te={class:"formgrid grid col-10 px-0 xs:col-12"},Ue={key:0,class:"field col-4 xs:col-6"},Ie=h("label",{for:"shipping_country"},"Category*",-1),Le={key:0,class:"p-error"},Be={key:1,class:"field col-4 xs:col-6"},je=h("label",{for:"name"},"Published at*",-1),Ge={key:0,class:"p-error"};function Oe(I,s,N,e,L,B){const p=r("Breadcrumb"),v=r("Button"),f=r("Dropdown"),w=r("Calendar"),k=r("Card"),A=r("AudienceCard"),V=r("EventContentCard"),y=r("UploadImageCard");return i(),m("div",Se,[h("div",ke,[c(p,{home:e.home,model:e.items,class:"mt-0 p-0"},null,8,["home","model"]),c(v,{label:"Save",onClick:e.saveNews},null,8,["onClick"])]),c(k,null,{content:ie(()=>[h("div",Ae,[Ve,e.tmp_news.country?(i(),m("div",xe,[c(f,{modelValue:e.tmp_news.status,"onUpdate:modelValue":s[0]||(s[0]=l=>e.tmp_news.status=l),options:e.news_status,class:T(["w-full capitalize dropdown-status",{"p-invalid":e.validateField(e.tmp_news.status)}])},null,8,["modelValue","options","class"]),e.validateField(e.tmp_news.status)?(i(),m("small",Ee,"Campo obbligatorio.")):_("",!0)])):_("",!0)]),h("div",Te,[e.tmp_news.country?(i(),m("div",Ue,[Ie,c(f,{modelValue:e.tmp_news.news_category_id,"onUpdate:modelValue":s[1]||(s[1]=l=>e.tmp_news.news_category_id=l),options:e.filteredCategories,optionLabel:"value",optionValue:"id",class:T(["w-full",{"p-invalid":e.validateField(e.tmp_news.news_category_id)}])},null,8,["modelValue","options","class"]),e.validateField(e.tmp_news.news_category_id)?(i(),m("small",Le,"Campo obbligatorio.")):_("",!0)])):_("",!0),e.tmp_news.country?(i(),m("div",Be,[je,c(w,{inputId:"dateformat",modelValue:e.tmp_news.published_at,"onUpdate:modelValue":s[2]||(s[2]=l=>e.tmp_news.published_at=l),dateFormat:"dd/mm/yy",manualInput:!1,class:T({"p-invalid":e.validateField(e.tmp_news.published_at)}),placeholder:"gg/mm/aaaa"},null,8,["modelValue","class"]),e.validateField(e.tmp_news.published_at)?(i(),m("small",Ge,"Campo obbligatorio.")):_("",!0)])):_("",!0)])]),_:1}),W(c(A,{ref:"audienceCard"},null,512),[[M,e.tmp_news.country]]),e.tmp_news.country&&e.selectedLang?(i(),ce(V,{key:0,selectedLang:e.selectedLang,submitForm:e.submitForm,tmp_events:e.tmp_news,title:"NEWS CONTENT"},null,8,["selectedLang","submitForm","tmp_events"])):_("",!0),W(c(y,{title:"NEWS MEDIA",videoUrl:!0,ref:"uploadImageCard"},null,512),[[M,e.tmp_news.country]])])}const $e=re(Fe,[["render",Oe]]);export{$e as default};
